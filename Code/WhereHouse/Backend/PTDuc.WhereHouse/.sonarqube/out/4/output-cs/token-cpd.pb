Ù
âD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\Authentication\AuthenticationManager.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{		 
public

 

class

 !
AuthenticationManager

 &
:

' ("
IAuthenticationManager

) ?
{ 
private 
string 
key 
; 
public !
AuthenticationManager $
($ %
string% +
key, /
)/ 0
{ 	
this 
. 
key 
= 
key 
; 
} 	
public 
object 
Authenticate "
(" #
string# )
userId* 0
,0 1
string1 7
username8 @
,@ A
stringB H
passwordI Q
)Q R
{ 	
var 
tokenHandler 
= 
new "#
JwtSecurityTokenHandler# :
(: ;
); <
;< =
var 
tokenKey 
= 
Encoding #
.# $
ASCII$ )
.) *
GetBytes* 2
(2 3
key3 6
)6 7
;7 8
var 
tokenDescriptor 
=  !
new" %#
SecurityTokenDescriptor& =
{ 
Subject 
= 
new 
ClaimsIdentity ,
(, -
new- 0
Claim1 6
[6 7
]7 8
{9 :
new 
Claim !
(! "
$str" ,
,, -
username. 6
)6 7
,7 8
new 
Claim !
(! "
$str" *
,* +
userId, 2
)2 3
} 
) 
, 
Expires 
= 
DateTime "
." #
UtcNow# )
.) *
AddYears* 2
(2 3
$num3 4
)4 5
,5 6
SigningCredentials "
=# $
new% (
SigningCredentials) ;
(; <
new  
SymmetricSecurityKey ,
(, -
tokenKey- 5
)5 6
,6 7
SecurityAlgorithms "
." #
HmacSha256Signature# 6
)6 7
}   
;   
var!! 
token!! 
=!! 
tokenHandler!! $
.!!$ %
CreateToken!!% 0
(!!0 1
tokenDescriptor!!1 @
)!!@ A
;!!A B
return"" 
tokenHandler"" 
.""  

WriteToken""  *
(""* +
token""+ 0
)""0 1
;""1 2
}## 	
}$$ 
}%% ÷7
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLAddress.cs
	namespace		 	
PTDuc		
 
.		 

WhereHouse		 
.		 
BL		 
.		 
BusinessLayer		 +
{

 
public 

class 
	BLAddress 
: 

IBLAddress '
{ 
public 
List 
< 
Province 
> 
GetProvinces *
(* +
string+ 1
filePath2 :
): ;
{ 	
List 
< 
Province 
> 
res 
=  
null! %
;% &
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
filePath& .
). /
)/ 0
{ 
res 
= 
this 
. 
ReadFileJson '
<' (
Province( 0
>0 1
(1 2
filePath2 :
): ;
;; <
} 
return 
res 
; 
} 	
public 
List 
< 
District 
> 
GetDistricts *
(* +
string+ 1
filePath2 :
): ;
{ 	
List 
< 
District 
> 
res 
=  
null! %
;% &
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
filePath& .
). /
)/ 0
{ 
res 
= 
this 
. 
ReadFileJson '
<' (
District( 0
>0 1
(1 2
filePath2 :
): ;
;; <
} 
return 
res 
; 
} 	
public   
List   
<   
Ward   
>   
GetWards   "
(  " #
string  # )
filePath  * 2
)  2 3
{!! 	
List"" 
<"" 
Ward"" 
>"" 
res"" 
="" 
null"" !
;""! "
if## 
(## 
!## 
string## 
.## 
IsNullOrEmpty## %
(##% &
filePath##& .
)##. /
)##/ 0
{$$ 
res%% 
=%% 
this%% 
.%% 
ReadFileJson%% '
<%%' (
Ward%%( ,
>%%, -
(%%- .
filePath%%. 6
)%%6 7
;%%7 8
}&& 
return'' 
res'' 
;'' 
}(( 	
public** 
List** 
<** 
District** 
>**  
GetDistrictsByParent** 2
(**2 3
string**3 9
rootFilePath**: F
,**F G
string**H N

parentCode**O Y
)**Y Z
{++ 	
List,, 
<,, 
District,, 
>,, 
res,, 
=,,  
null,,! %
;,,% &
if-- 
(-- 
!-- 
string-- 
.-- 
IsNullOrEmpty-- %
(--% &

parentCode--& 0
)--0 1
)--1 2
{.. 
var// 
filePath// 
=// 
Path// #
.//# $
Combine//$ +
(//+ ,
rootFilePath//, 8
,//8 9

parentCode//: D
+//E F
$str//G N
)//N O
;//O P
if00 
(00 
File00 
.00 
Exists00 
(00  
filePath00  (
)00( )
)00) *
{11 
res22 
=22 
this22 
.22 
ReadFileJson22 +
<22+ ,
District22, 4
>224 5
(225 6
filePath226 >
)22> ?
;22? @
}33 
}44 
return55 
res55 
;55 
}66 	
public88 
List88 
<88 
Ward88 
>88 
GetWardsByParent88 *
(88* +
string88+ 1
rootFilePath882 >
,88> ?
string88@ F

parentCode88G Q
)88Q R
{99 	
List:: 
<:: 
Ward:: 
>:: 
res:: 
=:: 
null:: !
;::! "
if;; 
(;; 
!;; 
string;; 
.;; 
IsNullOrEmpty;; %
(;;% &

parentCode;;& 0
);;0 1
);;1 2
{<< 
var== 
filePath== 
=== 
Path== #
.==# $
Combine==$ +
(==+ ,
rootFilePath==, 8
,==8 9

parentCode==: D
+==E F
$str==G N
)==N O
;==O P
if>> 
(>> 
File>> 
.>> 
Exists>> 
(>>  
filePath>>  (
)>>( )
)>>) *
{?? 
res@@ 
=@@ 
this@@ 
.@@ 
ReadFileJson@@ +
<@@+ ,
Ward@@, 0
>@@0 1
(@@1 2
filePath@@2 :
)@@: ;
;@@; <
}AA 
}BB 
returnCC 
resCC 
;CC 
}DD 	
publicFF 
ListFF 
<FF 
TTypeFF 
>FF 
ReadFileJsonFF '
<FF' (
TTypeFF( -
>FF- .
(FF. /
stringFF/ 5
filePathFF6 >
)FF> ?
{GG 	
ListHH 
<HH 
TTypeHH 
>HH 
resHH 
=HH 
nullHH "
;HH" #
usingII 
(II 
StreamReaderII 
rII  !
=II" #
newII$ '
StreamReaderII( 4
(II4 5
filePathII5 =
)II= >
)II> ?
{JJ 
stringKK 
jsonKK 
=KK 
rKK 
.KK  
	ReadToEndKK  )
(KK) *
)KK* +
;KK+ ,
ifLL 
(LL 
!LL 
stringLL 
.LL 
IsNullOrEmptyLL )
(LL) *
jsonLL* .
)LL. /
)LL/ 0
{MM 
varNN 
dataNN 
=NN 
JsonConvertNN *
.NN* +
DeserializeObjectNN+ <
<NN< =

DictionaryNN= G
<NNG H
stringNNH N
,NNN O
TTypeNNP U
>NNU V
>NNV W
(NNW X
jsonNNX \
)NN\ ]
;NN] ^
resOO 
=OO 
dataOO 
.OO 
SelectOO %
(OO% &
xOO& '
=>OO( *
xOO+ ,
.OO, -
ValueOO- 2
)OO2 3
.OO3 4
ToListOO4 :
(OO: ;
)OO; <
;OO< =
}PP 
}QQ 
returnRR 
resRR 
;RR 
}SS 	
}TT 
}UU ùg
kD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLBase.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLBase 
< 
TEntity 
,  
TDTO! %
>% &
:' (
IBLBase) 0
<0 1
TEntity1 8
,8 9
TDTO9 =
>= >
{ 
	protected 
IDLBase 
< 
TEntity !
,! "
TDTO" &
>& '
_dlBase( /
;/ 0
	protected 
ServiceResult 
_serviceResult  .
=/ 0
new1 4
ServiceResult5 B
(B C
)C D
;D E
	protected 
readonly 
IMapper "
_mapper# *
;* +
public 
BLBase 
( 
IDLBase 
< 
TEntity %
,% &
TDTO' +
>+ ,
dlBase- 3
,3 4
IMapper5 <
mapper= C
)C D
{ 	
_dlBase 
= 
dlBase 
; 
_mapper 
= 
mapper 
; 
} 	
public 
virtual 
bool 
BeforeInsert (
(( )
ref) ,
TDTO- 1
entity2 8
)8 9
{ 	
return 
true 
; 
} 	
public   
bool   
BeforeUpdate    
(    !
ref  ! $
TEntity  % ,
entity  - 3
)  3 4
{!! 	
return"" 
true"" 
;"" 
}## 	
public%% 
bool%% 
Delete%% 
(%% 
TEntity%% "
entity%%# )
)%%) *
{&& 	
return'' 
_dlBase'' 
.'' 
Delete'' !
(''! "
entity''" (
)''( )
;'') *
}(( 	
public** 
IEnumerable** 
<** 
TDTO** 
>**  
GetAll**! '
(**' (
)**( )
{++ 	
var,, 
res,, 
=,, 
_dlBase,, 
.,, 
GetAll,, $
(,,$ %
),,% &
;,,& '
return-- 
res-- 
;-- 
}.. 	
public00 
ServiceResult00 
GetByPaging00 (
(00( )
int00) ,
page00- 1
,001 2
int003 6
pageSize007 ?
)00? @
{11 	
return22 
_dlBase22 
.22 
GetByPaging22 &
(22& '
page22' +
,22+ ,
pageSize22, 4
)224 5
;225 6
}33 	
public55 
TDTO55 
GetByID55 
(55 
string55 "
Id55# %
)55% &
{66 	
var77 
data77 
=77 
_dlBase77 
.77 
GetByID77 &
(77& '
Id77' )
)77) *
;77* +
var88 
res88 
=88 
default88 
(88 
TDTO88 "
)88" #
;88# $
if99 
(99 
data99 
!=99 
null99 
)99 
{99 
res:: 
=:: 
_mapper:: 
.:: 
Map:: !
<::! "
TDTO::" &
>::& '
(::' (
data::( ,
)::, -
;::- .
};; 
return<< 
res<< 
;<< 
}== 	
public?? 
IEnumerable?? 
<?? 
TEntity?? "
>??" #
GetByKey??$ ,
(??, -
string??- 3
key??4 7
,??7 8
string??9 ?
value??@ E
)??E F
{@@ 	
varAA 
resAA 
=AA 
_dlBaseAA 
.AA 
GetByKeyAA &
(AA& '
keyAA' *
,AA* +
valueAA, 1
)AA1 2
;AA2 3
returnBB 
resBB 
;BB 
}CC 	
publicEE 
TEntityEE 
GetOneByKeyEE "
(EE" #
stringEE# )
keyEE* -
,EE- .
stringEE/ 5
valueEE6 ;
)EE; <
{FF 	
varGG 
resGG 
=GG 
_dlBaseGG 
.GG 
GetOneByKeyGG )
(GG) *
keyGG* -
,GG- .
valueGG/ 4
)GG4 5
;GG5 6
returnHH 
resHH 
;HH 
}II 	
publicKK 
virtualKK 
boolKK 
InsertKK "
(KK" #
TDTOKK# '
entityKK( .
)KK. /
{LL 	
varMM 
resMM 
=MM 
falseMM 
;MM 
ifNN 
(NN 
thisNN 
.NN 
ValidateNN 
(NN 
entityNN $
)NN$ %
)NN% &
{OO 
ifPP 
(PP 
thisPP 
.PP 
ValidateCustomPP '
(PP' (
entityPP( .
)PP. /
)PP/ 0
{QQ 
ifRR 
(RR 
thisRR 
.RR 
BeforeInsertRR )
(RR) *
refRR* -
entityRR. 4
)RR4 5
)RR5 6
{SS 
varTT 
	mapEntityTT %
=TT& '
_mapperTT( /
.TT/ 0
MapTT0 3
<TT3 4
TEntityTT4 ;
>TT; <
(TT< =
entityTT= C
)TTC D
;TTD E
resUU 
=UU 
_dlBaseUU %
.UU% &
InsertUU& ,
(UU, -
	mapEntityUU- 6
)UU6 7
;UU7 8
}VV 
}WW 
}XX 
returnYY 
resYY 
;YY 
}ZZ 	
public\\ 
bool\\ 
Update\\ 
(\\ 
TDTO\\ 
entity\\  &
,\\& '
string\\' -
id\\. 0
)\\1 2
{]] 	
var^^ 
	mapEntity^^ 
=^^ 
_mapper^^ #
.^^# $
Map^^$ '
<^^' (
TEntity^^( /
>^^/ 0
(^^0 1
entity^^1 7
)^^7 8
;^^8 9
return__ 
_dlBase__ 
.__ 
Update__ !
(__! "
	mapEntity__" +
,__+ ,
id__, .
)__. /
;__/ 0
}`` 	
publiccc 
boolcc 
Validatecc 
(cc 
TDTOcc !
entitycc" (
)cc( )
{dd 	
varee 
mesArrayErroree 
=ee 
newee  #
Listee$ (
<ee( )
stringee) /
>ee/ 0
(ee0 1
)ee1 2
;ee2 3
varff 

isValidateff 
=ff 
trueff !
;ff! "
varhh 

propertieshh 
=hh 
entityhh #
.hh# $
GetTypehh$ +
(hh+ ,
)hh, -
.hh- .
GetPropertieshh. ;
(hh; <
)hh< =
;hh= >
foreachkk 
(kk 
varkk 
propertykk !
inkk" $

propertieskk% /
)kk/ 0
{ll 
varmm 
propertyValuemm !
=mm" #
propertymm$ ,
.mm, -
GetValuemm- 5
(mm5 6
entitymm6 <
)mm< =
;mm= >
varnn 
propertyNamenn  
=nn! "
propertynn# +
.nn+ ,
Namenn, 0
;nn0 1
varpp 
displayNamepp 
=pp  !
propertypp" *
.pp* +
GetCustomAttributespp+ >
(pp> ?
falsepp? D
)ppD E
.qq 
OfTypeqq 
<qq  
DisplayNameAttributeqq ,
>qq, -
(qq- .
)qq. /
.rr 
FirstOrDefaultrr 
(rr  
)rr  !
;rr! "
;rr# $
ifuu 
(uu 
propertyuu 
.uu 
	IsDefineduu &
(uu& '
typeofuu' -
(uu- .
Requireduu. 6
)uu6 7
,uu7 8
falseuu9 >
)uu> ?
)uu? @
{vv 
ifxx 
(xx 
propertyValuexx %
==xx& (
nullxx) -
)xx- .
{yy 

isValidatezz "
=zz# $
falsezz% *
;zz* +
if{{ 
({{ 
displayName{{ '
!={{( *
null{{+ /
){{/ 0
{|| 
mesArrayError}} )
.}}) *
Add}}* -
(}}- .
$"}}. 0
$str}}0 :
{}}: ;
displayName}}; F
.}}F G
DisplayName}}G R
}}}R S
$str}}S m
"}}m n
)}}n o
;}}o p
}~~ 
_serviceResult &
.& '
	Messenger' 0
=1 2
$str3 I
;I J
}
ÄÄ 
}
ÅÅ 
if
ÉÉ 
(
ÉÉ 
property
ÉÉ 
.
ÉÉ 
	IsDefined
ÉÉ &
(
ÉÉ& '
typeof
ÉÉ' -
(
ÉÉ- .
CheckDuplicate
ÉÉ. <
)
ÉÉ< =
,
ÉÉ= >
false
ÉÉ? D
)
ÉÉD E
)
ÉÉE F
{
ÑÑ 
var
ÜÜ 
entityDuplicate
ÜÜ '
=
ÜÜ( )
GetByKey
ÜÜ* 2
(
ÜÜ2 3
propertyName
ÜÜ3 ?
,
ÜÜ? @
propertyValue
ÜÜA N
.
ÜÜN O
ToString
ÜÜO W
(
ÜÜW X
)
ÜÜX Y
)
ÜÜY Z
;
ÜÜZ [
if
àà 
(
àà 
entityDuplicate
àà '
!=
àà( *
null
àà+ /
)
àà/ 0
{
ââ 

isValidate
ää "
=
ää# $
false
ää% *
;
ää* +
mesArrayError
ãã %
.
ãã% &
Add
ãã& )
(
ãã) *
$"
ãã* ,
$str
ãã, 6
{
ãã6 7
displayName
ãã7 B
.
ããB C
DisplayName
ããC N
}
ããN O
$str
ããO d
"
ããd e
)
ããe f
;
ããf g
}
çç 
}
éé 
if
êê 
(
êê 
property
êê 
.
êê 
	IsDefined
êê &
(
êê& '
typeof
êê' -
(
êê- .
	MaxLength
êê. 7
)
êê7 8
,
êê8 9
false
êê: ?
)
êê? @
)
êê@ A
{
ëë 
var
ìì  
attributeMaxLength
ìì *
=
ìì+ ,
property
ìì- 5
.
ìì5 6!
GetCustomAttributes
ìì6 I
(
ììI J
typeof
ììJ P
(
ììP Q
	MaxLength
ììQ Z
)
ììZ [
,
ìì[ \
true
ìì] a
)
ììa b
[
ììb c
$num
ììc d
]
ììd e
;
ììe f
var
îî 
length
îî 
=
îî  
(
îî! " 
attributeMaxLength
îî" 4
as
îî5 7
	MaxLength
îî8 A
)
îîA B
.
îîB C
Value
îîC H
;
îîH I
var
ïï 
msg
ïï 
=
ïï 
(
ïï  
attributeMaxLength
ïï 1
as
ïï2 4
	MaxLength
ïï5 >
)
ïï> ?
.
ïï? @
ErrorMsg
ïï@ H
;
ïïH I
if
ññ 
(
ññ 
propertyValue
ññ %
.
ññ% &
ToString
ññ& .
(
ññ. /
)
ññ/ 0
.
ññ0 1
Trim
ññ1 5
(
ññ5 6
)
ññ6 7
.
ññ7 8
Length
ññ8 >
>
ññ? @
length
ññA G
)
ññG H
{
óó 

isValidate
òò "
=
òò# $
false
òò% *
;
òò* +
mesArrayError
ôô %
.
ôô% &
Add
ôô& )
(
ôô) *
msg
ôô* -
??
ôô. 0
$"
ôô1 3
$str
ôô3 =
{
ôô= >
displayName
ôô> I
.
ôôI J
DisplayName
ôôJ U
}
ôôU V
$str
ôôV `
{
ôô` a
length
ôôa g
}
ôôg h
$str
ôôh x
"
ôôx y
)
ôôy z
;
ôôz {
_serviceResult
öö &
.
öö& '
	Messenger
öö' 0
=
öö1 2
$str
öö3 W
;
ööW X
}
õõ 
}
úú 
}
ÆÆ 
_serviceResult
ØØ 
.
ØØ 
Data
ØØ 
=
ØØ  !
mesArrayError
ØØ" /
;
ØØ/ 0
if
≥≥ 
(
≥≥ 

isValidate
≥≥ 
==
≥≥ 
true
≥≥ "
)
≥≥" #

isValidate
≥≥$ .
=
≥≥/ 0
this
≥≥1 5
.
≥≥5 6
ValidateCustom
≥≥6 D
(
≥≥D E
entity
≥≥E K
)
≥≥K L
;
≥≥L M
return
¥¥ 

isValidate
¥¥ 
;
¥¥ 
}
µµ 	
public
∑∑ 
bool
∑∑ 
ValidateCustom
∑∑ "
(
∑∑" #
TDTO
∑∑# '
entity
∑∑( .
)
∑∑. /
{
∏∏ 	
return
ππ 
true
ππ 
;
ππ 
}
∫∫ 	
}
ªª 
}ºº Õ
sD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLConversation.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLConversation 
:  !
BLBase" (
<( )
Conversation) 5
,5 6
ConversationDTO7 F
>F G
,G H
IBLConversationI X
{ 
IDLConversation 
_DLConversation '
;' (
public 
BLConversation 
( 
IDLConversation -
DLConversation. <
,< =
IMapper> E
mapperF L
)L M
:N O
baseP T
(T U
DLConversationU c
,c d
mappere k
)k l
{ 	
_DLConversation 
= 
DLConversation ,
;, -
} 	
public 
List 
< 
Conversation  
>  !"
GetAllConversationUser" 8
(8 9
string9 ?
userId@ F
)F G
{ 	
return 
_DLConversation "
." #"
GetAllConversationUser# 9
(9 :
userId: @
)@ A
;A B
} 	
public 
Conversation 
GetConversation +
(+ ,
string, 2
userId13 :
,: ;
string< B
userId2C J
)J K
{ 	
return 
_DLConversation "
." #
GetConversation# 2
(2 3
userId13 :
,: ;
userId2< C
)C D
;D E
} 	
public!! 
Guid!! 
InitChat!! 
(!! 
string!! #
userRecievedId!!$ 2
,!!2 3
string!!4 :

userSendId!!; E
)!!E F
{"" 	
var## 
conversation## 
=## 
this## #
.### $
GetConversation##$ 3
(##3 4

userSendId##4 >
,##> ?
userRecievedId##@ N
)##N O
;##O P
if$$ 
($$ 
conversation$$ 
!=$$ 
null$$  $
)$$$ %
return$$& ,
conversation$$- 9
.$$9 :
ConversationId$$: H
;$$H I
else%% 
{&& 
var'' 
newid'' 
='' 
Guid''  
.''  !
NewGuid''! (
(''( )
)'') *
;''* +
this(( 
.(( 
Insert(( 
((( 
new(( 
ConversationDTO((  /
(((/ 0
)((0 1
{)) 
ConversationId** "
=**# $
newid**% *
,*** +
UserId1++ 
=++ 
Guid++ "
.++" #
Parse++# (
(++( )

userSendId++) 3
)++3 4
,++4 5
UserId2,, 
=,, 
Guid,, "
.,," #
Parse,,# (
(,,( )
userRecievedId,,) 7
),,7 8
}-- 
)-- 
;-- 
return.. 
newid.. 
;.. 
}// 
}00 	
}11 
}22 Å9
kD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLFile.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLFile 
: 
BLBase  
<  !
	DBContext! *
.* +
Models+ 1
.1 2
File2 6
,6 7
FileDTO8 ?
>? @
,@ A
IBLFileB I
{ 
IDLFile 
_dlFile 
; 
public 
BLFile 
( 
IDLFile 
dlFile $
,$ %
IMapper& -
mapper. 4
)4 5
:6 7
base8 <
(< =
dlFile= C
,C D
mapperE K
)K L
{ 	
_dlFile 
= 
dlFile 
; 
} 	
public 
ServiceResult 

DeleteFile '
(' (

FileUpload( 2

fileUpload3 =
,= >
string? E
webRootPathF Q
)Q R
{ 	
var 
res 
= 
new 
ServiceResult '
(' (
)( )
;) *
try 
{ 
var 
webFilePath 
=  !
Path" &
.& '
Combine' .
(. /
webRootPath/ :
,: ;

fileUpload< F
.F G
filePathG O
)O P
;P Q
if   
(   
!   
System   
.   
IO   
.   
File   #
.  # $
Exists  $ *
(  * +
webFilePath  + 6
)  6 7
)  7 8
{!! 
res"" 
."" 

StatusCode"" "
=""# $
(""% &
int""& )
)"") *
Enumeration""* 5
.""5 6

ResultCode""6 @
.""@ A
NotExistFile""A M
;""M N
res## 
.## 
Data## 
=## 
false## $
;##$ %
}$$ 
else%% 
{&& 
System'' 
.'' 
IO'' 
.'' 
File'' "
.''" #
Delete''# )
('') *
webFilePath''* 5
)''5 6
;''6 7
res(( 
.(( 
Data(( 
=(( 
true(( #
;((# $
var)) 
insertSuccess)) %
=))& '
this))( ,
.)), -
Delete))- 3
())3 4
new))4 7
	DBContext))8 A
.))A B
Models))B H
.))H I
File))I M
{))N O
FileId))P V
=))W X

fileUpload))Y c
.))c d
FileId))d j
.))j k
Value))k p
}))q r
)))r s
;))s t
if** 
(** 
insertSuccess** %
)**% &
{++ 
res,, 
.,, 
Data,,  
=,,! "
true,,# '
;,,' (
}-- 
else.. 
{// 
res00 
.00 
Data00  
=00! "
false00# (
;00( )
}11 
}22 
}33 
catch44 
(44 
	Exception44 
e44 
)44 
{55 
res66 
.66 
Data66 
=66 
e66 
;66 
res77 
.77 

StatusCode77 
=77  
(77! "
int77" %
)77% &
Enumeration77& 1
.771 2

ResultCode772 <
.77< =
Failed77= C
;77C D
}88 
return99 
res99 
;99 
}:: 	
public<< 
ServiceResult<< 

UploadFile<< '
(<<' (

FileUpload<<( 2

fileUpload<<3 =
,<<= >
string<<? E
webRootPath<<F Q
,<<Q R
string<<S Y

folderPath<<Z d
)<<d e
{== 	
var>> 
res>> 
=>> 
new>> 
ServiceResult>> '
(>>' (
)>>( )
;>>) *
var?? 
webFolderPath?? 
=?? 
Path??  $
.??$ %
Combine??% ,
(??, -
webRootPath??- 8
,??8 9

folderPath??: D
)??D E
;??E F
if@@ 
(@@ 
!@@ 
	Directory@@ 
.@@ 
Exists@@ !
(@@! "
webFolderPath@@" /
)@@/ 0
)@@0 1
	DirectoryAA 
.AA 
CreateDirectoryAA )
(AA) *
webFolderPathAA* 7
)AA7 8
;AA8 9
varBB 
fileBB 
=BB 

fileUploadBB !
.BB! "
fileBB" &
;BB& '
varCC 
fileNameCC 
=CC 
GuidCC 
.CC  
NewGuidCC  '
(CC' (
)CC( )
+CC* +
PathCC, 0
.CC0 1
GetExtensionCC1 =
(CC= >
fileCC> B
.CCB C
FileNameCCC K
)CCK L
;CCL M
varDD 
filePathDD 
=DD 
PathDD 
.DD  
CombineDD  '
(DD' (

folderPathDD( 2
,DD2 3
fileNameDD4 <
)DD< =
;DD= >
varEE 
webFilePathEE 
=EE 
PathEE "
.EE" #
CombineEE# *
(EE* +
webRootPathEE+ 6
,EE6 7
filePathEE8 @
)EE@ A
;EEA B
usingFF 
(FF 
varFF 
stremFF 
=FF 
SystemFF %
.FF% &
IOFF& (
.FF( )
FileFF) -
.FF- .
CreateFF. 4
(FF4 5
webFilePathFF5 @
)FF@ A
)FFA B
{GG 
fileHH 
.HH 
CopyToHH 
(HH 
stremHH !
)HH! "
;HH" #
}II 
varJJ 
fileAddJJ 
=JJ 
newJJ 
FileDTOJJ %
{JJ& '
FileIdJJ( .
=JJ/ 0
GuidJJ1 5
.JJ5 6
NewGuidJJ6 =
(JJ= >
)JJ> ?
,JJ? @
FileNameJJA I
=JJJ K
fileNameJJL T
,JJT U
FilePathJJV ^
=JJ_ `
filePathJJa i
}JJj k
;JJk l
varKK 
successKK 
=KK 
thisKK 
.KK 
InsertKK %
(KK% &
fileAddKK& -
)KK- .
;KK. /
ifLL 
(LL 
successLL 
)LL 
{MM 
resNN 
.NN 
DataNN 
=NN 
fileAddNN "
;NN" #
}OO 
elsePP 
{QQ 
resRR 
.RR 

StatusCodeRR 
=RR  
(RR! "
intRR" %
)RR% &
EnumerationRR& 1
.RR1 2

ResultCodeRR2 <
.RR< =
FailedRR= C
;RRC D
}SS 
returnTT 
resTT 
;TT 
}UU 	
}VV 
}WW ä
lD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLHouse.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLHouse 
: 
BLBase !
<! "
House" '
,' (
HouseDTO( 0
>0 1
,1 2
IBLHouse3 ;
{ 
IDLHouse 
_dlHouse 
; 
IBLWishlist 
_bLWishlist 
;  
IBLPost 
_bLPost 
; 
public 
BLHouse 
( 
IDLHouse 
dLHouse  '
,' (
IBLWishlist( 3

bLWishlist4 >
,> ?
IMapper@ G
mapperH N
,N O
IBLPostP W
bLPostX ^
)^ _
:` a
baseb f
(f g
dLHouseg n
,n o
mapperp v
)v w
{ 	
_dlHouse 
= 
dLHouse 
; 
_bLWishlist 
= 

bLWishlist $
;$ %
_bLPost 
= 
bLPost 
; 
} 	
public 
bool 

AddNewPost 
( 
HouseDTO '
dataForPost( 3
)3 4
{ 	
var 
res 
= 
false 
; 
if 
( 
this 
. 
Validate 
( 
dataForPost )
)) *
)* +
{, -
var 
houseId 
= 
Guid "
." #
NewGuid# *
(* +
)+ ,
;, -
dataForPost   
.   
HouseId   #
=  $ %
houseId  & -
;  - .
res!! 
=!! 
this!! 
.!! 
Insert!! !
(!!! "
dataForPost!!" -
)!!- .
;!!. /
dataForPost"" 
."" 
CreatedDate"" '
=""( )
DateTime""* 2
.""2 3
Now""3 6
;""6 7
if## 
(## 
res## 
)## 
{## 
PostDTO$$ 
post$$  
=$$! "
new$$# &
PostDTO$$' .
{$$/ 0
Title$$1 6
=$$7 8
dataForPost$$9 D
.$$D E
Title$$E J
,$$J K
Descrtiption$$L X
=$$Y Z
dataForPost$$[ f
.$$f g
Description$$g r
,$$r s
UserId$$t z
=$${ |
dataForPost	$$} à
.
$$à â
UserOwnerId
$$â î
,
$$î ï
HouseId
$$ï ú
=
$$ù û
houseId
$$ü ¶
}
$$ß ®
;
$$® ©
res%% 
=%% 
_bLPost%% "
.%%" #
Insert%%# )
(%%) *
post%%* .
)%%. /
;%%/ 0
}&& 
return'' 
res'' 
;'' 
}(( 
return)) 
res)) 
;)) 
}** 	
public,, 
IEnumerable,, 
<,, 
House,,  
>,,  !
GetDeepData,," -
(,,- .
),,. /
{-- 	
return.. 
_dlHouse.. 
... 
GetDeepData.. '
(..' (
)..( )
;..) *
}// 	
}11 
}22 è
pD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLHouseType.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLHouseType 
: 
BLBase %
<% &
	HouseType& /
,/ 0
HouseTypeDTO1 =
>= >
,> ?
IBLHouseType@ L
{ 
IDLHouseType 
_DLHouseType !
;! "
public 
BLHouseType 
( 
IDLHouseType '
DLHouseType( 3
,3 4
IMapper5 <
mapper= C
)C D
:E F
baseG K
(K L
DLHouseTypeL W
,W X
mapperY _
)_ `
{ 	
_DLHouseType 
= 
DLHouseType &
;& '
} 	
} 
} ÿ
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLMessage.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
	BLMessage 
: 
BLBase #
<# $
Message$ +
,+ ,

MessageDTO- 7
>7 8
,8 9

IBLMessage: D
{ 

IDLMessage 

_DLMessage 
; 
public 
	BLMessage 
( 

IDLMessage #
	DLMessage$ -
,- .
IMapper/ 6
mapper7 =
)= >
:? @
baseA E
(E F
	DLMessageF O
,O P
mapperQ W
)W X
{ 	

_DLMessage 
= 
	DLMessage "
;" #
} 	
public 
object 
GetConversation %
(% &

MessageDTO& 0
message1 8
)8 9
{ 	
return 

_DLMessage 
. 
GetConversation -
(- .
message. 5
)5 6
;6 7
} 	
public 
List 
< 
Message 
> '
GetMessagesByConversationId 8
(8 9
string9 ?
conversationId@ N
)N O
{ 	
return 

_DLMessage 
. '
GetMessagesByConversationId 9
(9 :
conversationId: H
)H I
;I J
} 	
} 
}   ◊`
kD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLPost.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLPost 
: 
BLBase  
<  !
Post! %
,% &
PostDTO' .
>. /
,/ 0
IBLPost1 8
{ 
IDLPost 
_DLPost 
; 
IDLHouse 
_dLHouse 
; 
IBLUser 
_BLUser 
; 
public 
BLPost 
( 
IDLPost 
DLPost $
,$ %
IMapper& -
mapper. 4
,4 5
IDLHouse6 >
dLHouse? F
,F G
IBLUserH O
BLUserP V
)V W
:X Y
baseZ ^
(^ _
DLPost_ e
,e f
mapperg m
)m n
{ 	
_DLPost 
= 
DLPost 
; 
_dLHouse 
= 
dLHouse 
; 
_BLUser 
= 
BLUser 
; 
} 	
public 
ServiceResult 
GetUserPost (
(( )
Guid) -
userId. 4
)4 5
{ 	
var 
res 
= 
new 
ServiceResult '
(' (
)( )
;) *
res 
. 
Data 
= 
_DLPost 
. 
GetUserPost *
(* +
userId+ 1
)1 2
;2 3
return   
res   
;   
}!! 	
public"" 
ServiceResult"" 
DeletePostUser"" +
(""+ ,
string"", 2
postId""3 9
,""9 :
string""; A
userId""B H
)""H I
{## 	
var$$ 
res$$ 
=$$ 
new$$ 
ServiceResult$$ '
($$' (
)$$( )
;$$) *
res%% 
.%% 
Data%% 
=%% 
false%% 
;%% 
var&& 
post&& 
=&& 
_DLPost&& 
.&& 
GetByID&& &
(&&& '
postId&&' -
)&&- .
;&&. /
if'' 
('' 
post'' 
!='' 
null'' 
)'' 
{(( 
if)) 
()) 
post)) 
.)) 
UserId)) 
.))  
ToString))  (
())( )
)))) *
==))+ -
userId)). 4
)))4 5
{** 
var++ 

delSuccess++ "
=++# $
_DLPost++% ,
.++, -

DeleteById++- 7
(++7 8
postId++8 >
)++> ?
;++? @
if,, 
(,, 

delSuccess,, "
),," #
{-- 

delSuccess.. "
=..# $
_dLHouse..% -
...- .

DeleteById... 8
(..8 9
post..9 =
...= >
House..> C
...C D
HouseId..D K
...K L
ToString..L T
(..T U
)..U V
)..V W
;..W X
if// 
(// 

delSuccess// &
)//& '
{00 
res11 
.11  
Data11  $
=11% &
true11' +
;11+ ,
}22 
else33 
{33 
res44 
.44  
	Messenger44  )
=44* +
$str44, D
;44D E
}55 
}66 
else77 
{77 
res88 
.88 
	Messenger88 %
=88& '
$str88( D
;88D E
}99 
}:: 
else;; 
{<< 
res== 
.== 

StatusCode== "
===# $
(==% &
int==& )
)==) *

ResultCode==* 4
.==4 5
NotHaveRight==5 A
;==A B
}>> 
}?? 
else@@ 
{AA 
resBB 
.BB 

StatusCodeBB 
=BB  
(BB! "
intBB" %
)BB% &

ResultCodeBB& 0
.BB0 1
FailedBB1 7
;BB7 8
}CC 
returnDD 
resDD 
;DD 
}EE 	
publicGG 
ServiceResultGG 

AcceptPostGG '
(GG' (
stringGG( .
postIdGG/ 5
,GG5 6
stringGG7 =
userIdGG> D
)GGD E
{HH 	
varII 
resII 
=II 
newII 
ServiceResultII '
(II' (
)II( )
;II) *
varJJ 
userJJ 
=JJ 
_BLUserJJ 
.JJ 
GetByIDJJ &
(JJ& '
userIdJJ' -
)JJ- .
;JJ. /
ifKK 
(KK 
userKK 
!=KK 
nullKK 
&&KK 
userKK  $
.KK$ %
RoleKK% )
==KK* ,
(KK- .
intKK. 1
)KK1 2
EnumerationKK2 =
.KK= >
RoleKK> B
.KKB C
AdminKKC H
)KKH I
{LL 
varMM 
postMM 
=MM 
thisMM 
.MM  
GetByIDMM  '
(MM' (
postIdMM( .
)MM. /
;MM/ 0
ifNN 
(NN 
postNN 
!=NN 
nullNN  
)NN  !
{OO 
ifPP 
(PP 
postPP 
.PP 
StatusPP #
==PP$ &
(PP' (
intPP( +
)PP+ ,
EnumerationPP, 7
.PP7 8

StatusPostPP8 B
.PPB C
PayPPC F
)PPF G
{QQ 
postRR 
.RR 
StatusRR #
=RR$ %
(RR& '
intRR' *
)RR* +
EnumerationRR+ 6
.RR6 7

StatusPostRR7 A
.RRA B
AcceptedRRB J
;RRJ K
resSS 
.SS 
DataSS  
=SS! "
postSS# '
;SS' (
}TT 
elseUU 
{VV 
resWW 
.WW 

StatusCodeWW &
=WW' (
(WW) *
intWW* -
)WW- .
EnumerationWW. 9
.WW9 :

ResultCodeWW: D
.WWD E

PostNotPayWWE O
;WWO P
resXX 
.XX 
	MessengerXX %
=XX& '
$strXX( [
;XX[ \
}YY 
}ZZ 
}[[ 
else\\ 
{\\ 
res]] 
.]] 

StatusCode]] 
=]]  
(]]! "
int]]" %
)]]% &
Enumeration]]& 1
.]]1 2

ResultCode]]2 <
.]]< =
NotHaveRight]]= I
;]]I J
res^^ 
.^^ 
	Messenger^^ 
=^^ 
$str^^  M
;^^M N
}__ 
return`` 
res`` 
;`` 
}aa 	
publicbb 
ServiceResultbb 
	ClosePostbb &
(bb& '
stringbb' -
postIdbb. 4
,bb4 5
stringbb6 <
userIdbb= C
)bbC D
{cc 	
vardd 
resdd 
=dd 
newdd 
ServiceResultdd '
(dd' (
)dd( )
;dd) *
varee 
useree 
=ee 
_BLUseree 
.ee 
GetByIDee &
(ee& '
userIdee' -
)ee- .
;ee. /
varff 
postff 
=ff 
thisff 
.ff 
GetByIDff #
(ff# $
postIdff$ *
)ff* +
;ff+ ,
ifgg 
(gg 
postgg 
!=gg 
nullgg 
)gg 
{hh 
ifii 
(ii 
(ii 
userii 
!=ii 
nullii !
&&ii" $
userii% )
.ii) *
Roleii* .
==ii/ 1
(ii2 3
intii3 6
)ii6 7
Enumerationii7 B
.iiB C
RoleiiC G
.iiG H
AdminiiH M
)iiM N
||iiO Q
postiiR V
.iiV W
UserIdiiW ]
.ii] ^
ToStringii^ f
(iif g
)iig h
==iii k
userIdiil r
)iir s
{jj 
postkk 
.kk 
Statuskk 
=kk  !
(kk" #
intkk# &
)kk& '
Enumerationkk' 2
.kk2 3

StatusPostkk3 =
.kk= >
Closedkk> D
;kkD E
resll 
.ll 
Datall 
=ll 
postll #
;ll# $
}mm 
elsenn 
{nn 
resoo 
.oo 

StatusCodeoo "
=oo# $
(oo% &
intoo& )
)oo) *
Enumerationoo* 5
.oo5 6

ResultCodeoo6 @
.oo@ A
NotHaveRightooA M
;ooM N
respp 
.pp 
	Messengerpp !
=pp" #
$strpp$ Q
;ppQ R
}qq 
}rr 
returnss 
resss 
;ss 
}tt 	
publicuu 
ServiceResultuu 

ReportPostuu '
(uu' (
stringuu( .
postIduu/ 5
)uu5 6
{vv 	
varww 
resww 
=ww 
newww 
ServiceResultww '
(ww' (
)ww( )
;ww) *
varxx 
postxx 
=xx 
thisxx 
.xx 
GetByIDxx #
(xx# $
postIdxx$ *
)xx* +
;xx+ ,
ifyy 
(yy 
postyy 
!=yy 
nullyy 
)yy 
{zz 
}|| 
return}} 
res}} 
;}} 
}~~ 	
public 
ServiceResult 
GetListPostForAdmin 0
(0 1
string1 7
adminId8 ?
)? @
{
ÄÄ 	
var
ÅÅ 
res
ÅÅ 
=
ÅÅ 
new
ÅÅ 
ServiceResult
ÅÅ '
(
ÅÅ' (
)
ÅÅ( )
;
ÅÅ) *
var
ÇÇ 
admin
ÇÇ 
=
ÇÇ 
_BLUser
ÇÇ 
.
ÇÇ  
GetByID
ÇÇ  '
(
ÇÇ' (
adminId
ÇÇ( /
)
ÇÇ/ 0
;
ÇÇ0 1
try
ÉÉ 
{
ÑÑ 
if
ÖÖ 
(
ÖÖ 
admin
ÖÖ 
!=
ÖÖ 
null
ÖÖ !
)
ÖÖ! "
{
ÜÜ 
if
áá 
(
áá 
admin
áá 
.
áá 
Role
áá "
==
áá# %
(
áá& '
int
áá' *
)
áá* +
Enumeration
áá+ 6
.
áá6 7
Role
áá7 ;
.
áá; <
Admin
áá< A
)
ááA B
{
àà 
var
ââ 
listPost
ââ $
=
ââ% &
_DLPost
ââ' .
.
ââ. /!
GetListPostForAdmin
ââ/ B
(
ââB C
)
ââC D
;
ââD E
res
ää 
.
ää 
Data
ää  
=
ää! "
listPost
ää# +
;
ää+ ,
}
ãã 
else
åå 
{
çç 
res
éé 
.
éé 

StatusCode
éé &
=
éé' (
(
éé) *
int
éé* -
)
éé- .
Enumeration
éé. 9
.
éé9 :

ResultCode
éé: D
.
ééD E
NotHaveRight
ééE Q
;
ééQ R
res
èè 
.
èè 
	Messenger
èè %
=
èè& '
$str
èè( U
;
èèU V
}
êê 
}
ëë 
}
íí 
catch
ìì 
(
ìì 
	Exception
ìì 
ex
ìì 
)
ìì  
{
îî 
res
ïï 
.
ïï 
	Messenger
ïï 
=
ïï 
ex
ïï  "
.
ïï" #
Message
ïï# *
;
ïï* +
res
ññ 
.
ññ 

StatusCode
ññ 
=
ññ  
(
ññ! "
int
ññ" %
)
ññ% &
(
ññ& '
Enumeration
ññ' 2
.
ññ2 3

ResultCode
ññ3 =
.
ññ= >
Failed
ññ> D
)
ññD E
;
ññE F
}
óó 
return
òò 
res
òò 
;
òò 
}
ôô 	
}
öö 
}õõ ˝c
kD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLUser.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLUser 
: 
BLBase  
<  !
User! %
,% &
UserDTO& -
>- .
,. /
IBLUser/ 6
{ 
IDLUser 
_dlUser 
; 
List 
< 
UserDTO 
> 

userOnline  
;  !
public 
BLUser 
( 
IDLUser 
dLUser $
,$ %
IMapper& -
mapper. 4
)4 5
:6 7
base8 <
(< =
dLUser= C
,C D
mapperE K
)K L
{ 	
_dlUser 
= 
dLUser 
; 

userOnline 
= 
new 
List !
<! "
UserDTO" )
>) *
(* +
)+ ,
;, -
} 	
public 
override 
bool 
BeforeInsert )
() *
ref* -
UserDTO. 5
entity6 <
)< =
{ 	
var 
res 
= 
false 
; 
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
entity& ,
., -
Password- 5
)5 6
)6 7
{8 9

LoginParam 

loginParam %
=& '
new( +

LoginParam, 6
(6 7
)7 8
;8 9

loginParam 
= 
PasswordHash )
.) *
HashPassword* 6
(6 7
entity7 =
.= >
Password> F
)F G
;G H
if   
(   

loginParam   
!=   !
null  " &
)  & '
{  ( )
entity!! 
.!! 
Password!! #
=!!$ %

loginParam!!& 0
.!!0 1
HashPassword!!1 =
;!!= >
entity"" 
."" 
Salt"" 
=""  !

loginParam""" ,
."", -
Salt""- 1
;""1 2
res## 
=## 
true## 
;##  
}$$ 
}%% 
return&& 
res&& 
;&& 
}'' 	
public(( 
void(( 
AddUserToListOnline(( '
(((' (
UserDTO((( /
user((0 4
)((4 5
{)) 	
if** 
(** 
user** 
!=** 
null** 
)** 
{** 
var++ 
isExist++ 
=++ 

userOnline++ )
.++) *
	FindIndex++* 3
(++3 4
x++4 5
=>++6 8
x++9 :
.++: ;
UserId++; A
==++B D
user++E I
.++I J
UserId++J P
)++P Q
;++Q R
if,, 
(,, 
isExist,, 
==,, 
-,,  
$num,,  !
),,! "
{,,# $

userOnline-- 
.-- 
Add-- "
(--" #
user--# '
)--' (
;--( )
}.. 
}// 
}00 	
public22 
void22 $
RemoveUserFromListOnline22 ,
(22, -
UserDTO22- 4
user225 9
)229 :
{33 	
if44 
(44 
user44 
!=44 
null44 
)44 
{44 

userOnline55 
.55 
	RemoveAll55 $
(55$ %
x55% &
=>55' )
x55* +
.55+ ,
UserId55, 2
==553 5
user556 :
.55: ;
UserId55; A
)55A B
;55B C
}66 
}77 	
public99 
List99 
<99 
UserDTO99 
>99 
GetListUserOnline99 .
(99. /
)99/ 0
{:: 	
return;; 
this;; 
.;; 

userOnline;; "
;;;" #
}<< 	
public>> 
ServiceResult>> 
InsertAdmin>> (
(>>( )
UserDTO>>) 0
user>>1 5
,>>5 6
string>>7 =
adminId>>> E
)>>E F
{?? 	
var@@ 
res@@ 
=@@ 
new@@ 
ServiceResult@@ '
(@@' (
)@@( )
;@@) *
varAA 
adminAA 
=AA 
thisAA 
.AA 
GetByIDAA $
(AA$ %
adminIdAA% ,
)AA, -
;AA- .
tryBB 
{CC 
ifDD 
(DD 
adminDD 
!=DD 
nullDD !
)DD! "
{EE 
ifFF 
(FF 
adminFF 
.FF 
RoleFF "
==FF# %
(FF& '
intFF' *
)FF* +
EnumerationFF+ 6
.FF6 7
RoleFF7 ;
.FF; <
AdminFF< A
)FFA B
{GG 
userHH 
.HH 
RoleHH !
=HH" #
(HH$ %
intHH% (
)HH( )
EnumerationHH) 4
.HH4 5
RoleHH5 9
.HH9 :
AdminHH: ?
;HH? @
resII 
.II 
DataII  
=II! "
thisII# '
.II' (
InsertII( .
(II. /
userII/ 3
)II3 4
;II4 5
}JJ 
elseKK 
{LL 
resMM 
.MM 

StatusCodeMM &
=MM' (
(MM) *
intMM* -
)MM- .
EnumerationMM. 9
.MM9 :

ResultCodeMM: D
.MMD E
NotHaveRightMME Q
;MMQ R
resNN 
.NN 
	MessengerNN %
=NN& '
$strNN( U
;NNU V
}OO 
}PP 
}QQ 
catchRR 
(RR 
	ExceptionRR 
exRR 
)RR  
{SS 
resTT 
.TT 
	MessengerTT 
=TT 
exTT  "
.TT" #
MessageTT# *
;TT* +
resUU 
.UU 

StatusCodeUU 
=UU  
(UU! "
intUU" %
)UU% &
(UU& '
EnumerationUU' 2
.UU2 3

ResultCodeUU3 =
.UU= >
FailedUU> D
)UUD E
;UUE F
}VV 
returnWW 
resWW 
;WW 
}XX 	
publicZZ 
ServiceResultZZ 
	BlockUserZZ &
(ZZ& '
stringZZ' -
blockUserIdZZ. 9
,ZZ9 :
stringZZ; A
adminIdZZB I
)ZZI J
{[[ 	
var\\ 
res\\ 
=\\ 
new\\ 
ServiceResult\\ '
(\\' (
)\\( )
;\\) *
var]] 
admin]] 
=]] 
this]] 
.]] 
GetByID]] $
(]]$ %
adminId]]% ,
)]], -
;]]- .
try^^ 
{__ 
if`` 
(`` 
admin`` 
!=`` 
null`` !
)``! "
{aa 
ifbb 
(bb 
adminbb 
.bb 
Rolebb "
==bb# %
(bb& '
intbb' *
)bb* +
Enumerationbb+ 6
.bb6 7
Rolebb7 ;
.bb; <
Adminbb< A
)bbA B
{cc 
vardd 
userdd  
=dd! "
thisdd# '
.dd' (
GetByIDdd( /
(dd/ 0
blockUserIddd0 ;
)dd; <
;dd< =
ifee 
(ee 
useree  
!=ee! #
nullee$ (
)ee( )
{ff 
usergg  
.gg  !
Statusgg! '
=gg( )
(gg* +
intgg+ .
)gg. /
Enumerationgg/ :
.gg: ;

StatusUsergg; E
.ggE F
BlockedggF M
;ggM N
thishh  
.hh  !
Updatehh! '
(hh' (
userhh( ,
,hh, -
blockUserIdhh- 8
)hh8 9
;hh9 :
resii 
.ii  
Dataii  $
=ii% &
userii' +
;ii+ ,
resjj 
.jj  
	Messengerjj  )
=jj* +
$strjj, H
;jjH I
}kk 
elsell 
{ll 
resmm 
.mm  

StatusCodemm  *
=mm+ ,
(mm- .
intmm. 1
)mm1 2
Enumerationmm2 =
.mm= >

ResultCodemm> H
.mmH I
FailedmmI O
;mmO P
resnn 
.nn  
	Messengernn  )
=nn* +
$strnn, F
;nnF G
}oo 
}qq 
elserr 
{ss 
restt 
.tt 

StatusCodett &
=tt' (
(tt) *
inttt* -
)tt- .
Enumerationtt. 9
.tt9 :

ResultCodett: D
.ttD E
NotHaveRightttE Q
;ttQ R
resuu 
.uu 
	Messengeruu %
=uu& '
$struu( R
;uuR S
}vv 
}ww 
}xx 
catchyy 
(yy 
	Exceptionyy 
exyy 
)yy  
{zz 
res{{ 
.{{ 
	Messenger{{ 
={{ 
ex{{  "
.{{" #
Message{{# *
;{{* +
res|| 
.|| 

StatusCode|| 
=||  
(||! "
int||" %
)||% &
(||& '
Enumeration||' 2
.||2 3

ResultCode||3 =
.||= >
Failed||> D
)||D E
;||E F
}}} 
return~~ 
res~~ 
;~~ 
} 	
public
ÅÅ 
ServiceResult
ÅÅ !
GetListUserForAdmin
ÅÅ 0
(
ÅÅ0 1
string
ÅÅ1 7
adminId
ÅÅ8 ?
)
ÅÅ? @
{
ÇÇ 	
var
ÉÉ 
res
ÉÉ 
=
ÉÉ 
new
ÉÉ 
ServiceResult
ÉÉ '
(
ÉÉ' (
)
ÉÉ( )
;
ÉÉ) *
var
ÑÑ 
admin
ÑÑ 
=
ÑÑ 
this
ÑÑ 
.
ÑÑ 
GetByID
ÑÑ $
(
ÑÑ$ %
adminId
ÑÑ% ,
)
ÑÑ, -
;
ÑÑ- .
try
ÖÖ 
{
ÜÜ 
if
áá 
(
áá 
admin
áá 
!=
áá 
null
áá !
)
áá! "
{
àà 
if
ââ 
(
ââ 
admin
ââ 
.
ââ 
Role
ââ "
==
ââ# %
(
ââ& '
int
ââ' *
)
ââ* +
Enumeration
ââ+ 6
.
ââ6 7
Role
ââ7 ;
.
ââ; <
Admin
ââ< A
)
ââA B
{
ää 
var
ãã 
listUser
ãã $
=
ãã% &
this
ãã' +
.
ãã+ ,
GetAll
ãã, 2
(
ãã2 3
)
ãã3 4
;
ãã4 5
listUser
åå  
=
åå! "
listUser
åå# +
.
åå+ ,
Where
åå, 1
(
åå1 2
x
åå2 3
=>
åå3 5
x
åå5 6
.
åå6 7
Role
åå7 ;
==
åå; =
(
åå= >
int
åå> A
)
ååA B
Enumeration
ååB M
.
ååM N
Role
ååN R
.
ååR S
User
ååS W
)
ååW X
;
ååX Y
res
çç 
.
çç 
Data
çç  
=
çç! "
listUser
çç# +
;
çç+ ,
}
éé 
else
èè 
{
êê 
res
ëë 
.
ëë 

StatusCode
ëë &
=
ëë' (
(
ëë) *
int
ëë* -
)
ëë- .
Enumeration
ëë. 9
.
ëë9 :

ResultCode
ëë: D
.
ëëD E
NotHaveRight
ëëE Q
;
ëëQ R
res
íí 
.
íí 
	Messenger
íí %
=
íí& '
$str
íí( U
;
ííU V
}
ìì 
}
îî 
}
ïï 
catch
ññ 
(
ññ 
	Exception
ññ 
ex
ññ 
)
ññ  
{
óó 
res
òò 
.
òò 
	Messenger
òò 
=
òò 
ex
òò  "
.
òò" #
Message
òò# *
;
òò* +
res
ôô 
.
ôô 

StatusCode
ôô 
=
ôô  
(
ôô! "
int
ôô" %
)
ôô% &
(
ôô& '
Enumeration
ôô' 2
.
ôô2 3

ResultCode
ôô3 =
.
ôô= >
Failed
ôô> D
)
ôôD E
;
ôôE F
}
öö 
return
õõ 
res
õõ 
;
õõ 
}
úú 	
}
ùù 
}ûû È
oD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLWishlist.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 

BLWishlist 
: 
BLBase $
<$ %
Wishlist% -
,- .
WishlistDTO/ :
>: ;
,; <
IBLWishlist= H
{ 
IDLWishlist 
_DLWishlist 
;  
public 

BLWishlist 
( 
IDLWishlist %

DLWishlist& 0
,0 1
IMapper2 9
mapper: @
)@ A
:B C
baseD H
(H I

DLWishlistI S
,S T
mapperU [
)[ \
{ 	
_DLWishlist 
= 

DLWishlist $
;$ %
} 	
public 
ServiceResult 
DeletePostWishlist /
(/ 0
string0 6

wishListId7 A
,A B
stringC I
userIdJ P
)P Q
{ 	
var 
res 
= 
new 
ServiceResult '
(' (
)( )
;) *
res 
. 
Data 
= 
false 
; 
var 
wishListItem 
= 
_DLWishlist *
.* +
GetByID+ 2
(2 3

wishListId3 =
)= >
;> ?
if 
( 
wishListItem 
!= 
null  $
)$ %
{ 
if 
( 
wishListItem  
.  !
UserId! '
.' (
ToString( 0
(0 1
)1 2
==3 5
userId6 <
)< =
{ 
var   

delSuccess   "
=  # $
_DLWishlist  % 0
.  0 1

DeleteById  1 ;
(  ; <

wishListId  < F
)  F G
;  G H
if!! 
(!! 

delSuccess!! "
)!!" #
{"" 
res## 
.## 
Data##  
=##! "
true### '
;##' (
}$$ 
}%% 
else&& 
{&& 
res'' 
.'' 

StatusCode'' "
=''# $
(''% &
int''& )
)'') *

ResultCode''* 4
.''4 5
NotHaveRight''5 A
;''A B
}(( 
})) 
else** 
{** 
res++ 
.++ 

StatusCode++ 
=++  
(++! "
int++" %
)++% &

ResultCode++& 0
.++0 1
Failed++1 7
;++7 8
},, 
return-- 
res-- 
;-- 
}.. 	
public00 
ServiceResult00 
GetWishlistByUserId00 0
(000 1
Guid001 5
userId006 <
)00< =
{11 	
var22 
res22 
=22 
new22 
ServiceResult22 '
(22' (
)22( )
;22) *
res33 
.33 
Data33 
=33 
_DLWishlist33 "
.33" #
GetWishlistByUserId33# 6
(336 7
userId337 =
)33= >
;33> ?
return44 
res44 
;44 
}55 	
}66 
}77 ü%
rD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\Login\BLLogin.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
.+ ,
Login, 1
{ 
public 

class 
BLLogin 
: 
BLBase !
<! "

LoginParam" ,
,, -

LoginParam. 8
>8 9
,9 :
IBLLogin; C
{ "
IAuthenticationManager "
_authenticationManager 5
;5 6
IDLUser 
_dlUser 
; 
public 
BLLogin 
( 
IDLLogin 
dLLogin  '
,' ("
IAuthenticationManager) ?!
authenticationManager@ U
,U V
IMapperV ]
mapper^ d
,d e
IDLUsere l
dLUserm s
)s t
:u v
basew {
({ |
dLLogin	| É
,
É Ñ
mapper
Ö ã
)
ã å
{ 	"
_authenticationManager "
=# $!
authenticationManager% :
;: ;
_dlUser 
= 
dLUser 
; 
} 	
public 
bool 
ChangePassword "
(" #
string# )
username* 2
,2 3
string4 :
oldPassword; F
,F G
stringH N
newPasswordO Z
,Z [
ServiceResult\ i
serviceResultj w
)w x
{ 	
returnDD 
trueDD 
;DD 
}EE 	
publicGG 
ServiceResultGG 
LoginGG "
(GG" #

LoginParamGG# -
paramGG. 3
)GG3 4
{HH 	
varII 
resII 
=II 
newII 
ServiceResultII '
(II' (
)II( )
;II) *
ifJJ 
(JJ 
!JJ 
stringJJ 
.JJ 
IsNullOrEmptyJJ %
(JJ% &
paramJJ& +
.JJ+ ,
UsernameJJ, 4
)JJ4 5
)JJ5 6
{KK 
varLL 
entityLL 
=LL 
_dlUserLL $
.LL$ %
GetUserByUserNameLL% 6
(LL6 7
paramLL7 <
.LL< =
UsernameLL= E
)LLE F
;LLF G
ifMM 
(MM 
entityMM 
!=MM 
nullMM "
)MM" #
{NN 
paramOO 
.OO 
HashPasswordOO &
=OO' (
entityOO) /
.OO/ 0
PasswordOO0 8
;OO8 9
paramPP 
.PP 
SaltPP 
=PP  
entityPP! '
.PP' (
SaltPP( ,
;PP, -
ifQQ 
(QQ 
PasswordHashQQ $
.QQ$ %
VerifyQQ% +
(QQ+ ,
paramQQ, 1
)QQ1 2
)QQ2 3
{RR 
varSS 
accessTokenSS '
=SS( )"
_authenticationManagerSS* @
.SS@ A
AuthenticateSSA M
(SSM N
entitySSN T
.SST U
UserIdSSU [
.SS[ \
ToStringSS\ d
(SSd e
)SSe f
,SSf g
entitySSg m
.SSm n
UserNameSSn v
,SSv w
entitySSx ~
.SS~ 
Password	SS á
)
SSá à
;
SSà â
resTT 
.TT 
DataTT  
=TT! "
newTT# &
{TT' (
accessTokenTT) 4
=TT5 6
accessTokenTT7 B
,TTB C
UserTTC G
=TTH I
entityTTJ P
}TTQ R
;TTR S
}UU 
elseVV 
{WW 
resXX 
.XX 

StatusCodeXX &
=XX' (
(XX) *
intXX* -
)XX- .
EnumerationXX. 9
.XX9 :

ResultCodeXX: D
.XXD E
PasswordNotCorrectXXE W
;XXW X
}YY 
}ZZ 
else[[ 
{\\ 
res]] 
.]] 

StatusCode]] "
=]]# $
(]]% &
int]]& )
)]]) *
Enumeration]]* 5
.]]5 6

ResultCode]]6 @
.]]@ A
UserNotFound]]A M
;]]M N
}^^ 
}__ 
else`` 
{aa 
rescc 
.cc 

StatusCodecc 
=cc  
(cc! "
intcc" %
)cc% &
Enumerationcc& 1
.cc1 2

ResultCodecc2 <
.cc< =
NotTrueParamcc= I
;ccI J
}dd 
returnff 
resff 
;ff 
}gg 	
}ii 
}jj Ø
áD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\Authentication\IAuthenticationManager.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface "
IAuthenticationManager +
{ 
public		 
Object		 
Authenticate		 "
(		" #
string		# )
userId		* 0
,		0 1
string		1 7
username		8 @
,		@ A
string		B H
password		I Q
)		Q R
;		R S
}

 
} è
lD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLAddress.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{		 
public

 

	interface

 

IBLAddress

 
{ 
List 
< 
Province 
> 
GetProvinces #
(# $
string$ *
filePath+ 3
)3 4
;4 5
List 
< 
District 
> 
GetDistricts #
(# $
string$ *
filePath+ 3
)3 4
;4 5
List 
< 
District 
>  
GetDistrictsByParent +
(+ ,
string, 2
rootFilePath3 ?
,? @
stringA G

parentCodeH R
)R S
;S T
List 
< 
Ward 
> 
GetWards 
( 
string #
filePath$ ,
), -
;- .
List 
< 
Ward 
> 
GetWardsByParent #
(# $
string$ *
rootFilePath+ 7
,7 8
string9 ?

parentCode@ J
)J K
;K L
} 
} Ë
iD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLBase.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLBase 
< 
TEntity $
,$ %
TDTO% )
>) *
{		 
IEnumerable

 
<

 
TDTO

 
>

 
GetAll

  
(

  !
)

! "
;

" #
TDTO 
GetByID 
( 
string 
Id 
) 
;  
bool 
Delete 
( 
TEntity 
entity "
)" #
;# $
bool 
Update 
( 
TDTO 
entity 
,  
string  &
id' )
)) *
;* +
bool 
Insert 
( 
TDTO 
entity 
)  
;  !
IEnumerable 
< 
TEntity 
> 
GetByKey %
(% &
string& ,
key- 0
,0 1
string2 8
value9 >
)> ?
;? @
TEntity 
GetOneByKey 
( 
string "
key# &
,& '
string( .
value/ 4
)4 5
;5 6
bool 
Validate 
( 
TDTO 
entity !
)! "
;" #
bool 
ValidateCustom 
( 
TDTO  
entity! '
)' (
;( )
bool 
BeforeInsert 
( 
ref 
TDTO "
entity# )
)) *
;* +
bool 
BeforeUpdate 
( 
ref 
TEntity %
entity& ,
), -
;- .
ServiceResult 
GetByPaging !
(! "
int" %
page& *
,* +
int, /
pageSize0 8
)8 9
;9 :
} 
} ÿ
qD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLConversation.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLConversation $
:% &
IBLBase' .
<. /
Conversation/ ;
,; <
ConversationDTO= L
>L M
{		 
Conversation

 
GetConversation

 $
(

$ %
string

% +
userId1

, 3
,

3 4
string

5 ;
userId2

< C
)

C D
;

D E
List 
< 
Conversation 
> "
GetAllConversationUser 1
(1 2
string2 8
userId9 ?
)? @
;@ A
Guid 
InitChat 
( 
string 
userRecievedId +
,+ ,
string- 3

userSendId4 >
)> ?
;? @
} 
} √
iD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLFile.cs
	namespace

 	
PTDuc


 
.

 

WhereHouse

 
.

 
BL

 
.

 

Interfaces

 (
{ 
public 

	interface 
IBLFile 
: 
IBLBase %
<% &
File& *
,* +
FileDTO+ 2
>2 3
{ 
ServiceResult 

UploadFile  
(  !

FileUpload! +

fileUpload, 6
,6 7
string7 =
webRootPath> I
,I J
stringJ P

folderPathQ [
)[ \
;\ ]
ServiceResult 

DeleteFile  
(  !

FileUpload! +

fileUpload, 6
,6 7
string7 =
webRootPath> I
)I J
;J K
} 
} ä
jD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLHouse.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLHouse 
: 
IBLBase  '
<' (
House( -
,- .
HouseDTO. 6
>6 7
{ 
IEnumerable		 
<		 
House		 
>		 
GetDeepData		 &
(		& '
)		' (
;		( )
bool 

AddNewPost 
( 
HouseDTO  
dataForPost! ,
), -
;- .
} 
} Ñ
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLHouseType.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLHouseType !
:" #
IBLBase$ +
<+ ,
	HouseType, 5
,5 6
HouseTypeDTO7 C
>C D
{ 
} 
} “
lD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLMessage.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 

IBLMessage 
:  !
IBLBase" )
<) *
Message* 1
,1 2

MessageDTO3 =
>= >
{ 
object		 
GetConversation		 
(		 

MessageDTO		 )
message		* 1
)		1 2
;		2 3
List

 
<

 
Message

 
>

 '
GetMessagesByConversationId

 1
(

1 2
string

2 8
conversationId

9 G
)

G H
;

H I
} 
} €	
iD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLPost.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLPost 
: 
IBLBase &
<& '
Post' +
,+ ,
PostDTO- 4
>4 5
{		 
public

 
ServiceResult

 
GetUserPost

 (
(

( )
Guid

) -
userId

. 4
)

4 5
;

5 6
public 
ServiceResult 
DeletePostUser +
(+ ,
string, 2
postId3 9
,9 :
string; A
userIdB H
)H I
;I J
public 
ServiceResult 

AcceptPost '
(' (
string( .
postId/ 5
,5 6
string7 =
userId> D
)D E
;E F
public 
ServiceResult 
GetListPostForAdmin 0
(0 1
string1 7
adminId8 ?
)? @
;@ A
} 
} Ê
iD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLUser.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLUser 
: 
IBLBase &
<& '
User' +
,+ ,
UserDTO- 4
>4 5
{		 
void

 
AddUserToListOnline

  
(

  !
UserDTO

! (
user

) -
)

- .
;

. /
void $
RemoveUserFromListOnline %
(% &
UserDTO& -
user. 2
)2 3
;3 4
List 
< 
UserDTO 
> 
GetListUserOnline '
(' (
)( )
;) *
public 
ServiceResult 
	BlockUser &
(& '
string' -
blockUserId. 9
,9 :
string; A
adminIdB I
)I J
;J K
public 
ServiceResult 
InsertAdmin (
(( )
UserDTO) 0
user1 5
,5 6
string7 =
adminId> E
)E F
;F G
public 
ServiceResult 
GetListUserForAdmin 0
(0 1
string1 7
adminId8 ?
)? @
;@ A
} 
} Ç
mD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLWishlist.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLWishlist  
:! "
IBLBase# *
<* +
Wishlist+ 3
,3 4
WishlistDTO5 @
>@ A
{		 
public

 
ServiceResult

 
GetWishlistByUserId

 0
(

0 1
Guid

1 5
userId

6 <
)

< =
;

= >
public 
ServiceResult 
DeletePostWishlist /
(/ 0
string0 6

wishListId7 A
,A B
stringC I
userIdJ P
)P Q
;Q R
} 
} Ï
pD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\Login\IBLLogin.cs
	namespace		 	
PTDuc		
 
.		 

WhereHouse		 
.		 
BL		 
.		 

Interfaces		 (
.		( )
Login		) .
{

 
public 

	interface 
IBLLogin 
: 
IBLBase  '
<' (

LoginParam( 2
,2 3

LoginParam3 =
>= >
{ 
ServiceResult 
Login 
( 

LoginParam &
entity' -
)- .
;. /
bool 
ChangePassword 
( 
string "
username# +
,+ ,
string- 3
oldPassword4 ?
,? @
stringA G
newPasswordH S
,S T
ServiceResultU b
serviceResultc p
)p q
;q r
} 
} ì
zD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\MIddlewares\ErrorHandlingMiddleware.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
MIddlewares )
{ 
public 

class #
ErrorHandlingMiddleware (
{ 
private 
readonly 
RequestDelegate (
next) -
;- .
public #
ErrorHandlingMiddleware &
(& '
RequestDelegate' 6
next7 ;
); <
{ 	
this 
. 
next 
= 
next 
; 
} 	
public 
async 
Task 
Invoke  
(  !
HttpContext! ,
context- 4
)M N
{ 	
try 
{ 
await 
next 
( 
context "
)" #
;# $
} 
catch 
( 
	Exception 
ex 
)  
{ 
await  
HandleExceptionAsync *
(* +
context+ 2
,2 3
ex4 6
)6 7
;7 8
} 
} 	
private!! 
static!! 
Task!!  
HandleExceptionAsync!! 0
(!!0 1
HttpContext!!1 <
context!!= D
,!!D E
	Exception!!F O
ex!!P R
)!!R S
{"" 	
var## 
code## 
=## 
HttpStatusCode## %
.##% &
InternalServerError##& 9
;##9 :
var(( 
result(( 
=(( 
JsonConvert(( $
.(($ %
SerializeObject((% 4
(((4 5
new)) 
ServiceResult)) 
{** 
Data++ 
=++ 
new++ 
{,, 
devMsg-- 
=-- 
ex-- 
.--  
Message--  '
,--' (
cusMsg.. 
=.. 
$str.. E
}// 
,// 
	Messenger00 
=00 
$str00 D
}11 
)22 
;22 
context33 
.33 
Response33 
.33 
ContentType33 (
=33) *
$str33+ =
;33= >
context44 
.44 
Response44 
.44 

StatusCode44 '
=44( )
(44* +
int44+ .
)44. /
code44/ 3
;443 4
return55 
context55 
.55 
Response55 #
.55# $

WriteAsync55$ .
(55. /
result55/ 5
)555 6
;556 7
}66 	
}77 
}88 