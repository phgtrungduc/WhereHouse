Ù
âD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\Authentication\AuthenticationManager.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{		 
public

 

class

 !
AuthenticationManager

 &
:

' ("
IAuthenticationManager

) ?
{ 
private 
string 
key 
; 
public !
AuthenticationManager $
($ %
string% +
key, /
)/ 0
{ 	
this 
. 
key 
= 
key 
; 
} 	
public 
object 
Authenticate "
(" #
string# )
userId* 0
,0 1
string1 7
username8 @
,@ A
stringB H
passwordI Q
)Q R
{ 	
var 
tokenHandler 
= 
new "#
JwtSecurityTokenHandler# :
(: ;
); <
;< =
var 
tokenKey 
= 
Encoding #
.# $
ASCII$ )
.) *
GetBytes* 2
(2 3
key3 6
)6 7
;7 8
var 
tokenDescriptor 
=  !
new" %#
SecurityTokenDescriptor& =
{ 
Subject 
= 
new 
ClaimsIdentity ,
(, -
new- 0
Claim1 6
[6 7
]7 8
{9 :
new 
Claim !
(! "
$str" ,
,, -
username. 6
)6 7
,7 8
new 
Claim !
(! "
$str" *
,* +
userId, 2
)2 3
} 
) 
, 
Expires 
= 
DateTime "
." #
UtcNow# )
.) *
AddYears* 2
(2 3
$num3 4
)4 5
,5 6
SigningCredentials "
=# $
new% (
SigningCredentials) ;
(; <
new  
SymmetricSecurityKey ,
(, -
tokenKey- 5
)5 6
,6 7
SecurityAlgorithms "
." #
HmacSha256Signature# 6
)6 7
}   
;   
var!! 
token!! 
=!! 
tokenHandler!! $
.!!$ %
CreateToken!!% 0
(!!0 1
tokenDescriptor!!1 @
)!!@ A
;!!A B
return"" 
tokenHandler"" 
.""  

WriteToken""  *
(""* +
token""+ 0
)""0 1
;""1 2
}## 	
}$$ 
}%% ÷7
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLAddress.cs
	namespace		 	
PTDuc		
 
.		 

WhereHouse		 
.		 
BL		 
.		 
BusinessLayer		 +
{

 
public 

class 
	BLAddress 
: 

IBLAddress '
{ 
public 
List 
< 
Province 
> 
GetProvinces *
(* +
string+ 1
filePath2 :
): ;
{ 	
List 
< 
Province 
> 
res 
=  
null! %
;% &
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
filePath& .
). /
)/ 0
{ 
res 
= 
this 
. 
ReadFileJson '
<' (
Province( 0
>0 1
(1 2
filePath2 :
): ;
;; <
} 
return 
res 
; 
} 	
public 
List 
< 
District 
> 
GetDistricts *
(* +
string+ 1
filePath2 :
): ;
{ 	
List 
< 
District 
> 
res 
=  
null! %
;% &
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
filePath& .
). /
)/ 0
{ 
res 
= 
this 
. 
ReadFileJson '
<' (
District( 0
>0 1
(1 2
filePath2 :
): ;
;; <
} 
return 
res 
; 
} 	
public   
List   
<   
Ward   
>   
GetWards   "
(  " #
string  # )
filePath  * 2
)  2 3
{!! 	
List"" 
<"" 
Ward"" 
>"" 
res"" 
="" 
null"" !
;""! "
if## 
(## 
!## 
string## 
.## 
IsNullOrEmpty## %
(##% &
filePath##& .
)##. /
)##/ 0
{$$ 
res%% 
=%% 
this%% 
.%% 
ReadFileJson%% '
<%%' (
Ward%%( ,
>%%, -
(%%- .
filePath%%. 6
)%%6 7
;%%7 8
}&& 
return'' 
res'' 
;'' 
}(( 	
public** 
List** 
<** 
District** 
>**  
GetDistrictsByParent** 2
(**2 3
string**3 9
rootFilePath**: F
,**F G
string**H N

parentCode**O Y
)**Y Z
{++ 	
List,, 
<,, 
District,, 
>,, 
res,, 
=,,  
null,,! %
;,,% &
if-- 
(-- 
!-- 
string-- 
.-- 
IsNullOrEmpty-- %
(--% &

parentCode--& 0
)--0 1
)--1 2
{.. 
var// 
filePath// 
=// 
Path// #
.//# $
Combine//$ +
(//+ ,
rootFilePath//, 8
,//8 9

parentCode//: D
+//E F
$str//G N
)//N O
;//O P
if00 
(00 
File00 
.00 
Exists00 
(00  
filePath00  (
)00( )
)00) *
{11 
res22 
=22 
this22 
.22 
ReadFileJson22 +
<22+ ,
District22, 4
>224 5
(225 6
filePath226 >
)22> ?
;22? @
}33 
}44 
return55 
res55 
;55 
}66 	
public88 
List88 
<88 
Ward88 
>88 
GetWardsByParent88 *
(88* +
string88+ 1
rootFilePath882 >
,88> ?
string88@ F

parentCode88G Q
)88Q R
{99 	
List:: 
<:: 
Ward:: 
>:: 
res:: 
=:: 
null:: !
;::! "
if;; 
(;; 
!;; 
string;; 
.;; 
IsNullOrEmpty;; %
(;;% &

parentCode;;& 0
);;0 1
);;1 2
{<< 
var== 
filePath== 
=== 
Path== #
.==# $
Combine==$ +
(==+ ,
rootFilePath==, 8
,==8 9

parentCode==: D
+==E F
$str==G N
)==N O
;==O P
if>> 
(>> 
File>> 
.>> 
Exists>> 
(>>  
filePath>>  (
)>>( )
)>>) *
{?? 
res@@ 
=@@ 
this@@ 
.@@ 
ReadFileJson@@ +
<@@+ ,
Ward@@, 0
>@@0 1
(@@1 2
filePath@@2 :
)@@: ;
;@@; <
}AA 
}BB 
returnCC 
resCC 
;CC 
}DD 	
publicFF 
ListFF 
<FF 
TTypeFF 
>FF 
ReadFileJsonFF '
<FF' (
TTypeFF( -
>FF- .
(FF. /
stringFF/ 5
filePathFF6 >
)FF> ?
{GG 	
ListHH 
<HH 
TTypeHH 
>HH 
resHH 
=HH 
nullHH "
;HH" #
usingII 
(II 
StreamReaderII 
rII  !
=II" #
newII$ '
StreamReaderII( 4
(II4 5
filePathII5 =
)II= >
)II> ?
{JJ 
stringKK 
jsonKK 
=KK 
rKK 
.KK  
	ReadToEndKK  )
(KK) *
)KK* +
;KK+ ,
ifLL 
(LL 
!LL 
stringLL 
.LL 
IsNullOrEmptyLL )
(LL) *
jsonLL* .
)LL. /
)LL/ 0
{MM 
varNN 
dataNN 
=NN 
JsonConvertNN *
.NN* +
DeserializeObjectNN+ <
<NN< =

DictionaryNN= G
<NNG H
stringNNH N
,NNN O
TTypeNNP U
>NNU V
>NNV W
(NNW X
jsonNNX \
)NN\ ]
;NN] ^
resOO 
=OO 
dataOO 
.OO 
SelectOO %
(OO% &
xOO& '
=>OO( *
xOO+ ,
.OO, -
ValueOO- 2
)OO2 3
.OO3 4
ToListOO4 :
(OO: ;
)OO; <
;OO< =
}PP 
}QQ 
returnRR 
resRR 
;RR 
}SS 	
}TT 
}UU ˘b
kD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLBase.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLBase 
< 
TEntity 
,  
TDTO! %
>% &
:' (
IBLBase) 0
<0 1
TEntity1 8
,8 9
TDTO9 =
>= >
{ 
	protected 
IDLBase 
< 
TEntity !
,! "
TDTO" &
>& '
_dlBase( /
;/ 0
	protected 
ServiceResult 
_serviceResult  .
=/ 0
new1 4
ServiceResult5 B
(B C
)C D
;D E
	protected 
readonly 
IMapper "
_mapper# *
;* +
public 
BLBase 
( 
IDLBase 
< 
TEntity %
,% &
TDTO' +
>+ ,
dlBase- 3
,3 4
IMapper5 <
mapper= C
)C D
{ 	
_dlBase 
= 
dlBase 
; 
_mapper 
= 
mapper 
; 
} 	
public 
virtual 
bool 
BeforeInsert (
(( )
ref) ,
TEntity- 4
entity5 ;
); <
{ 	
return 
true 
; 
} 	
public   
bool   
BeforeUpdate    
(    !
ref  ! $
TEntity  % ,
entity  - 3
)  3 4
{!! 	
return"" 
true"" 
;"" 
}## 	
public%% 
bool%% 
Delete%% 
(%% 
TEntity%% "
entity%%# )
)%%) *
{&& 	
return'' 
_dlBase'' 
.'' 
Delete'' !
(''! "
entity''" (
)''( )
;'') *
}(( 	
public** 
IEnumerable** 
<** 
TDTO** 
>**  
GetAll**! '
(**' (
)**( )
{++ 	
var,, 
res,, 
=,, 
_dlBase,, 
.,, 
GetAll,, $
(,,$ %
),,% &
;,,& '
return-- 
res-- 
;-- 
}.. 	
public00 
ServiceResult00 
GetByPaging00 (
(00( )
int00) ,
page00- 1
,001 2
int003 6
pageSize007 ?
)00? @
{11 	
return22 
_dlBase22 
.22 
GetByPaging22 &
(22& '
page22' +
,22+ ,
pageSize22, 4
)224 5
;225 6
}33 	
public55 
TDTO55 
GetByID55 
(55 
string55 "
Id55# %
)55% &
{66 	
var77 
data77 
=77 
_dlBase77 
.77 
GetByID77 &
(77& '
Id77' )
)77) *
;77* +
var88 
res88 
=88 
default88 
(88 
TDTO88 "
)88" #
;88# $
if99 
(99 
data99 
!=99 
null99 
)99 
{99 
res:: 
=:: 
_mapper:: 
.:: 
Map:: !
<::! "
TDTO::" &
>::& '
(::' (
data::( ,
)::, -
;::- .
};; 
return<< 
res<< 
;<< 
}== 	
public?? 
IEnumerable?? 
<?? 
TEntity?? "
>??" #
GetByKey??$ ,
(??, -
string??- 3
key??4 7
,??7 8
string??9 ?
value??@ E
)??E F
{@@ 	
varAA 
resAA 
=AA 
_dlBaseAA 
.AA 
GetByKeyAA &
(AA& '
keyAA' *
,AA* +
valueAA, 1
)AA1 2
;AA2 3
returnBB 
resBB 
;BB 
}CC 	
publicEE 
TEntityEE 
GetOneByKeyEE "
(EE" #
stringEE# )
keyEE* -
,EE- .
stringEE/ 5
valueEE6 ;
)EE; <
{FF 	
varGG 
resGG 
=GG 
_dlBaseGG 
.GG 
GetOneByKeyGG )
(GG) *
keyGG* -
,GG- .
valueGG/ 4
)GG4 5
;GG5 6
returnHH 
resHH 
;HH 
}II 	
publicKK 
virtualKK 
boolKK 
InsertKK "
(KK" #
TEntityKK# *
entityKK+ 1
)KK1 2
{LL 	
varMM 
resMM 
=MM 
falseMM 
;MM 
ifNN 
(NN 
thisNN 
.NN 
ValidateNN 
(NN 
entityNN $
)NN$ %
)NN% &
{OO 
ifPP 
(PP 
thisPP 
.PP 
ValidateCustomPP '
(PP' (
entityPP( .
)PP. /
)PP/ 0
{QQ 
ifRR 
(RR 
thisRR 
.RR 
BeforeInsertRR )
(RR) *
refRR* -
entityRR. 4
)RR4 5
)RR5 6
{SS 
resTT 
=TT 
_dlBaseTT %
.TT% &
InsertTT& ,
(TT, -
entityTT- 3
)TT3 4
;TT4 5
}UU 
}VV 
}WW 
returnXX 
resXX 
;XX 
}YY 	
public[[ 
bool[[ 
Update[[ 
([[ 
TEntity[[ "
entity[[# )
)[[) *
{\\ 	
throw]] 
new]] #
NotImplementedException]] -
(]]- .
)]]. /
;]]/ 0
}^^ 	
publicaa 
boolaa 
Validateaa 
(aa 
TEntityaa $
entityaa% +
)aa+ ,
{bb 	
varcc 
mesArrayErrorcc 
=cc 
newcc  #
Listcc$ (
<cc( )
stringcc) /
>cc/ 0
(cc0 1
)cc1 2
;cc2 3
vardd 

isValidatedd 
=dd 
truedd !
;dd! "
varff 

propertiesff 
=ff 
entityff #
.ff# $
GetTypeff$ +
(ff+ ,
)ff, -
.ff- .
GetPropertiesff. ;
(ff; <
)ff< =
;ff= >
foreachii 
(ii 
varii 
propertyii !
inii" $

propertiesii% /
)ii/ 0
{jj 
varkk 
propertyValuekk !
=kk" #
propertykk$ ,
.kk, -
GetValuekk- 5
(kk5 6
entitykk6 <
)kk< =
;kk= >
varll 
propertyNamell  
=ll! "
propertyll# +
.ll+ ,
Namell, 0
;ll0 1
varnn 
displayNamenn 
=nn  !
propertynn" *
.nn* +
GetCustomAttributesnn+ >
(nn> ?
falsenn? D
)nnD E
.oo 
OfTypeoo 
<oo  
DisplayNameAttributeoo ,
>oo, -
(oo- .
)oo. /
.pp 
FirstOrDefaultpp 
(pp  
)pp  !
;pp! "
;pp# $
ifss 
(ss 
propertyss 
.ss 
	IsDefinedss &
(ss& '
typeofss' -
(ss- .
Requiredss. 6
)ss6 7
,ss7 8
falsess9 >
)ss> ?
)ss? @
{tt 
ifvv 
(vv 
propertyValuevv %
==vv& (
nullvv) -
)vv- .
{ww 

isValidatexx "
=xx# $
falsexx% *
;xx* +
ifyy 
(yy 
displayNameyy '
!=yy( *
nullyy+ /
)yy/ 0
{zz 
mesArrayError{{ )
.{{) *
Add{{* -
({{- .
$"{{. 0
$str{{0 :
{{{: ;
displayName{{; F
.{{F G
DisplayName{{G R
}{{R S
$str{{S m
"{{m n
){{n o
;{{o p
}|| 
_serviceResult}} &
.}}& '
	Messenger}}' 0
=}}1 2
$str}}3 I
;}}I J
}~~ 
} 
if
ÅÅ 
(
ÅÅ 
property
ÅÅ 
.
ÅÅ 
	IsDefined
ÅÅ &
(
ÅÅ& '
typeof
ÅÅ' -
(
ÅÅ- .
CheckDuplicate
ÅÅ. <
)
ÅÅ< =
,
ÅÅ= >
false
ÅÅ? D
)
ÅÅD E
)
ÅÅE F
{
ÇÇ 
var
ÑÑ 
entityDuplicate
ÑÑ '
=
ÑÑ( )
GetByKey
ÑÑ* 2
(
ÑÑ2 3
propertyName
ÑÑ3 ?
,
ÑÑ? @
propertyValue
ÑÑA N
.
ÑÑN O
ToString
ÑÑO W
(
ÑÑW X
)
ÑÑX Y
)
ÑÑY Z
;
ÑÑZ [
if
ÜÜ 
(
ÜÜ 
entityDuplicate
ÜÜ '
!=
ÜÜ( *
null
ÜÜ+ /
)
ÜÜ/ 0
{
áá 

isValidate
àà "
=
àà# $
false
àà% *
;
àà* +
mesArrayError
ââ %
.
ââ% &
Add
ââ& )
(
ââ) *
$"
ââ* ,
$str
ââ, 6
{
ââ6 7
displayName
ââ7 B
.
ââB C
DisplayName
ââC N
}
ââN O
$str
ââO d
"
ââd e
)
ââe f
;
ââf g
}
ãã 
}
åå 
if
éé 
(
éé 
property
éé 
.
éé 
	IsDefined
éé &
(
éé& '
typeof
éé' -
(
éé- .
	MaxLength
éé. 7
)
éé7 8
,
éé8 9
false
éé: ?
)
éé? @
)
éé@ A
{
èè 
var
ëë  
attributeMaxLength
ëë *
=
ëë+ ,
property
ëë- 5
.
ëë5 6!
GetCustomAttributes
ëë6 I
(
ëëI J
typeof
ëëJ P
(
ëëP Q
	MaxLength
ëëQ Z
)
ëëZ [
,
ëë[ \
true
ëë] a
)
ëëa b
[
ëëb c
$num
ëëc d
]
ëëd e
;
ëëe f
var
íí 
length
íí 
=
íí  
(
íí! " 
attributeMaxLength
íí" 4
as
íí5 7
	MaxLength
íí8 A
)
ííA B
.
ííB C
Value
ííC H
;
ííH I
var
ìì 
msg
ìì 
=
ìì 
(
ìì  
attributeMaxLength
ìì 1
as
ìì2 4
	MaxLength
ìì5 >
)
ìì> ?
.
ìì? @
ErrorMsg
ìì@ H
;
ììH I
if
îî 
(
îî 
propertyValue
îî %
.
îî% &
ToString
îî& .
(
îî. /
)
îî/ 0
.
îî0 1
Trim
îî1 5
(
îî5 6
)
îî6 7
.
îî7 8
Length
îî8 >
>
îî? @
length
îîA G
)
îîG H
{
ïï 

isValidate
ññ "
=
ññ# $
false
ññ% *
;
ññ* +
mesArrayError
óó %
.
óó% &
Add
óó& )
(
óó) *
msg
óó* -
??
óó. 0
$"
óó1 3
$str
óó3 =
{
óó= >
displayName
óó> I
.
óóI J
DisplayName
óóJ U
}
óóU V
$str
óóV `
{
óó` a
length
óóa g
}
óóg h
$str
óóh x
"
óóx y
)
óóy z
;
óóz {
_serviceResult
òò &
.
òò& '
	Messenger
òò' 0
=
òò1 2
$str
òò3 W
;
òòW X
}
ôô 
}
öö 
}
¨¨ 
_serviceResult
≠≠ 
.
≠≠ 
Data
≠≠ 
=
≠≠  !
mesArrayError
≠≠" /
;
≠≠/ 0
if
±± 
(
±± 

isValidate
±± 
==
±± 
true
±± "
)
±±" #

isValidate
±±$ .
=
±±/ 0
this
±±1 5
.
±±5 6
ValidateCustom
±±6 D
(
±±D E
entity
±±E K
)
±±K L
;
±±L M
return
≤≤ 

isValidate
≤≤ 
;
≤≤ 
}
≥≥ 	
public
µµ 
bool
µµ 
ValidateCustom
µµ "
(
µµ" #
TEntity
µµ# *
entity
µµ+ 1
)
µµ1 2
{
∂∂ 	
return
∑∑ 
true
∑∑ 
;
∑∑ 
}
∏∏ 	
}
ππ 
}∫∫ ∂
sD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLConversation.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLConversation 
:  !
BLBase" (
<( )
Conversation) 5
,5 6
ConversationDTO7 F
>F G
,G H
IBLConversationI X
{ 
IDLConversation 
_DLConversation '
;' (
public 
BLConversation 
( 
IDLConversation -
DLConversation. <
,< =
IMapper> E
mapperF L
)L M
:N O
baseP T
(T U
DLConversationU c
,c d
mappere k
)k l
{ 	
_DLConversation 
= 
DLConversation ,
;, -
} 	
} 
} «9
kD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLFile.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLFile 
: 
BLBase  
<  !
	DBContext! *
.* +
Models+ 1
.1 2
File2 6
,6 7
FileDTO8 ?
>? @
,@ A
IBLFileB I
{ 
IDLFile 
_dlFile 
; 
public 
BLFile 
( 
IDLFile 
dlFile $
,$ %
IMapper& -
mapper. 4
)4 5
:6 7
base8 <
(< =
dlFile= C
,C D
mapperE K
)K L
{ 	
_dlFile 
= 
dlFile 
; 
} 	
public 
ServiceResult 

DeleteFile '
(' (

FileUpload( 2

fileUpload3 =
,= >
string? E
webRootPathF Q
)Q R
{ 	
var 
res 
= 
new 
ServiceResult '
(' (
)( )
;) *
try 
{ 
var 
webFilePath 
=  !
Path" &
.& '
Combine' .
(. /
webRootPath/ :
,: ;

fileUpload< F
.F G
filePathG O
)O P
;P Q
if   
(   
!   
System   
.   
IO   
.   
File   #
.  # $
Exists  $ *
(  * +
webFilePath  + 6
)  6 7
)  7 8
{!! 
res"" 
."" 

StatusCode"" "
=""# $
(""% &
int""& )
)"") *
Enumeration""* 5
.""5 6

ResultCode""6 @
.""@ A
NotExistFile""A M
;""M N
res## 
.## 
Data## 
=## 
false## $
;##$ %
}$$ 
else%% 
{&& 
System'' 
.'' 
IO'' 
.'' 
File'' "
.''" #
Delete''# )
('') *
webFilePath''* 5
)''5 6
;''6 7
res(( 
.(( 
Data(( 
=(( 
true(( #
;((# $
var)) 
insertSuccess)) %
=))& '
this))( ,
.)), -
Delete))- 3
())3 4
new))4 7
	DBContext))8 A
.))A B
Models))B H
.))H I
File))I M
{))N O
FileId))P V
=))W X

fileUpload))Y c
.))c d
FileId))d j
.))j k
Value))k p
}))q r
)))r s
;))s t
if** 
(** 
insertSuccess** %
)**% &
{++ 
res,, 
.,, 
Data,,  
=,,! "
true,,# '
;,,' (
}-- 
else.. 
{// 
res00 
.00 
Data00  
=00! "
false00# (
;00( )
}11 
}22 
}33 
catch44 
(44 
	Exception44 
e44 
)44 
{55 
res66 
.66 
Data66 
=66 
e66 
;66 
res77 
.77 

StatusCode77 
=77  
(77! "
int77" %
)77% &
Enumeration77& 1
.771 2

ResultCode772 <
.77< =
Failed77= C
;77C D
}88 
return99 
res99 
;99 
}:: 	
public<< 
ServiceResult<< 

UploadFile<< '
(<<' (

FileUpload<<( 2

fileUpload<<3 =
,<<= >
string<<? E
webRootPath<<F Q
,<<Q R
string<<S Y

folderPath<<Z d
)<<d e
{== 	
var>> 
res>> 
=>> 
new>> 
ServiceResult>> '
(>>' (
)>>( )
;>>) *
var?? 
webFolderPath?? 
=?? 
Path??  $
.??$ %
Combine??% ,
(??, -
webRootPath??- 8
,??8 9

folderPath??: D
)??D E
;??E F
if@@ 
(@@ 
!@@ 
	Directory@@ 
.@@ 
Exists@@ !
(@@! "
webFolderPath@@" /
)@@/ 0
)@@0 1
	DirectoryAA 
.AA 
CreateDirectoryAA )
(AA) *
webFolderPathAA* 7
)AA7 8
;AA8 9
varBB 
fileBB 
=BB 

fileUploadBB !
.BB! "
fileBB" &
;BB& '
varCC 
fileNameCC 
=CC 
GuidCC 
.CC  
NewGuidCC  '
(CC' (
)CC( )
+CC* +
PathCC, 0
.CC0 1
GetExtensionCC1 =
(CC= >
fileCC> B
.CCB C
FileNameCCC K
)CCK L
;CCL M
varDD 
filePathDD 
=DD 
PathDD 
.DD  
CombineDD  '
(DD' (

folderPathDD( 2
,DD2 3
fileNameDD4 <
)DD< =
;DD= >
varEE 
webFilePathEE 
=EE 
PathEE "
.EE" #
CombineEE# *
(EE* +
webRootPathEE+ 6
,EE6 7
filePathEE8 @
)EE@ A
;EEA B
usingFF 
(FF 
varFF 
stremFF 
=FF 
SystemFF %
.FF% &
IOFF& (
.FF( )
FileFF) -
.FF- .
CreateFF. 4
(FF4 5
webFilePathFF5 @
)FF@ A
)FFA B
{GG 
fileHH 
.HH 
CopyToHH 
(HH 
stremHH !
)HH! "
;HH" #
}II 
varJJ 
fileAddJJ 
=JJ 
newJJ 
	DBContextJJ '
.JJ' (
ModelsJJ( .
.JJ. /
FileJJ/ 3
{JJ4 5
FileIdJJ6 <
=JJ= >
GuidJJ? C
.JJC D
NewGuidJJD K
(JJK L
)JJL M
,JJM N
FileNameJJO W
=JJX Y
fileNameJJZ b
,JJb c
FilePathJJd l
=JJm n
filePathJJo w
}JJx y
;JJy z
varKK 
successKK 
=KK 
thisKK 
.KK 
InsertKK %
(KK% &
fileAddKK& -
)KK- .
;KK. /
ifLL 
(LL 
successLL 
)LL 
{MM 
resNN 
.NN 
DataNN 
=NN 
fileAddNN "
;NN" #
}OO 
elsePP 
{QQ 
resRR 
.RR 

StatusCodeRR 
=RR  
(RR! "
intRR" %
)RR% &
EnumerationRR& 1
.RR1 2

ResultCodeRR2 <
.RR< =
FailedRR= C
;RRC D
}SS 
returnTT 
resTT 
;TT 
}UU 	
}VV 
}WW ›
lD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLHouse.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLHouse 
: 
BLBase !
<! "
House" '
,' (
HouseDTO( 0
>0 1
,1 2
IBLHouse3 ;
{ 
IDLHouse 
_dlHouse 
; 
IBLWishlist 
_bLWishlist 
;  
public 
BLHouse 
( 
IDLHouse 
dLHouse  '
,' (
IBLWishlist( 3

bLWishlist4 >
,> ?
IMapper@ G
mapperH N
)N O
:P Q
baseR V
(V W
dLHouseW ^
,^ _
mapper` f
)f g
{ 	
_dlHouse 
= 
dLHouse 
; 
_bLWishlist 
= 

bLWishlist $
;$ %
} 	
public 
IEnumerable 
< 
House  
>  !
GetDeepData" -
(- .
). /
{ 	
return 
_dlHouse 
. 
GetDeepData '
(' (
)( )
;) *
} 	
} 
} Ω

nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLMessage.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
	BLMessage 
: 
BLBase #
<# $
Message$ +
,+ ,

MessageDTO- 7
>7 8
,8 9

IBLMessage: D
{ 

IDLMessage 

_DLMessage 
; 
public 
	BLMessage 
( 

IDLMessage #
	DLMessage$ -
,- .
IMapper/ 6
mapper7 =
)= >
:? @
baseA E
(E F
	DLMessageF O
,O P
mapperQ W
)W X
{ 	

_DLMessage 
= 
	DLMessage "
;" #
} 	
public 
object 
GetConversation %
(% &

MessageDTO& 0
message1 8
)8 9
{ 	
return 

_DLMessage 
. 
GetConversation -
(- .
message. 5
)5 6
;6 7
} 	
} 
} Œ
kD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLPost.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLPost 
: 
BLBase  
<  !
Post! %
,% &
PostDTO' .
>. /
,/ 0
IBLPost1 8
{ 
IDLPost 
_DLPost 
; 
public 
BLPost 
( 
IDLPost 
DLPost $
,$ %
IMapper& -
mapper. 4
)4 5
:6 7
base8 <
(< =
DLPost= C
,C D
mapperE K
)K L
{ 	
_DLPost 
= 
DLPost 
; 
} 	
} 
} ﬁ
kD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLUser.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 
BLUser 
: 
BLBase  
<  !
User! %
,% &
UserDTO& -
>- .
,. /
IBLUser/ 6
{ 
IDLUser 
_dlUser 
; 
public 
BLUser 
( 
IDLUser 
dLUser $
,$ %
IMapper& -
mapper. 4
)4 5
:6 7
base8 <
(< =
dLUser= C
,C D
mapperE K
)K L
{ 	
_dlUser 
= 
dLUser 
; 
} 	
public 
override 
bool 
BeforeInsert )
() *
ref* -
User. 2
entity3 9
)9 :
{ 	
var 
res 
= 
false 
; 
if 
( 
! 
string 
. 
IsNullOrEmpty %
(% &
entity& ,
., -
Password- 5
)5 6
)6 7
{8 9

LoginParam 

loginParam %
=& '
new( +

LoginParam, 6
(6 7
)7 8
;8 9

loginParam 
= 
PasswordHash )
.) *
HashPassword* 6
(6 7
entity7 =
.= >
Password> F
)F G
;G H
if 
( 

loginParam 
!= !
null" &
)& '
{( )
entity 
. 
Password #
=$ %

loginParam& 0
.0 1
HashPassword1 =
;= >
entity 
. 
Salt 
=  !

loginParam" ,
., -
Salt- 1
;1 2
res 
= 
true 
;  
} 
} 
return   
res   
;   
}!! 	
}"" 
}## Ç
oD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\BLWishlist.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
{ 
public 

class 

BLWishlist 
: 
BLBase $
<$ %
Wishlist% -
,- .
WishlistDTO/ :
>: ;
,; <
IBLWishlist= H
{ 
IDLWishlist 
_DLWishlist 
;  
public 

BLWishlist 
( 
IDLWishlist %

DLWishlist& 0
,0 1
IMapper2 9
mapper: @
)@ A
:B C
baseD H
(H I

DLWishlistI S
,S T
mapperU [
)[ \
{ 	
_DLWishlist 
= 

DLWishlist $
;$ %
} 	
} 
} Å&
rD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\BusinessLayer\Login\BLLogin.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
BusinessLayer +
.+ ,
Login, 1
{ 
public 

class 
BLLogin 
: 
BLBase !
<! "

LoginParam" ,
,, -

LoginParam. 8
>8 9
,9 :
IBLLogin; C
{ "
IAuthenticationManager "
_authenticationManager 5
;5 6
public 
BLLogin 
( 
IDLLogin 
dLLogin  '
,' ("
IAuthenticationManager) ?!
authenticationManager@ U
,U V
IMapperV ]
mapper^ d
)d e
:f g
baseh l
(l m
dLLoginm t
,t u
mapperv |
)| }
{ 	"
_authenticationManager "
=# $!
authenticationManager% :
;: ;
} 	
public 
bool 
ChangePassword "
(" #
string# )
username* 2
,2 3
string4 :
oldPassword; F
,F G
stringH N
newPasswordO Z
,Z [
ServiceResult\ i
serviceResultj w
)w x
{ 	
returnFF 
trueFF 
;FF 
}GG 	
publicII 
ServiceResultII 
LoginII "
(II" #

LoginParamII# -
paramII. 3
)II3 4
{JJ 	
varKK 
resKK 
=KK 
newKK 
ServiceResultKK '
(KK' (
)KK( )
;KK) *
ifLL 
(LL 
!LL 
stringLL 
.LL 
IsNullOrEmptyLL %
(LL% &
paramLL& +
.LL+ ,
UsernameLL, 4
)LL4 5
)LL5 6
{MM 
varNN 
propUsernameNN  
=NN! "
typeofNN# )
(NN) *

LoginParamNN* 4
)NN4 5
.NN5 6
GetPropertyNN6 A
(NNA B
$strNNB L
)NNL M
;NNM N
varOO 
entityOO 
=OO 
_dlBaseOO $
.OO$ %
GetOneByKeyWithTypeOO% 8
<OO8 9
UserOO9 =
>OO= >
(OO> ?
propUsernameOO? K
,OOK L
paramOOM R
)OOR S
;OOS T
ifPP 
(PP 
entityPP 
!=PP 
nullPP "
)PP" #
{QQ 
paramRR 
.RR 
HashPasswordRR &
=RR' (
entityRR) /
.RR/ 0
PasswordRR0 8
;RR8 9
paramSS 
.SS 
SaltSS 
=SS  
entitySS! '
.SS' (
SaltSS( ,
;SS, -
ifTT 
(TT 
PasswordHashTT $
.TT$ %
VerifyTT% +
(TT+ ,
paramTT, 1
)TT1 2
)TT2 3
{UU 
varVV 
accessTokenVV '
=VV( )"
_authenticationManagerVV* @
.VV@ A
AuthenticateVVA M
(VVM N
entityVVN T
.VVT U
UserIdVVU [
.VV[ \
ToStringVV\ d
(VVd e
)VVe f
,VVf g
entityVVg m
.VVm n
UserNameVVn v
,VVv w
entityVVx ~
.VV~ 
Password	VV á
)
VVá à
;
VVà â
resWW 
.WW 
DataWW  
=WW! "
newWW# &
{WW' (
accessTokenWW) 4
=WW5 6
accessTokenWW7 B
,WWB C
UserWWC G
=WWH I
entityWWJ P
}WWQ R
;WWR S
}XX 
elseYY 
{ZZ 
res[[ 
.[[ 

StatusCode[[ &
=[[' (
([[) *
int[[* -
)[[- .
Enumeration[[. 9
.[[9 :

ResultCode[[: D
.[[D E
PasswordNotCorrect[[E W
;[[W X
}\\ 
}]] 
else^^ 
{__ 
res`` 
.`` 

StatusCode`` "
=``# $
(``% &
int``& )
)``) *
Enumeration``* 5
.``5 6

ResultCode``6 @
.``@ A
UserNotFound``A M
;``M N
}aa 
}bb 
elsecc 
{dd 
resff 
.ff 

StatusCodeff 
=ff  
(ff! "
intff" %
)ff% &
Enumerationff& 1
.ff1 2

ResultCodeff2 <
.ff< =
NotTrueParamff= I
;ffI J
}gg 
returnii 
resii 
;ii 
}jj 	
}ll 
}mm Ø
áD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\Authentication\IAuthenticationManager.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface "
IAuthenticationManager +
{ 
public		 
Object		 
Authenticate		 "
(		" #
string		# )
userId		* 0
,		0 1
string		1 7
username		8 @
,		@ A
string		B H
password		I Q
)		Q R
;		R S
}

 
} è
lD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLAddress.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{		 
public

 

	interface

 

IBLAddress

 
{ 
List 
< 
Province 
> 
GetProvinces #
(# $
string$ *
filePath+ 3
)3 4
;4 5
List 
< 
District 
> 
GetDistricts #
(# $
string$ *
filePath+ 3
)3 4
;4 5
List 
< 
District 
>  
GetDistrictsByParent +
(+ ,
string, 2
rootFilePath3 ?
,? @
stringA G

parentCodeH R
)R S
;S T
List 
< 
Ward 
> 
GetWards 
( 
string #
filePath$ ,
), -
;- .
List 
< 
Ward 
> 
GetWardsByParent #
(# $
string$ *
rootFilePath+ 7
,7 8
string9 ?

parentCode@ J
)J K
;K L
} 
} ƒ
iD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLBase.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLBase 
< 
TEntity $
,$ %
TDTO% )
>) *
{		 
IEnumerable

 
<

 
TDTO

 
>

 
GetAll

  
(

  !
)

! "
;

" #
TDTO 
GetByID 
( 
string 
Id 
) 
;  
bool 
Delete 
( 
TEntity 
entity "
)" #
;# $
bool 
Update 
( 
TEntity 
entity "
)" #
;# $
bool 
Insert 
( 
TEntity 
entity "
)" #
;# $
IEnumerable 
< 
TEntity 
> 
GetByKey %
(% &
string& ,
key- 0
,0 1
string2 8
value9 >
)> ?
;? @
TEntity 
GetOneByKey 
( 
string "
key# &
,& '
string( .
value/ 4
)4 5
;5 6
bool 
Validate 
( 
TEntity 
entity $
)$ %
;% &
bool 
ValidateCustom 
( 
TEntity #
entity$ *
)* +
;+ ,
bool 
BeforeInsert 
( 
ref 
TEntity %
entity& ,
), -
;- .
bool 
BeforeUpdate 
( 
ref 
TEntity %
entity& ,
), -
;- .
ServiceResult 
GetByPaging !
(! "
int" %
page& *
,* +
int, /
pageSize0 8
)8 9
;9 :
} 
} ê
qD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLConversation.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLConversation $
:% &
IBLBase' .
<. /
Conversation/ ;
,; <
ConversationDTO= L
>L M
{ 
} 
} √
iD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLFile.cs
	namespace

 	
PTDuc


 
.

 

WhereHouse

 
.

 
BL

 
.

 

Interfaces

 (
{ 
public 

	interface 
IBLFile 
: 
IBLBase %
<% &
File& *
,* +
FileDTO+ 2
>2 3
{ 
ServiceResult 

UploadFile  
(  !

FileUpload! +

fileUpload, 6
,6 7
string7 =
webRootPath> I
,I J
stringJ P

folderPathQ [
)[ \
;\ ]
ServiceResult 

DeleteFile  
(  !

FileUpload! +

fileUpload, 6
,6 7
string7 =
webRootPath> I
)I J
;J K
} 
} Ñ
jD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLHouse.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLHouse 
: 
IBLBase  '
<' (
House( -
,- .
HouseDTO. 6
>6 7
{ 
IEnumerable		 
<		 
House		 
>		 
GetDeepData		 &
(		& '
)		' (
;		( )
}

 
} á
lD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLMessage.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 

IBLMessage 
:  !
IBLBase" )
<) *
Message* 1
,1 2

MessageDTO3 =
>= >
{ 
object		 
GetConversation		 
(		 

MessageDTO		 )
message		* 1
)		1 2
;		2 3
}

 
} 
iD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLPost.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLPost 
: 
IBLBase &
<& '
Post' +
,+ ,
PostDTO- 4
>4 5
{ 
} 
} 
iD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLUser.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLUser 
: 
IBLBase &
<& '
User' +
,+ ,
UserDTO- 4
>4 5
{ 
} 
} Ä
mD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\IBLWishlist.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 

Interfaces (
{ 
public 

	interface 
IBLWishlist  
:! "
IBLBase# *
<* +
Wishlist+ 3
,3 4
WishlistDTO5 @
>@ A
{ 
} 
} Ï
pD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\Interfaces\Login\IBLLogin.cs
	namespace		 	
PTDuc		
 
.		 

WhereHouse		 
.		 
BL		 
.		 

Interfaces		 (
.		( )
Login		) .
{

 
public 

	interface 
IBLLogin 
: 
IBLBase  '
<' (

LoginParam( 2
,2 3

LoginParam3 =
>= >
{ 
ServiceResult 
Login 
( 

LoginParam &
entity' -
)- .
;. /
bool 
ChangePassword 
( 
string "
username# +
,+ ,
string- 3
oldPassword4 ?
,? @
stringA G
newPasswordH S
,S T
ServiceResultU b
serviceResultc p
)p q
;q r
} 
} ì
zD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse.BL\MIddlewares\ErrorHandlingMiddleware.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
BL 
. 
MIddlewares )
{ 
public 

class #
ErrorHandlingMiddleware (
{ 
private 
readonly 
RequestDelegate (
next) -
;- .
public #
ErrorHandlingMiddleware &
(& '
RequestDelegate' 6
next7 ;
); <
{ 	
this 
. 
next 
= 
next 
; 
} 	
public 
async 
Task 
Invoke  
(  !
HttpContext! ,
context- 4
)M N
{ 	
try 
{ 
await 
next 
( 
context "
)" #
;# $
} 
catch 
( 
	Exception 
ex 
)  
{ 
await  
HandleExceptionAsync *
(* +
context+ 2
,2 3
ex4 6
)6 7
;7 8
} 
} 	
private!! 
static!! 
Task!!  
HandleExceptionAsync!! 0
(!!0 1
HttpContext!!1 <
context!!= D
,!!D E
	Exception!!F O
ex!!P R
)!!R S
{"" 	
var## 
code## 
=## 
HttpStatusCode## %
.##% &
InternalServerError##& 9
;##9 :
var(( 
result(( 
=(( 
JsonConvert(( $
.(($ %
SerializeObject((% 4
(((4 5
new)) 
ServiceResult)) 
{** 
Data++ 
=++ 
new++ 
{,, 
devMsg-- 
=-- 
ex-- 
.--  
Message--  '
,--' (
cusMsg.. 
=.. 
$str.. E
}// 
,// 
	Messenger00 
=00 
$str00 D
}11 
)22 
;22 
context33 
.33 
Response33 
.33 
ContentType33 (
=33) *
$str33+ =
;33= >
context44 
.44 
Response44 
.44 

StatusCode44 '
=44( )
(44* +
int44+ .
)44. /
code44/ 3
;443 4
return55 
context55 
.55 
Response55 #
.55# $

WriteAsync55$ .
(55. /
result55/ 5
)555 6
;556 7
}66 	
}77 
}88 