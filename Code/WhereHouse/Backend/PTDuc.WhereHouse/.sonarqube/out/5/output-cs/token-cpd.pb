ü-
gD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\ChatHub\ChattingHub.cs
	namespace

 	
PTDuc


 
.

 

WhereHouse

 
.

 
ChatHub

 "
{ 
public 

class 
ChattingHub 
: 
Hub "
{ 
IBLUser 
_bLUser 
; 
IBLConversation 
_bLConversation '
;' (

IBLMessage 

_bLMessage 
; 
public 
ChattingHub 
( 
IBLUser "
bLUser# )
,) *
IBLConversation+ :
bLConversation; I
,I J

IBLMessageK U
	bLMessageV _
)_ `
{ 	
_bLUser 
= 
bLUser 
; 
_bLConversation 
= 
bLConversation ,
;, -

_bLMessage 
= 
	bLMessage "
;" #
} 	
public 
async 
Task 
UserOnConnected )
() *
string* 0
userId1 7
)7 8
{ 	
var 
user 
= 
_bLUser 
. 
GetByID &
(& '
userId' -
)- .
;. /
if 
( 
user 
!= 
null 
) 
{ 
await   
this   
.   

AddToGroup   %
(  % &
userId  & ,
)  , -
;  - .
var!! 
allConversation!! #
=!!$ %
_bLConversation!!& 5
.!!5 6"
GetAllConversationUser!!6 L
(!!L M
userId!!M S
)!!S T
;!!T U
allConversation## 
.##  
ForEach##  '
(##' (
async##( -
x##. /
=>##0 2
{$$ 
await%% 
this%% 
.%% 

AddToGroup%% )
(%%) *
x%%* +
.%%+ ,
ConversationId%%, :
.%%: ;
ToString%%; C
(%%C D
)%%D E
)%%E F
;%%F G
}&& 
)&& 
;&& 
}'' 
}(( 	
public** 
async** 
Task** 

AddToGroup** $
(**$ %
string**% +
	groupName**, 5
)**5 6
{++ 	
await,, 
Groups,, 
.,, 
AddToGroupAsync,, (
(,,( )
Context,,) 0
.,,0 1
ConnectionId,,1 =
,,,= >
	groupName,,? H
),,H I
;,,I J
}-- 	
public// 
async// 
Task// 
RemoveFromGroup// )
(//) *
string//* 0
	groupName//1 :
)//: ;
{00 	
await11 
Groups11 
.11  
RemoveFromGroupAsync11 -
(11- .
Context11. 5
.115 6
ConnectionId116 B
,11B C
	groupName11D M
)11M N
;11N O
await33 
Clients33 
.33 
Group33 
(33  
	groupName33  )
)33) *
.33* +
	SendAsync33+ 4
(334 5
$str335 ;
,33; <
$"33= ?
{33? @
Context33@ G
.33G H
ConnectionId33H T
}33T U
$str33U i
{33i j
	groupName33j s
}33s t
$str33t u
"33u v
)33v w
;33w x
}44 	
public66 
async66 
Task66 
SendPrivateMessage66 ,
(66, -
string66- 3

userSendId664 >
,66> ?
string66@ F
	groupName66G P
,66P Q
string66R X
message66Y `
)66` a
{77 	
await99 
Clients99 
.99 
Group99 
(99  
	groupName99  )
)99) *
.99* +
	SendAsync99+ 4
(994 5
$str995 M
,99M N

userSendId99O Y
,99Y Z
message99[ b
)99b c
;99c d
var:: 

newMessage:: 
=:: 
new::  

MessageDTO::! +
(::+ ,
)::, -
{;; 
ConversationId<< 
=<<  
Guid<<! %
.<<% &
Parse<<& +
(<<+ ,
	groupName<<, 5
)<<5 6
,<<6 7
UserId== 
=== 
Guid== 
.== 
Parse== #
(==# $

userSendId==$ .
)==. /
,==/ 0
Content>> 
=>> 
message>> !
,>>! "
Time?? 
=?? 
DateTime?? 
.??  
Now??  #
}@@ 
;@@ 

_bLMessageAA 
.AA 
InsertAA 
(AA 

newMessageAA (
)AA( )
;AA) *
}BB 	
publicDD 
asyncDD 
TaskDD 
InitPrivateChatDD )
(DD) *
stringDD* 0

userSendIdDD1 ;
,DD; <
stringDD= C
userReceivedIdDDD R
,DDR S
stringDDT Z
connectionIdDD[ g
)DDg h
{EE 	
awaitFF 
ClientsFF 
.FF 
GroupFF 
(FF  
userReceivedIdFF  .
)FF. /
.FF/ 0
	SendAsyncFF0 9
(FF9 :
$strFF: O
,FFO P
connectionIdFFQ ]
)FF] ^
;FF^ _
awaitGG 
ClientsGG 
.GG 
GroupGG 
(GG  

userSendIdGG  *
)GG* +
.GG+ ,
	SendAsyncGG, 5
(GG5 6
$strGG6 K
,GGK L
connectionIdGGM Y
)GGY Z
;GGZ [
}HH 	
}II 
}JJ Ü5
qD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\AddressController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
[ 
AllowAnonymous 
] 
[ 
ApiController 
] 
[ 
Route 

(
 
$str  
)  !
]! "
public 

class 
AddressController "
:# $

Controller% /
{ 
private 
string 

folderPath !
=" #
$str$ &
;& '

IBLAddress 

_bLAddress 
; 
public 
AddressController  
(  !
IWebHostEnvironment! 4
env5 8
,8 9

IBLAddress: D
	bLAddressE N
)N O
{P Q

folderPath 
= 
Path 
. 
Combine %
(% &
env& )
.) *
WebRootPath* 5
,5 6
$str6 <
,< =
$str> G
)G H
;H I

_bLAddress 
= 
	bLAddress "
;" #
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
IActionResult 
GetProvinces *
(* +
)+ ,
{ 	
string 
filePath 
= 
Path "
." #
Combine# *
(* +

folderPath+ 5
,5 6
$str7 E
)E F
;F G
try 
{ 
var   
res   
=   

_bLAddress   $
.  $ %
GetProvinces  % 1
(  1 2
filePath  2 :
)  : ;
;  ; <
return!! 
Ok!! 
(!! 
res!! 
)!! 
;!! 
}"" 
catch## 
(## 
	Exception## 
e## 
)## 
{$$ 
return%% 

BadRequest%% !
(%%! "
e%%" #
.%%# $
Message%%$ +
)%%+ ,
;%%, -
}&& 
}(( 	
[** 	
HttpGet**	 
(** 
$str** 
)** 
]** 
public++ 
virtual++ 
IActionResult++ $
GetDistricts++% 1
(++1 2
)++2 3
{,, 	
string-- 
filePath-- 
=-- 
Path-- "
.--" #
Combine--# *
(--* +

folderPath--+ 5
,--5 6
$str--7 H
)--H I
;--I J
try.. 
{// 
var00 
res00 
=00 

_bLAddress00 $
.00$ %
GetDistricts00% 1
(001 2
filePath002 :
)00: ;
;00; <
return11 
Ok11 
(11 
res11 
)11 
;11 
}22 
catch33 
(33 
	Exception33 
e33 
)33 
{44 
return55 

BadRequest55 !
(55! "
e55" #
.55# $
Message55$ +
)55+ ,
;55, -
}66 
}77 	
[99 	
HttpGet99	 
(99 
$str99 
)99 
]99 
public:: 
virtual:: 
IActionResult:: $
GetWards::% -
(::- .
)::. /
{;; 	
string<< 
filePath<< 
=<< 
Path<< "
.<<" #
Combine<<# *
(<<* +

folderPath<<+ 5
,<<5 6
$str<<7 G
)<<G H
;<<H I
try== 
{>> 
var?? 
res?? 
=?? 

_bLAddress?? $
.??$ %
GetWards??% -
(??- .
filePath??. 6
)??6 7
;??7 8
return@@ 
Ok@@ 
(@@ 
res@@ 
)@@ 
;@@ 
}AA 
catchBB 
(BB 
	ExceptionBB 
eBB 
)BB 
{CC 
returnDD 

BadRequestDD !
(DD! "
eDD" #
.DD# $
MessageDD$ +
)DD+ ,
;DD, -
}EE 
}FF 	
[HH 	
HttpGetHH	 
(HH 
$strHH &
)HH& '
]HH' (
publicII 
virtualII 
IActionResultII $ 
GetDistrictsByParentII% 9
(II9 :
[II: ;
	FromQueryII; D
]IID E
stringIIE K

parentCodeIIL V
)IIV W
{JJ 	
stringKK 
rootFilePathKK 
=KK  !
PathKK" &
.KK& '
CombineKK' .
(KK. /

folderPathKK/ 9
,KK9 :
$strKK; G
)KKG H
;KKH I
tryLL 
{MM 
varNN 
resNN 
=NN 

_bLAddressNN $
.NN$ % 
GetDistrictsByParentNN% 9
(NN9 :
rootFilePathNN: F
,NNF G

parentCodeNNH R
)NNR S
;NNS T
returnOO 
OkOO 
(OO 
resOO 
)OO 
;OO 
}PP 
catchQQ 
(QQ 
	ExceptionQQ 
eQQ 
)QQ 
{RR 
returnSS 

BadRequestSS !
(SS! "
eSS" #
.SS# $
MessageSS$ +
)SS+ ,
;SS, -
}TT 
}UU 	
[WW 	
HttpGetWW	 
(WW 
$strWW "
)WW" #
]WW# $
publicXX 
virtualXX 
IActionResultXX $
GetWardsByParentXX% 5
(XX5 6
[XX6 7
	FromQueryXX7 @
]XX@ A
stringXXB H

parentCodeXXI S
)XXS T
{YY 	
stringZZ 
rootFilePathZZ 
=ZZ  !
PathZZ" &
.ZZ& '
CombineZZ' .
(ZZ. /

folderPathZZ/ 9
,ZZ9 :
$strZZ; F
)ZZF G
;ZZG H
try[[ 
{\\ 
var]] 
res]] 
=]] 

_bLAddress]] $
.]]$ %
GetWardsByParent]]% 5
(]]5 6
rootFilePath]]6 B
,]]B C

parentCode]]D N
)]]N O
;]]O P
return^^ 
Ok^^ 
(^^ 
res^^ 
)^^ 
;^^ 
}__ 
catch`` 
(`` 
	Exception`` 
e`` 
)`` 
{aa 
returnbb 

BadRequestbb !
(bb! "
ebb" #
.bb# $
Messagebb$ +
)bb+ ,
;bb, -
}cc 
}dd 	
}ee 
}ff Ç3
tD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\BaseEntityController.cs
	namespace		 	
PTDuc		
 
.		 

WhereHouse		 
.		 
Controllers		 &
{

 
[ 
ApiController 
] 
[ 
Route 

(
 
$str  
)  !
]! "
[ 
	Authorize 
] 
public 

class  
BaseEntityController %
<% &
TEntity& -
,- .
TDTO/ 3
>3 4
:5 6

Controller7 A
whereB G
TEntityH O
:P Q
classR W
whereX ]
TDTO^ b
:c d

BaseEntitye o
{ 
IBLBase 
< 
TEntity 
, 
TDTO 
> 
_BLBase &
;& '
	protected 
WhereHouseContext #
context$ +
=, -
new. 1
WhereHouseContext2 C
(C D
)D E
;E F
public  
BaseEntityController #
(# $
IBLBase$ +
<+ ,
TEntity, 3
,3 4
TDTO5 9
>9 :
BLBase; A
)A B
{ 	
_BLBase 
= 
BLBase 
; 
} 	
[ 	
HttpGet	 
] 
public 
virtual 
IActionResult $
Get% (
(( )
)) *
{ 	
return!! 
Ok!! 
(!! 
_BLBase!! 
.!! 
GetAll!! $
(!!$ %
)!!% &
)!!& '
;!!' (
}"" 	
[,, 	
HttpGet,,	 
(,, 
$str,, 
),, 
],, 
public-- 
virtual-- 
IActionResult-- $
GetByID--% ,
(--, -
string--- 3
id--4 6
)--6 7
{.. 	
var// 
res// 
=// 
_BLBase// 
.// 
GetByID// %
(//% &
id//& (
)//( )
;//) *
return00 
Ok00 
(00 
res00 
)00 
;00 
}11 	
[:: 	
HttpPost::	 
]:: 
public;; 
virtual;; 
IActionResult;; $
Post;;% )
(;;) *
[;;* +
FromBody;;+ 3
];;3 4
TDTO;;5 9
entity;;: @
);;@ A
{<< 	
var>> 
res>> 
=>> 
new>> 
ServiceResult>> '
(>>' (
)>>( )
;>>) *
try?? 
{@@ 
entityAA 
.AA 
CreatedDateAA "
=AA# $
DateTimeAA% -
.AA- .
NowAA. 1
;AA1 2
resBB 
.BB 
DataBB 
=BB 
_BLBaseBB "
.BB" #
InsertBB# )
(BB) *
entityBB* 0
)BB0 1
;BB1 2
returnCC 
OkCC 
(CC 
resCC 
)CC 
;CC 
}DD 
catchEE 
(EE 
SystemEE 
.EE 
	ExceptionEE #
eEE$ %
)EE% &
{FF 
returnGG 

BadRequestGG !
(GG! "
eGG" #
)GG# $
;GG$ %
throwHH 
;HH 
}II 
}LL 	
[TT 	
HttpPutTT	 
(TT 
$strTT 
)TT 
]TT 
publicUU 
IActionResultUU 
PutUU  
(UU  !
[UU! "
FromBodyUU" *
]UU* +
TDTOUU, 0
entityUU1 7
,UU7 8
stringUU8 >
idUU? A
)UUA B
{VV 	
varWW 
resWW 
=WW 
_BLBaseWW 
.WW 
UpdateWW $
(WW$ %
entityWW% +
,WW+ ,
idWW, .
)WW. /
;WW/ 0
returnXX 
OkXX 
(XX 
resXX 
)XX 
;XX 
}YY 	
[\\ 	

HttpDelete\\	 
(\\ 
$str\\ 
)\\ 
]\\ 
public]] 
IActionResult]] 
Delete]] #
(]]# $
[]]$ %
FromBody]]% -
]]]- .
TEntity]]/ 6
entity]]7 =
)]]= >
{^^ 	
var__ 
res__ 
=__ 
_BLBase__ 
.__ 
Delete__ $
(__$ %
entity__% +
)__+ ,
;__, -
return`` 
Ok`` 
(`` 
res`` 
)`` 
;`` 
}aa 	
[kk 	
HttpGetkk	 
(kk 
$strkk 
)kk 
]kk  
publicll 
virtualll 
IActionResultll $
GetByPagingll% 0
(ll0 1
intll1 4
pagell5 9
,ll9 :
intll; >
pageSizell? G
)llG H
{mm 	
returnnn 
Oknn 
(nn 
_BLBasenn 
.nn 
GetByPagingnn )
(nn) *
pagenn* .
,nn. /
pageSizenn0 8
)nn8 9
)nn9 :
;nn: ;
}oo 	
[qq 	
	NonActionqq	 
]qq 
publicrr 
IActionResultrr 
HandleResponserr +
(rr+ ,
ServiceResultrr, 9
resrr: =
)rr= >
{rr? @
varss 
statusss 
=ss 
resss 
.ss 

StatusCodess '
;ss' (
IActionResulttt 
responsett "
=tt# $
defaulttt% ,
(tt, -
IActionResulttt- :
)tt: ;
;tt; <
switchuu 
(uu 
statusuu 
)uu 
{vv 
caseww 
(ww 
intww 
)ww 
Enumerationww %
.ww% &

ResultCodeww& 0
.ww0 1
Successww1 8
:ww8 9
responsexx 
=xx 
Okxx !
(xx! "
resxx" %
)xx% &
;xx& '
breakyy 
;yy 
defaultzz 
:zz 
response{{ 
={{ 

BadRequest{{ )
({{) *
res{{* -
){{- .
;{{. /
break|| 
;|| 
}}} 
return~~ 
response~~ 
;~~ 
} 	
}
 
} %
vD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\ConversationController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class "
ConversationController '
:( ) 
BaseEntityController* >
<> ?
Conversation? K
,K L
ConversationDTOM \
>\ ]
{ 
IBLConversation 
_blConversation '
;' (
public "
ConversationController %
(% &
IBLConversation& 5
blConversation6 D
)D E
:F G
baseH L
(L M
blConversationM [
)[ \
{ 	
_blConversation 
= 
blConversation ,
;, -
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
virtual 
IActionResult $
InitChat% -
(- .
[. /
	FromQuery/ 8
]8 9
string: @
userReceivedIdA O
)O P
{ 	
var 
identity 
= 
HttpContext &
.& '
User' +
.+ ,
Identity, 4
as5 7
ClaimsIdentity8 F
;F G
if 
( 
identity 
!= 
null  
)  !
{ 
IEnumerable 
< 
Claim !
>! "
claims# )
=* +
identity, 4
.4 5
Claims5 ;
;; <
var 
userId 
= 
User !
.! "
Claims" (
.( )
Where) .
(. /
c/ 0
=>1 3
c4 5
.5 6
Type6 :
==; =
$str> F
)F G
. 
Select 
( 
x 
=> 
x 
. 
Value 
) 
. 
FirstOrDefault (
(( )
)) *
;* +
var 
res 
= 
new 
ServiceResult +
(+ ,
), -
;- .
res   
.   
Data   
=   
_blConversation   *
.  * +
InitChat  + 3
(  3 4
userId  4 :
,  : ;
userReceivedId  < J
)  J K
;  K L
return!! 
Ok!! 
(!! 
res!! 
)!! 
;!! 
}"" 
return## 
null## 
;## 
}&& 	
['' 	
HttpGet''	 
('' 
$str'' )
)'') *
]''* +
public(( 
virtual(( 
IActionResult(( $"
GetAllConversationUser((% ;
(((; <
[((< =
	FromQuery((= F
]((F G
string((H N
userReceivedId((O ]
)((] ^
{)) 	
var** 
identity** 
=** 
HttpContext** &
.**& '
User**' +
.**+ ,
Identity**, 4
as**5 7
ClaimsIdentity**8 F
;**F G
if++ 
(++ 
identity++ 
!=++ 
null++  
)++  !
{,, 
IEnumerable-- 
<-- 
Claim-- !
>--! "
claims--# )
=--* +
identity--, 4
.--4 5
Claims--5 ;
;--; <
var.. 
userId.. 
=.. 
User.. !
...! "
Claims.." (
...( )
Where..) .
(... /
c../ 0
=>..1 3
c..4 5
...5 6
Type..6 :
==..; =
$str..> F
)..F G
.// 
Select// 
(// 
x// 
=>// 
x// 
.// 
Value// 
)// 
.// 
FirstOrDefault// (
(//( )
)//) *
;//* +
var00 
res00 
=00 
new00 
ServiceResult00 +
(00+ ,
)00, -
;00- .
res11 
.11 
Data11 
=11 
_blConversation11 *
.11* +"
GetAllConversationUser11+ A
(11A B
userId11B H
)11H I
;11I J
return22 
Ok22 
(22 
res22 
)22 
;22 
}33 
return44 
null44 
;44 
}77 	
}88 
};; &
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\FileController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
[ 
AllowAnonymous 
] 
public 

class 
FileController 
:  ! 
BaseEntityController" 6
<6 7
	DBContext7 @
.@ A
ModelsA G
.G H
FileH L
,L M
FileDTOM T
>T U
{ 
IBLFile 
_blFile 
; 
private 
readonly 
IWebHostEnvironment ,
_env- 1
;1 2
public 
FileController 
( 
IBLFile %
blFile& ,
,, -
IWebHostEnvironment. A
envB E
)E F
:G H
baseI M
(M N
blFileN T
)T U
{ 	
_blFile 
= 
blFile 
; 
_env 
= 
env 
; 
} 	
[ 	
HttpPost	 
( 
$str 
) 
]  
public 
IActionResult 

UploadFile '
(' (
[( )
FromForm) 1
]1 2

FileUpload3 =

fileUpload> H
)H I
{ 	
var 
res 
= 
new 
ServiceResult '
(' (
)( )
;) *
try 
{ 
if 
( 

fileUpload 
!= !
null" &
)& '
{ 
if 
( 

fileUpload "
." #
file# '
!=( *
null+ /
)/ 0
{   
var!! 

folderPath!! &
=!!' (

fileUpload!!) 3
.!!3 4
category!!4 <
!=!!= ?
null!!@ D
?!!E F
Path!!G K
.!!K L
Combine!!L S
(!!S T
$str!!T ]
,!!] ^

fileUpload!!_ i
.!!i j
category!!j r
)!!r s
:"" 
$str"" '
;""' (
res## 
=## 
_blFile## %
.##% &

UploadFile##& 0
(##0 1

fileUpload##1 ;
,##; <
_env##= A
.##A B
WebRootPath##B M
,##M N

folderPath##O Y
)##Y Z
;##Z [
return$$ 
Ok$$ !
($$! "
res$$" %
)$$% &
;$$& '
}%% 
else&& 
{'' 
return(( 

BadRequest(( )
((() *
res((* -
)((- .
;((. /
})) 
}** 
else++ 
{,, 
return-- 

BadRequest-- %
(--% &
res--& )
)--) *
;--* +
}.. 
}// 
catch00 
(00 
System00 
.00 
	Exception00 #
e00$ %
)00% &
{11 
res22 
.22 
Data22 
=22 
e22 
;22 
return33 

BadRequest33 !
(33! "
res33" %
)33% &
;33& '
}44 
}55 	
[77 	
HttpPost77	 
(77 
$str77 
)77 
]77  
public88 
IActionResult88 

DeleteFile88 '
(88' (

FileUpload88( 2

fileUpload883 =
)88= >
{99 	
var:: 
res:: 
=:: 
new:: 
ServiceResult:: '
(::' (
)::( )
;::) *
try;; 
{<< 
if== 
(== 

fileUpload== 
!=== !
null==" &
)==& '
{>> 
res?? 
=?? 
_blFile?? !
.??! "

DeleteFile??" ,
(??, -

fileUpload??- 7
,??7 8
_env??9 =
.??= >
WebRootPath??> I
)??I J
;??J K
return@@ 
Ok@@ 
(@@ 
res@@ !
)@@! "
;@@" #
}AA 
elseBB 
{CC 
returnDD 

BadRequestDD %
(DD% &
resDD& )
)DD) *
;DD* +
}EE 
}FF 
catchGG 
(GG 
SystemGG 
.GG 
	ExceptionGG #
eGG$ %
)GG% &
{HH 
resII 
.II 
DataII 
=II 
eII 
;II 
returnJJ 

BadRequestJJ !
(JJ! "
resJJ" %
)JJ% &
;JJ& '
}KK 
}LL 	
}MM 
}NN Æ/
oD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\HouseController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
HouseController  
:! " 
BaseEntityController# 7
<7 8
House8 =
,= >
HouseDTO? G
>G H
{ 
IBLHouse 
_blHouse 
; 
public 
HouseController 
( 
IBLHouse '
blHouse( /
)/ 0
:1 2
base3 7
(7 8
blHouse8 ?
)? @
{ 	
_blHouse 
= 
blHouse 
; 
} 	
[ 	
AllowAnonymous	 
] 
public 
override 
IActionResult %
Get& )
() *
)* +
{ 	
return 
base 
. 
Get 
( 
) 
; 
} 	
[ 	
AllowAnonymous	 
] 
public   
override   
IActionResult   %
GetByPaging  & 1
(  1 2
int  2 5
page  6 :
,  : ;
int  < ?
pageSize  @ H
)  H I
{!! 	
return"" 
base"" 
."" 
GetByPaging"" #
(""# $
page""$ (
,""( )
pageSize""* 2
)""2 3
;""3 4
}## 	
[%% 	
AllowAnonymous%%	 
]%% 
public&& 
override&& 
IActionResult&& %
GetByID&&& -
(&&- .
string&&. 4
id&&5 7
)&&7 8
{'' 	
return(( 
base(( 
.(( 
GetByID(( 
(((  
id((  "
)((" #
;((# $
})) 	
[++ 	
HttpGet++	 
(++ 
$str++ 
)++ 
]++  
public,, 
virtual,, 
IActionResult,, $
GetDeepData,,% 0
(,,0 1
),,1 2
{-- 	
return.. 
Ok.. 
(.. 
_blHouse.. 
... 
GetDeepData.. *
(..* +
)..+ ,
).., -
;..- .
}// 	
[11 	
HttpGet11	 
(11 
$str11 !
)11! "
]11" #
public22 
virtual22 
IActionResult22 $
GetHouseDetail22% 3
(223 4
string224 :
houseId22; B
)22B C
{33 	
var44 
res44 
=44 
new44 
ServiceResult44 '
(44' (
)44( )
;44) *
var66 
identity66 
=66 
HttpContext66 &
.66& '
User66' +
.66+ ,
Identity66, 4
as665 7
ClaimsIdentity668 F
;66F G
if77 
(77 
identity77 
!=77 
null77  
)77  !
{88 
IEnumerable99 
<99 
Claim99 !
>99! "
claims99# )
=99* +
identity99, 4
.994 5
Claims995 ;
;99; <
var:: 
userId:: 
=:: 
User:: !
.::! "
Claims::" (
.::( )
Where::) .
(::. /
c::/ 0
=>::1 3
c::4 5
.::5 6
Type::6 :
==::; =
$str::> F
)::F G
.;; 
Select;; 
(;; 
x;; 
=>;; 
x;; 
.;; 
Value;; 
);; 
.;; 
FirstOrDefault;; (
(;;( )
);;) *
;;;* +
res<< 
.<< 
Data<< 
=<< 
null<< 
;<<  
}== 
return?? 
Ok?? 
(?? 
res?? 
)?? 
;?? 
}@@ 	
[CC 	
HttpPostCC	 
(CC 
$strCC 
)CC 
]CC  
publicDD 
virtualDD 
IActionResultDD $

AddNewPostDD% /
(DD/ 0
HouseDTODD0 8
dataForPostDD9 D
)DDD E
{EE 	
varFF 
resFF 
=FF 
newFF 
ServiceResultFF '
(FF' (
)FF( )
;FF) *
tryGG 
{HH 
varII 
resutlII 
=II 
_blHouseII &
.II& '

AddNewPostII' 1
(II1 2
dataForPostII2 =
)II= >
;II> ?
ifJJ 
(JJ 
resutlJJ 
)JJ 
{KK 
resLL 
.LL 
DataLL 
=LL 
trueLL #
;LL# $
returnMM 
OkMM 
(MM 
resMM !
)MM! "
;MM" #
}NN 
elseOO 
{OO 
resPP 
.PP 

StatusCodePP "
=PP# $
(PP% &
intPP& )
)PP) *

ResultCodePP* 4
.PP4 5
FailedPP5 ;
;PP; <
resQQ 
.QQ 
	MessengerQQ !
=QQ" #
$strQQ$ 8
;QQ8 9
returnRR 

BadRequestRR %
(RR% &
resRR& )
)RR) *
;RR* +
}SS 
}TT 
catchUU 
(UU 
	ExceptionUU 
eUU 
)UU 
{VV 
resWW 
.WW 

StatusCodeWW 
=WW  
(WW! "
intWW" %
)WW% &

ResultCodeWW& 0
.WW0 1
FailedWW1 7
;WW7 8
resXX 
.XX 
	MessengerXX 
=XX 
eXX  !
.XX! "
MessageXX" )
;XX) *
returnYY 

BadRequestYY !
(YY! "
resYY" %
)YY% &
;YY& '
}ZZ 
}[[ 	
}\\ 
}]] Å
sD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\HouseTypeController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
[ 
AllowAnonymous 
] 
public 

class 
HouseTypeController $
:% & 
BaseEntityController' ;
<; <
	HouseType< E
,E F
HouseTypeDTOG S
>S T
{ 
IBLHouseType 
_blHouseType !
;! "
public 
HouseTypeController "
(" #
IBLHouseType# /
blHouseType0 ;
); <
:= >
base? C
(C D
blHouseTypeD O
)O P
{ 	
_blHouseType 
= 
blHouseType &
;& '
} 	
} 
} ö
pD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\LoginController .cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
[ 
Route 

(
 
$str  
)  !
]! "
[ 
ApiController 
] 
[ 
	Authorize 
] 
public 

class 
LoginController  
:! "
ControllerBase# 1
{ 
IBLLogin 
_bLLogin 
; 
public 
LoginController 
( 
IBLLogin '
bLLogin( /
)/ 0
{ 	
_bLLogin 
= 
bLLogin 
; 
} 	
[QQ 	
HttpPostQQ	 
]QQ 
[RR 	
AllowAnonymousRR	 
]RR 
publicSS 
IActionResultSS 
LoginSS "
(SS" #
[SS# $
FromBodySS$ ,
]SS, -

LoginParamSS- 7
paramSS8 =
)SS= >
{TT 	
varUU 
resUU 
=UU 
newUU 
ServiceResultUU '
(UU' (
)UU( )
;UU) *
tryVV 
{WW 
resXX 
=XX 
_bLLoginXX 
.XX 
LoginXX $
(XX$ %
paramXX% *
)XX* +
;XX+ ,
}YY 
catchZZ 
(ZZ 
	ExceptionZZ 
eZZ 
)ZZ 
{[[ 
res\\ 
.\\ 
	Messenger\\ 
=\\ 
e\\  !
.\\! "
Message\\" )
;\\) *
}]] 
return^^ 
Ok^^ 
(^^ 
res^^ 
)^^ 
;^^ 
}hh 	
}ii 
}jj Ò
qD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\MessageController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
MessageController "
:# $ 
BaseEntityController% 9
<9 :
Message: A
,A B

MessageDTOC M
>M N
{ 

IBLMessage 

_blMessage 
; 
public 
MessageController  
(  !

IBLMessage! +
	blMessage, 5
)5 6
:7 8
base9 =
(= >
	blMessage> G
)G H
{ 	

_blMessage 
= 
	blMessage "
;" #
} 	
[ 	
HttpGet	 
( 
$str "
)" #
]# $
public 
virtual 
IActionResult $
GetConversation% 4
(4 5

MessageDTO5 ?
message@ G
)G H
{ 	
return 
Ok 
( 

_blMessage  
.  !
GetConversation! 0
(0 1
message1 8
)8 9
)9 :
;: ;
} 	
[ 	
HttpGet	 
( 
$str 3
)3 4
]4 5
public 
virtual 
IActionResult $'
GetMessagesByConversationId% @
(@ A
stringA G
idH J
)J K
{ 	
var   
res   
=   
new   
ServiceResult   '
(  ' (
)  ( )
;  ) *
res!! 
.!! 
Data!! 
=!! 

_blMessage!! !
.!!! "'
GetMessagesByConversationId!!" =
(!!= >
id!!> @
)!!@ A
;!!A B
return"" 
Ok"" 
("" 
res"" 
)"" 
;"" 
}## 	
}$$ 
}%% 9
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\PostController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
PostController 
:  ! 
BaseEntityController" 6
<6 7
Post7 ;
,; <
PostDTO= D
>D E
{ 
IBLPost 
_blPost 
; 
public 
PostController 
( 
IBLPost %
blPost& ,
), -
:. /
base0 4
(4 5
blPost5 ;
); <
{ 	
_blPost 
= 
blPost 
; 
} 	
[ 	
AllowAnonymous	 
] 
public 
override 
IActionResult %
Get& )
() *
)* +
{ 	
return 
base 
. 
Get 
( 
) 
; 
} 	
[   	
AllowAnonymous  	 
]   
public!! 
override!! 
IActionResult!! %
GetByPaging!!& 1
(!!1 2
int!!2 5
page!!6 :
,!!: ;
int!!< ?
pageSize!!@ H
)!!H I
{"" 	
return## 
base## 
.## 
GetByPaging## #
(### $
page##$ (
,##( )
pageSize##* 2
)##2 3
;##3 4
}$$ 	
[&& 	
AllowAnonymous&&	 
]&& 
public'' 
override'' 
IActionResult'' %
GetByID''& -
(''- .
string''. 4
id''5 7
)''7 8
{(( 	
return)) 
base)) 
.)) 
GetByID)) 
())  
id))  "
)))" #
;))# $
}** 	
[,, 	
HttpGet,,	 
(,, 
$str,, 
),, 
],,  
public-- 
IActionResult-- 
GetUserPost-- (
(--( )
)--) *
{.. 	
var// 
identity// 
=// 
HttpContext// &
.//& '
User//' +
.//+ ,
Identity//, 4
as//5 7
ClaimsIdentity//8 F
;//F G
if00 
(00 
identity00 
!=00 
null00  
)00  !
{11 
IEnumerable22 
<22 
Claim22 !
>22! "
claims22# )
=22* +
identity22, 4
.224 5
Claims225 ;
;22; <
var33 
userId33 
=33 
User33 !
.33! "
Claims33" (
.33( )
Where33) .
(33. /
c33/ 0
=>331 3
c334 5
.335 6
Type336 :
==33; =
$str33> F
)33F G
.44 
Select44 
(44 
x44 
=>44 
x44 
.44 
Value44 
)44 
.44 
FirstOrDefault44 (
(44( )
)44) *
;44* +
var55 
res55 
=55 
_blPost55 !
.55! "
GetUserPost55" -
(55- .
Guid55. 2
.552 3
Parse553 8
(558 9
userId559 ?
)55? @
)55@ A
;55A B
return66 
this66 
.66 
HandleResponse66 *
(66* +
res66+ .
)66. /
;66/ 0
}77 
return88 
Ok88 
(88 
null88 
)88 
;88 
}99 	
[;; 	

HttpDelete;;	 
(;; 
$str;; )
);;) *
];;* +
public<< 
IActionResult<< 
DeletePostUser<< +
(<<+ ,
string<<, 2
id<<3 5
)<<5 6
{== 	
var>> 
identity>> 
=>> 
HttpContext>> &
.>>& '
User>>' +
.>>+ ,
Identity>>, 4
as>>5 7
ClaimsIdentity>>8 F
;>>F G
if?? 
(?? 
identity?? 
!=?? 
null??  
)??  !
{@@ 
IEnumerableAA 
<AA 
ClaimAA !
>AA! "
claimsAA# )
=AA* +
identityAA, 4
.AA4 5
ClaimsAA5 ;
;AA; <
varBB 
userIdBB 
=BB 
UserBB !
.BB! "
ClaimsBB" (
.BB( )
WhereBB) .
(BB. /
cBB/ 0
=>BB1 3
cBB4 5
.BB5 6
TypeBB6 :
==BB; =
$strBB> F
)BBF G
.CC 
SelectCC 
(CC 
xCC 
=>CC 
xCC 
.CC 
ValueCC 
)CC 
.CC 
FirstOrDefaultCC (
(CC( )
)CC) *
;CC* +
varDD 
resDD 
=DD 
_blPostDD !
.DD! "
DeletePostUserDD" 0
(DD0 1
idDD1 3
,DD3 4
userIdDD5 ;
)DD; <
;DD< =
returnEE 
thisEE 
.EE 
HandleResponseEE *
(EE* +
resEE+ .
)EE. /
;EE/ 0
}FF 
returnGG 
OkGG 
(GG 
nullGG 
)GG 
;GG 
}HH 	
[II 	
HttpPostII	 
(II 
$strII #
)II# $
]II$ %
publicJJ 
IActionResultJJ 

AcceptPostJJ '
(JJ' (
stringJJ( .
idJJ/ 1
)JJ1 2
{KK 	
varLL 
identityLL 
=LL 
HttpContextLL &
.LL& '
UserLL' +
.LL+ ,
IdentityLL, 4
asLL5 7
ClaimsIdentityLL8 F
;LLF G
ifMM 
(MM 
identityMM 
!=MM 
nullMM  
)MM  !
{NN 
IEnumerableOO 
<OO 
ClaimOO !
>OO! "
claimsOO# )
=OO* +
identityOO, 4
.OO4 5
ClaimsOO5 ;
;OO; <
varPP 
userIdPP 
=PP 
UserPP !
.PP! "
ClaimsPP" (
.PP( )
WherePP) .
(PP. /
cPP/ 0
=>PP1 3
cPP4 5
.PP5 6
TypePP6 :
==PP; =
$strPP> F
)PPF G
.QQ 
SelectQQ 
(QQ 
xQQ 
=>QQ 
xQQ 
.QQ 
ValueQQ 
)QQ 
.QQ 
FirstOrDefaultQQ (
(QQ( )
)QQ) *
;QQ* +
varRR 
resRR 
=RR 
_blPostRR !
.RR! "
DeletePostUserRR" 0
(RR0 1
idRR1 3
,RR3 4
userIdRR5 ;
)RR; <
;RR< =
returnSS 
thisSS 
.SS 
HandleResponseSS *
(SS* +
resSS+ .
)SS. /
;SS/ 0
}TT 
returnUU 
OkUU 
(UU 
nullUU 
)UU 
;UU 
}VV 	
}WW 
}XX ×@
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\UserController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
UserController 
: 	 
BaseEntityController
 
< 
User #
,# $
UserDTO% ,
>, -
{ 
IBLUser 
_blUser 
; 
public 
UserController 
( 
IBLUser %
blUser& ,
), -
:. /
base0 4
(4 5
blUser5 ;
); <
{ 	
_blUser 
= 
blUser 
; 
} 	
[ 	
AllowAnonymous	 
] 
public 
override 
IActionResult %
Post& *
(* +
[+ ,
FromBody, 4
]4 5
UserDTO6 =
entity> D
)D E
{ 	
return 
base 
. 
Post 
( 
entity #
)# $
;$ %
} 	
[ 	
HttpPost	 
( 
$str 
)  
]  !
public 
IActionResult 
InsertAdmin (
(( )
[) *
FromBody* 2
]2 3
UserDTO4 ;
user< @
)@ A
{ 	
var 
identity 
= 
HttpContext &
.& '
User' +
.+ ,
Identity, 4
as5 7
ClaimsIdentity8 F
;F G
if   
(   
identity   
!=   
null    
)    !
{!! 
IEnumerable"" 
<"" 
Claim"" !
>""! "
claims""# )
=""* +
identity"", 4
.""4 5
Claims""5 ;
;""; <
var## 
userId## 
=## 
User## !
.##! "
Claims##" (
.##( )
Where##) .
(##. /
c##/ 0
=>##1 3
c##4 5
.##5 6
Type##6 :
==##; =
$str##> F
)##F G
.$$ 
Select$$ 
($$ 
x$$ 
=>$$  
x$$! "
.$$" #
Value$$# (
)$$( )
.$$) *
FirstOrDefault$$* 8
($$8 9
)$$9 :
;$$: ;
var%% 
res%% 
=%% 
_blUser%% !
.%%! "
InsertAdmin%%" -
(%%- .
user%%. 2
,%%2 3
userId%%4 :
)%%: ;
;%%; <
return&& 
(&& 
this&& 
.&& 
HandleResponse&& +
(&&+ ,
res&&, /
)&&/ 0
)&&0 1
;&&1 2
}'' 
return(( 
Ok(( 
((( 
null(( 
)(( 
;(( 
})) 	
[++ 	
HttpPost++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
IActionResult,, 
	BlockUser,, &
(,,& '
[,,' (
FromBody,,( 0
],,0 1
string,,2 8
blockUserId,,9 D
),,D E
{-- 	
var.. 
identity.. 
=.. 
HttpContext.. &
...& '
User..' +
...+ ,
Identity.., 4
as..5 7
ClaimsIdentity..8 F
;..F G
if// 
(// 
identity// 
!=// 
null//  
)//  !
{00 
IEnumerable11 
<11 
Claim11 !
>11! "
claims11# )
=11* +
identity11, 4
.114 5
Claims115 ;
;11; <
var22 
adminId22 
=22 
User22 "
.22" #
Claims22# )
.22) *
Where22* /
(22/ 0
c220 1
=>222 4
c225 6
.226 7
Type227 ;
==22< >
$str22? G
)22G H
.33 
Select33 
(33 
x33 
=>33  
x33! "
.33" #
Value33# (
)33( )
.33) *
FirstOrDefault33* 8
(338 9
)339 :
;33: ;
var44 
res44 
=44 
_blUser44 !
.44! "
	BlockUser44" +
(44+ ,
blockUserId44, 7
,447 8
adminId449 @
)44@ A
;44A B
return55 
this55 
.55 
HandleResponse55 *
(55* +
res55+ .
)55. /
;55/ 0
}66 
return77 
Ok77 
(77 
null77 
)77 
;77 
}88 	
[:: 	
HttpGet::	 
(:: 
$str:: &
)::& '
]::' (
public;; 
IActionResult;; 
GetListUserForAdmin;; 0
(;;0 1
);;1 2
{<< 	
var== 
identity== 
=== 
HttpContext== &
.==& '
User==' +
.==+ ,
Identity==, 4
as==5 7
ClaimsIdentity==8 F
;==F G
if>> 
(>> 
identity>> 
!=>> 
null>>  
)>>  !
{?? 
IEnumerable@@ 
<@@ 
Claim@@ !
>@@! "
claims@@# )
=@@* +
identity@@, 4
.@@4 5
Claims@@5 ;
;@@; <
varAA 
adminIdAA 
=AA 
UserAA "
.AA" #
ClaimsAA# )
.AA) *
WhereAA* /
(AA/ 0
cAA0 1
=>AA2 4
cAA5 6
.AA6 7
TypeAA7 ;
==AA< >
$strAA? G
)AAG H
.BB 
SelectBB 
(BB 
xBB 
=>BB  
xBB! "
.BB" #
ValueBB# (
)BB( )
.BB) *
FirstOrDefaultBB* 8
(BB8 9
)BB9 :
;BB: ;
varCC 
resCC 
=CC 
_blUserCC !
.CC! "
GetListUserForAdminCC" 5
(CC5 6
adminIdCC6 =
)CC= >
;CC> ?
returnDD 
thisDD 
.DD 
HandleResponseDD *
(DD* +
resDD+ .
)DD. /
;DD/ 0
}EE 
returnFF 
OkFF 
(FF 
nullFF 
)FF 
;FF 
}GG 	
[II 	
HttpGetII	 
(II 
$strII  
)II  !
]II! "
publicJJ 
IActionResultJJ 
GetUserConfigJJ *
(JJ* +
)JJ+ ,
{KK 	
varLL 
identityLL 
=LL 
HttpContextLL &
.LL& '
UserLL' +
.LL+ ,
IdentityLL, 4
asLL5 7
ClaimsIdentityLL8 F
;LLF G
ifMM 
(MM 
identityMM 
!=MM 
nullMM  
)MM  !
{NN 
IEnumerableOO 
<OO 
ClaimOO !
>OO! "
claimsOO# )
=OO* +
identityOO, 4
.OO4 5
ClaimsOO5 ;
;OO; <
varPP 
userIdPP 
=PP 
UserPP !
.PP! "
ClaimsPP" (
.PP( )
WherePP) .
(PP. /
cPP/ 0
=>PP1 3
cPP4 5
.PP5 6
TypePP6 :
==PP; =
$strPP> F
)PPF G
.QQ 
SelectQQ 
(QQ 
xQQ 
=>QQ  
xQQ! "
.QQ" #
ValueQQ# (
)QQ( )
.QQ) *
FirstOrDefaultQQ* 8
(QQ8 9
)QQ9 :
;QQ: ;
varRR 
resRR 
=RR 
_blUserRR !
.RR! "
GetByIDRR" )
(RR) *
userIdRR* 0
)RR0 1
;RR1 2
returnSS 
OkSS 
(SS 
resSS 
)SS 
;SS 
}TT 
returnUU 
OkUU 
(UU 
nullUU 
)UU 
;UU 
}VV 	
}WW 
}XX é 
rD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\WishlistController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
WishlistController #
:$ % 
BaseEntityController& :
<: ;
Wishlist; C
,C D
WishlistDTOE P
>P Q
{ 
IBLWishlist 
_blWishlist 
;  
public 
WishlistController !
(! "
IBLWishlist" -

blWishlist. 8
)8 9
:: ;
base< @
(@ A

blWishlistA K
)K L
{ 	
_blWishlist 
= 

blWishlist $
;$ %
} 	
[ 	
HttpGet	 
( 
$str &
)& '
]' (
public 
IActionResult 
GetWishlistByUserId 0
(0 1
)1 2
{ 	
var 
identity 
= 
HttpContext &
.& '
User' +
.+ ,
Identity, 4
as5 7
ClaimsIdentity8 F
;F G
if 
( 
identity 
!= 
null  
)  !
{ 
IEnumerable 
< 
Claim !
>! "
claims# )
=* +
identity, 4
.4 5
Claims5 ;
;; <
var 
userId 
= 
User !
.! "
Claims" (
.( )
Where) .
(. /
c/ 0
=>1 3
c4 5
.5 6
Type6 :
==; =
$str> F
)F G
. 
Select 
( 
x 
=> 
x 
. 
Value 
) 
. 
FirstOrDefault (
(( )
)) *
;* +
return 
Ok 
( 
_blWishlist %
.% &
GetWishlistByUserId& 9
(9 :
Guid: >
.> ?
Parse? D
(D E
userIdE K
)K L
)L M
)M N
;N O
}   
return!! 
Ok!! 
(!! 
null!! 
)!! 
;!! 
}"" 	
[## 	

HttpDelete##	 
(## 
$str## -
)##- .
]##. /
public$$ 
IActionResult$$ 
DeletePostWishlist$$ /
($$/ 0
string$$0 6
id$$7 9
)$$9 :
{%% 	
var&& 
identity&& 
=&& 
HttpContext&& &
.&&& '
User&&' +
.&&+ ,
Identity&&, 4
as&&5 7
ClaimsIdentity&&8 F
;&&F G
if'' 
('' 
identity'' 
!='' 
null''  
)''  !
{(( 
IEnumerable)) 
<)) 
Claim)) !
>))! "
claims))# )
=))* +
identity)), 4
.))4 5
Claims))5 ;
;)); <
var** 
userId** 
=** 
User** !
.**! "
Claims**" (
.**( )
Where**) .
(**. /
c**/ 0
=>**1 3
c**4 5
.**5 6
Type**6 :
==**; =
$str**> F
)**F G
.++ 
Select++ 
(++ 
x++ 
=>++ 
x++ 
.++ 
Value++ 
)++ 
.++ 
FirstOrDefault++ (
(++( )
)++) *
;++* +
return,, 
Ok,, 
(,, 
_blWishlist,, %
.,,% &
DeletePostWishlist,,& 8
(,,8 9
id,,9 ;
,,,; <
userId,,= C
),,C D
),,D E
;,,E F
}-- 
return.. 
Ok.. 
(.. 
null.. 
).. 
;.. 
}// 	
}22 
}33 
sD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\MapperProfile\AutoMapperProfile.cs
	namespace		 	
PTDuc		
 
.		 

WhereHouse		 
.		 
MapperProfile		 (
{

 
public 

class 
AutoMapperProfile "
:# $
Profile% ,
{ 
public 
AutoMapperProfile  
(  !
)! "
{# $
	CreateMap 
< 
User 
, 
UserDTO #
># $
($ %
)% &
;& '
	CreateMap 
< 
File 
, 
FileDTO #
># $
($ %
)% &
;& '
	CreateMap 
< 
House 
, 
HouseDTO %
>% &
(& '
)' (
;( )
	CreateMap 
< 
	HouseType 
,  
HouseTypeDTO! -
>- .
(. /
)/ 0
;0 1
	CreateMap 
< 
Post 
, 
PostDTO #
># $
($ %
)% &
;& '
	CreateMap 
< 
Wishlist 
, 
WishlistDTO  +
>+ ,
(, -
)- .
;. /
;0 1
	CreateMap 
< 
Message 
, 

MessageDTO )
>) *
(* +
)+ ,
;, -
;. /
	CreateMap 
< 
Conversation "
," #
ConversationDTO$ 3
>3 4
(4 5
)5 6
;6 7
	CreateMap 
< 
UserDTO 
, 
User #
># $
($ %
)% &
;& '
	CreateMap 
< 
FileDTO 
, 
File #
># $
($ %
)% &
;& '
	CreateMap 
< 
HouseDTO 
, 
House  %
>% &
(& '
)' (
;( )
	CreateMap 
< 
HouseTypeDTO "
," #
	HouseType$ -
>- .
(. /
)/ 0
;0 1
	CreateMap 
< 
PostDTO 
, 
Post #
># $
($ %
)% &
;& '
	CreateMap 
< 
WishlistDTO !
,! "
Wishlist# +
>+ ,
(, -
)- .
;. /
;0 1
	CreateMap 
< 

MessageDTO  
,  !
Message" )
>) *
(* +
)+ ,
;, -
;. /
	CreateMap 
< 
ConversationDTO %
,% &
Conversation' 3
>3 4
(4 5
)5 6
;6 7
}   	
}!! 
}"" Õ

[D:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Program.cs
	namespace

 	
PTDuc


 
.

 

WhereHouse

 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ì]
[D:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Startup.cs
	namespace"" 	
PTDuc""
 
."" 

WhereHouse"" 
{## 
public$$ 

class$$ 
Startup$$ 
{%% 
public&& 
Startup&& 
(&& 
IConfiguration&& %
configuration&&& 3
)&&3 4
{'' 	
Configuration(( 
=(( 
configuration(( )
;(() *
})) 	
public++ 
IConfiguration++ 
Configuration++ +
{++, -
get++. 1
;++1 2
}++3 4
public.. 
void.. 
ConfigureServices.. %
(..% &
IServiceCollection..& 8
services..9 A
)..A B
{// 	
services11 
.11 
AddControllers11 #
(11# $
)11$ %
.11% &
AddJsonOptions11& 4
(114 5
options115 <
=>11= ?
{22 
options33 
.33 !
JsonSerializerOptions33 -
.33- . 
PropertyNamingPolicy33. B
=33C D
null33E I
;33I J
}44 
)44 
;44 
services55 
.55 
AddControllers55 #
(55# $
)55$ %
.66 
AddJsonOptions66 
(66  
options66  '
=>66( *
{77 
options88 
.88 !
JsonSerializerOptions88 1
.881 2
ReferenceHandler882 B
=88C D
ReferenceHandler88E U
.88U V
Preserve88V ^
;88^ _
options99 
.99 !
JsonSerializerOptions99 1
.991 2
WriteIndented992 ?
=99@ A
true99B F
;99F G
}:: 
):: 
;:: 
services;; 
.;; 
AddSwaggerGen;; "
(;;" #
c;;# $
=>;;% '
{<< 
c== 
.== 

SwaggerDoc== 
(== 
$str== !
,==! "
new==# &
OpenApiInfo==' 2
{==3 4
Title==5 :
===; <
$str=== O
,==O P
Version==Q X
===Y Z
$str==[ _
}==` a
)==a b
;==b c
}>> 
)>> 
;>> 
services@@ 
.@@ 

AddSignalR@@ 
(@@  
)@@  !
;@@! "
servicesAA 
.AA 
	AddScopedAA 
<AA 
IDLUserAA &
,AA& '
DLUserAA( .
>AA. /
(AA/ 0
)AA0 1
;AA1 2
servicesBB 
.BB 
	AddScopedBB 
<BB 
IBLUserBB &
,BB& '
BLUserBB( .
>BB. /
(BB/ 0
)BB0 1
;BB1 2
servicesEE 
.EE 
	AddScopedEE 
<EE 
IBLLoginEE '
,EE' (
BLLoginEE) 0
>EE0 1
(EE1 2
)EE2 3
;EE3 4
servicesFF 
.FF 
	AddScopedFF 
<FF 
IDLLoginFF '
,FF' (
DLLoginFF) 0
>FF0 1
(FF1 2
)FF2 3
;FF3 4
servicesHH 
.HH 
	AddScopedHH 
<HH 
IBLHouseHH '
,HH' (
BLHouseHH) 0
>HH0 1
(HH1 2
)HH2 3
;HH3 4
servicesII 
.II 
	AddScopedII 
<II 
IDLHouseII '
,II' (
DLHouseII) 0
>II0 1
(II1 2
)II2 3
;II3 4
servicesKK 
.KK 
	AddScopedKK 
<KK 

IBLAddressKK )
,KK) *
	BLAddressKK+ 4
>KK4 5
(KK5 6
)KK6 7
;KK7 8
servicesMM 
.MM 
	AddScopedMM 
<MM 
IBLFileMM &
,MM& '
BLFileMM( .
>MM. /
(MM/ 0
)MM0 1
;MM1 2
servicesNN 
.NN 
	AddScopedNN 
<NN 
IDLFileNN &
,NN& '
DLFileNN( .
>NN. /
(NN/ 0
)NN0 1
;NN1 2
servicesPP 
.PP 
	AddScopedPP 
<PP 
IDLWishlistPP *
,PP* +

DLWishlistPP, 6
>PP6 7
(PP7 8
)PP8 9
;PP9 :
servicesQQ 
.QQ 
	AddScopedQQ 
<QQ 
IBLWishlistQQ *
,QQ* +

BLWishlistQQ, 6
>QQ6 7
(QQ7 8
)QQ8 9
;QQ9 :
servicesSS 
.SS 
	AddScopedSS 
<SS 
IDLPostSS &
,SS& '
DLPostSS( .
>SS. /
(SS/ 0
)SS0 1
;SS1 2
servicesTT 
.TT 
	AddScopedTT 
<TT 
IBLPostTT &
,TT& '
BLPostTT( .
>TT. /
(TT/ 0
)TT0 1
;TT1 2
servicesVV 
.VV 
	AddScopedVV 
<VV 

IDLMessageVV )
,VV) *
	DLMessageVV+ 4
>VV4 5
(VV5 6
)VV6 7
;VV7 8
servicesWW 
.WW 
	AddScopedWW 
<WW 

IBLMessageWW )
,WW) *
	BLMessageWW+ 4
>WW4 5
(WW5 6
)WW6 7
;WW7 8
servicesYY 
.YY 
	AddScopedYY 
<YY 
IDLConversationYY .
,YY. /
DLConversationYY0 >
>YY> ?
(YY? @
)YY@ A
;YYA B
servicesZZ 
.ZZ 
	AddScopedZZ 
<ZZ 
IBLConversationZZ .
,ZZ. /
BLConversationZZ0 >
>ZZ> ?
(ZZ? @
)ZZ@ A
;ZZA B
services\\ 
.\\ 
	AddScoped\\ 
<\\ 
IDLHouseType\\ +
,\\+ ,
DLHouseType\\- 8
>\\8 9
(\\9 :
)\\: ;
;\\; <
services]] 
.]] 
	AddScoped]] 
<]] 
IBLHouseType]] +
,]]+ ,
BLHouseType]]- 8
>]]8 9
(]]9 :
)]]: ;
;]]; <
services__ 
.__ 
AddDbContext__ !
<__! "
WhereHouseContext__" 3
>__3 4
(__4 5
options`` 
=>`` 
options`` 
.`` 
UseSqlServer`` +
(``+ ,
$str``, W
)``W X
)``X Y
;``Y Z
varcc 
keycc 
=cc 
Configurationcc #
.cc# $

GetSectioncc$ .
(cc. /
$strcc/ ?
)cc? @
.cc@ A

GetSectionccA K
(ccK L
$strccL Q
)ccQ R
.ccR S
ValueccS X
;ccX Y
servicesdd 
.dd 
AddAuthenticationdd &
(dd& '
xdd' (
=>dd) +
{ee 
xff 
.ff %
DefaultAuthenticateSchemeff +
=ff, -
JwtBearerDefaultsff. ?
.ff? @ 
AuthenticationSchemeff@ T
;ffT U
xgg 
.gg "
DefaultChallengeSchemegg (
=gg) *
JwtBearerDefaultsgg+ <
.gg< = 
AuthenticationSchemegg= Q
;ggQ R
}hh 
)hh 
.hh 
AddJwtBearerhh 
(hh 
xhh 
=>hh  
{ii 
xjj 
.jj  
RequireHttpsMetadatajj &
=jj' (
falsejj) .
;jj. /
xkk 
.kk 
	SaveTokenkk 
=kk 
truekk "
;kk" #
xll 
.ll %
TokenValidationParametersll +
=ll, -
newll. 1%
TokenValidationParametersll2 K
{mm $
ValidateIssuerSigningKeynn ,
=nn- .
truenn/ 3
,nn3 4
IssuerSigningKeyoo $
=oo% &
newoo' * 
SymmetricSecurityKeyoo+ ?
(oo? @
Encodingoo@ H
.ooH I
ASCIIooI N
.ooN O
GetBytesooO W
(ooW X
keyooX [
)oo[ \
)oo\ ]
,oo] ^
ValidateIssuerpp "
=pp# $
falsepp% *
,pp* +
ValidateAudienceqq $
=qq% &
falseqq' ,
}rr 
;rr 
}ss 
)ss 
;ss 
servicestt 
.tt 
AddSingletontt !
<tt! ""
IAuthenticationManagertt" 8
>tt8 9
(tt9 :
newtt: =!
AuthenticationManagertt> S
(ttS T
keyttT W
)ttW X
)ttX Y
;ttY Z
servicesvv 
.vv 
AddAutoMappervv "
(vv" #
(vv# $
typeofvv$ *
(vv* +
AutoMapperProfilevv+ <
)vv< =
.vv= >
Assemblyvv> F
)vvF G
)vvG H
;vvH I
}
 	
public
 
void
 
	Configure
 
(
 !
IApplicationBuilder
 1
app
2 5
,
5 6!
IWebHostEnvironment
7 J
env
K N
)
N O
{
 	
if
 
(
 
env
 
.
 
IsDevelopment
 !
(
! "
)
" #
)
# $
{
 
app
 
.
 '
UseDeveloperExceptionPage
 -
(
- .
)
. /
;
/ 0
app
 
.
 

UseSwagger
 
(
 
)
  
;
  !
app
 
.
 
UseSwaggerUI
  
(
  !
c
! "
=>
# %
c
& '
.
' (
SwaggerEndpoint
( 7
(
7 8
$str
8 R
,
R S
$str
T i
)
i j
)
j k
;
k l
}
 
var
 
serverClient
 
=
 
Configuration
 ,
.
, -

GetSection
- 7
(
7 8
$str
8 F
)
F G
.
G H

GetSection
H R
(
R S
$str
S X
)
X Y
.
Y Z
Value
Z _
;
_ `
app
 
.
 
UseCors
 
(
 
builder
 
=>
  "
{
 
builder
 
.
 
WithOrigins
 #
(
# $
serverClient
$ 0
)
0 1
.
 
AllowAnyHeader
 #
(
# $
)
$ %
.
 
AllowAnyMethod
 #
(
# $
)
$ %
.
 
AllowCredentials
 %
(
% &
)
& '
;
' (
}
 
)
 
;
 
app
   
.
   
UseStaticFiles
   
(
   
)
    
;
    !
app
££ 
.
££ 
UseAuthentication
££ !
(
££! "
)
££" #
;
££# $
app
¤¤ 
.
¤¤ 

UseRouting
¤¤ 
(
¤¤ 
)
¤¤ 
;
¤¤ 
app
¥¥ 
.
¥¥ 
UseAuthorization
¥¥  
(
¥¥  !
)
¥¥! "
;
¥¥" #
app
¦¦ 
.
¦¦ 
UseMiddleware
¦¦ 
<
¦¦ %
ErrorHandlingMiddleware
¦¦ 5
>
¦¦5 6
(
¦¦6 7
)
¦¦7 8
;
¦¦8 9
app
§§ 
.
§§ 
UseEndpoints
§§ 
(
§§ 
	endpoints
§§ &
=>
§§' )
{
¨¨ 
	endpoints
©© 
.
©© 
MapControllers
©© (
(
©©( )
)
©©) *
;
©©* +
	endpoints
ªª 
.
ªª 
MapHub
ªª  
<
ªª  !
ChattingHub
ªª! ,
>
ªª, -
(
ªª- .
$str
ªª. 8
)
ªª8 9
;
ªª9 :
}
«« 
)
«« 
;
«« 
}
¬¬ 	
}
­­ 
}®® 