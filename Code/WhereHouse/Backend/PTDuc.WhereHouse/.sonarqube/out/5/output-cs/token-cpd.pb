˜&
gD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\ChatHub\ChattingHub.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
ChatHub "
{ 
public		 

class		 
ChattingHub		 
:		 
Hub		 "
{

 
List 
< 
string 
> 
ConnectedUsers #
;# $
public 
ChattingHub 
( 
) 
{ 
ConnectedUsers 
= 
new  
List! %
<% &
string& ,
>, -
(- .
). /
;/ 0
} 	
public 
async 
Task 
Connect !
(! "
string" (
name) -
)- .
{ 	
{ 
} 
ConnectedUsers 
. 
Add "
(" #
name# '
)' (
;( )
var 
a 
= 
Context 
. 
UserIdentifier *
;* +
await 
Clients 
. 
All 
. 
	SendAsync '
(' (
$str( 3
,3 4
$str4 ;
); <
;< =
} 	
public 
async 
Task 

AddToGroup $
($ %
string% +
	groupName, 5
)5 6
{ 	
await 
Groups 
. 
AddToGroupAsync (
(( )
Context) 0
.0 1
ConnectionId1 =
,= >
	groupName? H
)H I
;I J
await 
Clients 
. 
Group 
(  
	groupName  )
)) *
.* +
	SendAsync+ 4
(4 5
$str5 ;
,; <
$"= ?
{? @
Context@ G
.G H
ConnectionIdH T
}T U
$strU k
{k l
	groupNamel u
}u v
$strv w
"w x
)x y
;y z
} 	
public 
async 
Task 
RemoveFromGroup )
() *
string* 0
	groupName1 :
): ;
{   	
await!! 
Groups!! 
.!!  
RemoveFromGroupAsync!! -
(!!- .
Context!!. 5
.!!5 6
ConnectionId!!6 B
,!!B C
	groupName!!D M
)!!M N
;!!N O
await## 
Clients## 
.## 
Group## 
(##  
	groupName##  )
)##) *
.##* +
	SendAsync##+ 4
(##4 5
$str##5 ;
,##; <
$"##= ?
{##? @
Context##@ G
.##G H
ConnectionId##H T
}##T U
$str##U i
{##i j
	groupName##j s
}##s t
$str##t u
"##u v
)##v w
;##w x
}$$ 	
public%% 
async%% 
Task%% 
SendMessageDuc%% (
(%%( )
string%%) /
userId%%0 6
,%%6 7
string%%7 =
mess%%> B
)%%B C
{&& 	
await(( 
Clients(( 
.(( 
Users(( 
(((  
userId((  &
)((& '
.((' (
	SendAsync((( 1
(((1 2
$str((2 8
,((8 9
mess((9 =
)((= >
;((> ?
})) 	
public++ 
async++ 
Task++ 
SendMessageToGroup++ ,
(++, -
string++- 3
	groupName++4 =
,++= >
string++> D
mess++E I
)++I J
{,, 	
await-- 
Clients-- 
.-- 
Group-- 
(--  
	groupName--  )
)--) *
.--* +
	SendAsync--+ 4
(--4 5
$str--5 I
,--I J
$"--K M
{--M N
Context--N U
.--U V
ConnectionId--V b
}--b c
$str--c y
{--y z
	groupName	--z É
}
--É Ñ
$str
--Ñ Ö
"
--Ö Ü
)
--Ü á
;
--á à
}.. 	
public00 
async00 
Task00 
SendPrivateMessage00 ,
(00, -
string00- 3
	groupName004 =
,00= >
string00? E

userSendId00F P
,00P Q
string00Q W
message00X _
)00_ `
{11 	
await33 
Clients33 
.33 
Group33 
(33  
	groupName33  )
)33) *
.33* +
	SendAsync33+ 4
(334 5
$str335 M
,33M N

userSendId33O Y
,33Y Z
message33[ b
)33b c
;33c d
}44 	
}55 
}66 ‹5
qD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\AddressController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
[ 
AllowAnonymous 
] 
[ 
ApiController 
] 
[ 
Route 

(
 
$str  
)  !
]! "
public 

class 
AddressController "
:# $

Controller% /
{ 
private 
string 

folderPath !
=" #
$str$ &
;& '

IBLAddress 

_bLAddress 
; 
public 
AddressController  
(  !
IWebHostEnvironment! 4
env5 8
,8 9

IBLAddress: D
	bLAddressE N
)N O
{P Q

folderPath 
= 
Path 
. 
Combine %
(% &
env& )
.) *
WebRootPath* 5
,5 6
$str6 <
,< =
$str> G
)G H
;H I

_bLAddress 
= 
	bLAddress "
;" #
} 	
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
IActionResult 
GetProvinces *
(* +
)+ ,
{ 	
string 
filePath 
= 
Path "
." #
Combine# *
(* +

folderPath+ 5
,5 6
$str7 E
)E F
;F G
try 
{ 
var   
res   
=   

_bLAddress   $
.  $ %
GetProvinces  % 1
(  1 2
filePath  2 :
)  : ;
;  ; <
return!! 
Ok!! 
(!! 
res!! 
)!! 
;!! 
}"" 
catch## 
(## 
	Exception## 
e## 
)## 
{$$ 
return%% 

BadRequest%% !
(%%! "
e%%" #
.%%# $
Message%%$ +
)%%+ ,
;%%, -
}&& 
}(( 	
[** 	
HttpGet**	 
(** 
$str** 
)** 
]** 
public++ 
virtual++ 
IActionResult++ $
GetDistricts++% 1
(++1 2
)++2 3
{,, 	
string-- 
filePath-- 
=-- 
Path-- "
.--" #
Combine--# *
(--* +

folderPath--+ 5
,--5 6
$str--7 H
)--H I
;--I J
try.. 
{// 
var00 
res00 
=00 

_bLAddress00 $
.00$ %
GetDistricts00% 1
(001 2
filePath002 :
)00: ;
;00; <
return11 
Ok11 
(11 
res11 
)11 
;11 
}22 
catch33 
(33 
	Exception33 
e33 
)33 
{44 
return55 

BadRequest55 !
(55! "
e55" #
.55# $
Message55$ +
)55+ ,
;55, -
}66 
}77 	
[99 	
HttpGet99	 
(99 
$str99 
)99 
]99 
public:: 
virtual:: 
IActionResult:: $
GetWards::% -
(::- .
)::. /
{;; 	
string<< 
filePath<< 
=<< 
Path<< "
.<<" #
Combine<<# *
(<<* +

folderPath<<+ 5
,<<5 6
$str<<7 G
)<<G H
;<<H I
try== 
{>> 
var?? 
res?? 
=?? 

_bLAddress?? $
.??$ %
GetWards??% -
(??- .
filePath??. 6
)??6 7
;??7 8
return@@ 
Ok@@ 
(@@ 
res@@ 
)@@ 
;@@ 
}AA 
catchBB 
(BB 
	ExceptionBB 
eBB 
)BB 
{CC 
returnDD 

BadRequestDD !
(DD! "
eDD" #
.DD# $
MessageDD$ +
)DD+ ,
;DD, -
}EE 
}FF 	
[HH 	
HttpGetHH	 
(HH 
$strHH &
)HH& '
]HH' (
publicII 
virtualII 
IActionResultII $ 
GetDistrictsByParentII% 9
(II9 :
[II: ;
	FromQueryII; D
]IID E
stringIIE K

parentCodeIIL V
)IIV W
{JJ 	
stringKK 
rootFilePathKK 
=KK  !
PathKK" &
.KK& '
CombineKK' .
(KK. /

folderPathKK/ 9
,KK9 :
$strKK; G
)KKG H
;KKH I
tryLL 
{MM 
varNN 
resNN 
=NN 

_bLAddressNN $
.NN$ % 
GetDistrictsByParentNN% 9
(NN9 :
rootFilePathNN: F
,NNF G

parentCodeNNH R
)NNR S
;NNS T
returnOO 
OkOO 
(OO 
resOO 
)OO 
;OO 
}PP 
catchQQ 
(QQ 
	ExceptionQQ 
eQQ 
)QQ 
{RR 
returnSS 

BadRequestSS !
(SS! "
eSS" #
.SS# $
MessageSS$ +
)SS+ ,
;SS, -
}TT 
}UU 	
[WW 	
HttpGetWW	 
(WW 
$strWW "
)WW" #
]WW# $
publicXX 
virtualXX 
IActionResultXX $
GetWardsByParentXX% 5
(XX5 6
[XX6 7
	FromQueryXX7 @
]XX@ A
stringXXB H

parentCodeXXI S
)XXS T
{YY 	
stringZZ 
rootFilePathZZ 
=ZZ  !
PathZZ" &
.ZZ& '
CombineZZ' .
(ZZ. /

folderPathZZ/ 9
,ZZ9 :
$strZZ; F
)ZZF G
;ZZG H
try[[ 
{\\ 
var]] 
res]] 
=]] 

_bLAddress]] $
.]]$ %
GetWardsByParent]]% 5
(]]5 6
rootFilePath]]6 B
,]]B C

parentCode]]D N
)]]N O
;]]O P
return^^ 
Ok^^ 
(^^ 
res^^ 
)^^ 
;^^ 
}__ 
catch`` 
(`` 
	Exception`` 
e`` 
)`` 
{aa 
returnbb 

BadRequestbb !
(bb! "
ebb" #
.bb# $
Messagebb$ +
)bb+ ,
;bb, -
}cc 
}dd 	
}ee 
}ff Ù'
tD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\BaseEntityController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{		 
[

 
ApiController

 
]

 
[ 
Route 

(
 
$str  
)  !
]! "
[ 
	Authorize 
] 
public 

class  
BaseEntityController %
<% &
TEntity& -
,- .
TDTO. 2
>2 3
:4 5

Controller6 @
whereA F
TEntityG N
:O P
classQ V
{ 
IBLBase 
< 
TEntity 
, 
TDTO 
> 
_BLBase &
;& '
	protected 
WhereHouseContext #
context$ +
=, -
new. 1
WhereHouseContext2 C
(C D
)D E
;E F
public  
BaseEntityController #
(# $
IBLBase$ +
<+ ,
TEntity, 3
,3 4
TDTO5 9
>9 :
BLBase; A
)A B
{ 	
_BLBase 
= 
BLBase 
; 
} 	
[ 	
HttpGet	 
] 
public 
virtual 
IActionResult $
Get% (
(( )
)) *
{ 	
return   
Ok   
(   
_BLBase   
.   
GetAll   $
(  $ %
)  % &
)  & '
;  ' (
}!! 	
[++ 	
HttpGet++	 
(++ 
$str++ 
)++ 
]++ 
public,, 
virtual,, 
IActionResult,, $
GetByID,,% ,
(,,, -
string,,- 3
id,,4 6
),,6 7
{-- 	
var.. 
res.. 
=.. 
_BLBase.. 
... 
GetByID.. %
(..% &
id..& (
)..( )
;..) *
return// 
Ok// 
(// 
res// 
)// 
;// 
}00 	
[99 	
HttpPost99	 
]99 
public:: 
virtual:: 
IActionResult:: $
Post::% )
(::) *
[::* +
FromBody::+ 3
]::3 4
TEntity::5 <
entity::= C
)::C D
{;; 	
var== 
res== 
=== 
new== 
ServiceResult== '
(==' (
)==( )
;==) *
try>> 
{?? 
res@@ 
.@@ 
Data@@ 
=@@ 
_BLBase@@ "
.@@" #
Insert@@# )
(@@) *
entity@@* 0
)@@0 1
;@@1 2
returnAA 
OkAA 
(AA 
resAA 
)AA 
;AA 
}BB 
catchCC 
(CC 
SystemCC 
.CC 
	ExceptionCC #
eCC$ %
)CC& '
{DD 
returnEE 

BadRequestEE !
(EE! "
eEE" #
)EE# $
;EE$ %
throwFF 
;FF 
}GG 
}JJ 	
[RR 	
HttpPutRR	 
(RR 
$strRR 
)RR 
]RR 
publicSS 
IActionResultSS 
PutSS  
(SS  !
[SS! "
FromBodySS" *
]SS* +
TEntitySS, 3
entitySS4 :
)SS: ;
{TT 	
varUU 
resUU 
=UU 
_BLBaseUU 
.UU 
UpdateUU $
(UU$ %
entityUU% +
)UU+ ,
;UU, -
returnVV 
OkVV 
(VV 
resVV 
)VV 
;VV 
}WW 	
[ZZ 	

HttpDeleteZZ	 
(ZZ 
$strZZ 
)ZZ 
]ZZ 
public[[ 
IActionResult[[ 
Delete[[ #
([[# $
[[[$ %
FromBody[[% -
][[- .
TEntity[[/ 6
entity[[7 =
)[[= >
{\\ 	
var]] 
res]] 
=]] 
_BLBase]] 
.]] 
Delete]] $
(]]$ %
entity]]% +
)]]+ ,
;]], -
return^^ 
Ok^^ 
(^^ 
res^^ 
)^^ 
;^^ 
}__ 	
[ii 	
HttpGetii	 
(ii 
$strii 
)ii 
]ii  
publicjj 
virtualjj 
IActionResultjj $
GetByPagingjj% 0
(jj0 1
intjj1 4
pagejj5 9
,jj9 :
intjj: =
pageSizejj> F
)jjF G
{kk 	
returnll 
Okll 
(ll 
_BLBasell 
.ll 
GetByPagingll )
(ll) *
pagell* .
,ll. /
pageSizell0 8
)ll8 9
)ll9 :
;ll: ;
}mm 	
}nn 
}oo Ø
vD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\ConversationController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class "
ConversationController '
:( ) 
BaseEntityController* >
<> ?
Conversation? K
,K L
ConversationDTOM \
>\ ]
{ 
IBLConversation 
_blConversation '
;' (
public "
ConversationController %
(% &
IBLConversation& 5
blConversation6 D
)D E
:F G
baseH L
(L M
blConversationM [
)[ \
{ 	
_blConversation 
= 
blConversation ,
;, -
} 	
} 
} ü&
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\FileController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
[ 
AllowAnonymous 
] 
public 

class 
FileController 
:  ! 
BaseEntityController" 6
<6 7
	DBContext7 @
.@ A
ModelsA G
.G H
FileH L
,L M
FileDTOM T
>T U
{ 
IBLFile 
_blFile 
; 
private 
readonly 
IWebHostEnvironment ,
_env- 1
;1 2
public 
FileController 
( 
IBLFile %
blFile& ,
,, -
IWebHostEnvironment. A
envB E
)E F
:G H
baseI M
(M N
blFileN T
)T U
{ 	
_blFile 
= 
blFile 
; 
_env 
= 
env 
; 
} 	
[ 	
HttpPost	 
( 
$str 
) 
]  
public 
IActionResult 

UploadFile '
(' (
[( )
FromForm) 1
]1 2

FileUpload3 =

fileUpload> H
)H I
{ 	
var 
res 
= 
new 
ServiceResult '
(' (
)( )
;) *
try 
{ 
if 
( 

fileUpload 
!= !
null" &
)& '
{ 
if 
( 

fileUpload "
." #
file# '
!=( *
null+ /
)/ 0
{   
var!! 

folderPath!! &
=!!' (

fileUpload!!) 3
.!!3 4
category!!4 <
!=!!= ?
null!!@ D
?!!E F
Path!!G K
.!!K L
Combine!!L S
(!!S T
$str!!T ]
,!!] ^

fileUpload!!_ i
.!!i j
category!!j r
)!!r s
:"" 
$str"" '
;""' (
res## 
=## 
_blFile## %
.##% &

UploadFile##& 0
(##0 1

fileUpload##1 ;
,##; <
_env##= A
.##A B
WebRootPath##B M
,##M N

folderPath##O Y
)##Y Z
;##Z [
return$$ 
Ok$$ !
($$! "
res$$" %
)$$% &
;$$& '
}%% 
else&& 
{'' 
return(( 

BadRequest(( )
((() *
res((* -
)((- .
;((. /
})) 
}** 
else++ 
{,, 
return-- 

BadRequest-- %
(--% &
res--& )
)--) *
;--* +
}.. 
}// 
catch00 
(00 
System00 
.00 
	Exception00 #
e00$ %
)00% &
{11 
res22 
.22 
Data22 
=22 
e22 
;22 
return33 

BadRequest33 !
(33! "
res33" %
)33% &
;33& '
}44 
}55 	
[77 	
HttpPost77	 
(77 
$str77 
)77 
]77  
public88 
IActionResult88 

DeleteFile88 '
(88' (

FileUpload88( 2

fileUpload883 =
)88= >
{99 	
var:: 
res:: 
=:: 
new:: 
ServiceResult:: '
(::' (
)::( )
;::) *
try;; 
{<< 
if== 
(== 

fileUpload== 
!=== !
null==" &
)==& '
{>> 
res?? 
=?? 
_blFile?? !
.??! "

DeleteFile??" ,
(??, -

fileUpload??- 7
,??7 8
_env??9 =
.??= >
WebRootPath??> I
)??I J
;??J K
return@@ 
Ok@@ 
(@@ 
res@@ !
)@@! "
;@@" #
}AA 
elseBB 
{CC 
returnDD 

BadRequestDD %
(DD% &
resDD& )
)DD) *
;DD* +
}EE 
}FF 
catchGG 
(GG 
SystemGG 
.GG 
	ExceptionGG #
eGG$ %
)GG% &
{HH 
resII 
.II 
DataII 
=II 
eII 
;II 
returnJJ 

BadRequestJJ !
(JJ! "
resJJ" %
)JJ% &
;JJ& '
}KK 
}LL 	
}MM 
}NN ü 
oD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\HouseController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
HouseController  
:! " 
BaseEntityController# 7
<7 8
House8 =
,= >
HouseDTO? G
>G H
{ 
IBLHouse 
_blHouse 
; 
public 
HouseController 
( 
IBLHouse '
blHouse( /
)/ 0
:1 2
base3 7
(7 8
blHouse8 ?
)? @
{ 	
_blHouse 
= 
blHouse 
; 
} 	
[ 	
AllowAnonymous	 
] 
public 
override 
IActionResult %
Get& )
() *
)* +
{ 	
return 
base 
. 
Get 
( 
) 
; 
} 	
[ 	
AllowAnonymous	 
] 
public 
override 
IActionResult %
GetByPaging& 1
(1 2
int2 5
page6 :
,: ;
int< ?
pageSize@ H
)H I
{ 	
return   
base   
.   
GetByPaging   #
(  # $
page  $ (
,  ( )
pageSize  * 2
)  2 3
;  3 4
}!! 	
[## 	
AllowAnonymous##	 
]## 
public$$ 
override$$ 
IActionResult$$ %
GetByID$$& -
($$- .
string$$. 4
id$$5 7
)$$7 8
{%% 	
return&& 
base&& 
.&& 
GetByID&& 
(&&  
id&&  "
)&&" #
;&&# $
}'' 	
[)) 	
HttpGet))	 
()) 
$str)) 
))) 
]))  
public** 
virtual** 
IActionResult** $
GetDeepData**% 0
(**0 1
)**1 2
{++ 	
return,, 
Ok,, 
(,, 
_blHouse,, 
.,, 
GetDeepData,, *
(,,* +
),,+ ,
),,, -
;,,- .
}-- 	
[// 	
HttpGet//	 
(// 
$str// !
)//! "
]//" #
public00 
virtual00 
IActionResult00 $
GetHouseDetail00% 3
(003 4
string004 :
houseId00; B
)00B C
{11 	
var22 
res22 
=22 
new22 
ServiceResult22 '
(22' (
)22( )
;22) *
var44 
identity44 
=44 
HttpContext44 &
.44& '
User44' +
.44+ ,
Identity44, 4
as445 7
ClaimsIdentity448 F
;44F G
if55 
(55 
identity55 
!=55 
null55  
)55  !
{66 
IEnumerable77 
<77 
Claim77 !
>77! "
claims77# )
=77* +
identity77, 4
.774 5
Claims775 ;
;77; <
var88 
userId88 
=88 
User88 !
.88! "
Claims88" (
.88( )
Where88) .
(88. /
c88/ 0
=>881 3
c884 5
.885 6
Type886 :
==88; =
$str88> F
)88F G
.99 
Select99 
(99 
x99 
=>99 
x99 
.99 
Value99 
)99 
.99 
FirstOrDefault99 (
(99( )
)99) *
;99* +
res:: 
.:: 
Data:: 
=:: 
null:: 
;::  
};; 
return== 
Ok== 
(== 
res== 
)== 
;== 
}>> 	
}?? 
}@@ ˆ
pD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\LoginController .cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
[ 
Route 

(
 
$str  
)  !
]! "
[ 
ApiController 
] 
[ 
	Authorize 
] 
public 

class 
LoginController  
:! "
ControllerBase# 1
{ 
IBLLogin 
_bLLogin 
; 
public 
LoginController 
( 
IBLLogin '
bLLogin( /
)/ 0
{ 	
_bLLogin 
= 
bLLogin 
; 
} 	
[QQ 	
HttpPostQQ	 
]QQ 
[RR 	
AllowAnonymousRR	 
]RR 
publicSS 
IActionResultSS 
LoginSS "
(SS" #
[SS# $
FromBodySS$ ,
]SS, -

LoginParamSS- 7
paramSS8 =
)SS= >
{TT 	
varUU 
resUU 
=UU 
newUU 
ServiceResultUU '
(UU' (
)UU( )
;UU) *
tryVV 
{WW 
resXX 
=XX 
_bLLoginXX 
.XX 
LoginXX $
(XX$ %
paramXX% *
)XX* +
;XX+ ,
}YY 
catchZZ 
(ZZ 
	ExceptionZZ 
eZZ 
)ZZ 
{[[ 
res\\ 
.\\ 
	Messenger\\ 
=\\ 
e\\  !
.\\! "
Message\\" )
;\\) *
}]] 
return^^ 
Ok^^ 
(^^ 
res^^ 
)^^ 
;^^ 
}hh 	
}ii 
}jj Ë

qD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\MessageController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
MessageController "
:# $ 
BaseEntityController% 9
<9 :
Message: A
,A B

MessageDTOC M
>M N
{ 

IBLMessage 

_blMessage 
; 
public 
MessageController  
(  !

IBLMessage! +
	blMessage, 5
)5 6
:7 8
base9 =
(= >
	blMessage> G
)G H
{ 	

_blMessage 
= 
	blMessage "
;" #
} 	
[ 	
HttpGet	 
( 
$str "
)" #
]# $
public 
virtual 
IActionResult $
GetConversation% 4
(4 5

MessageDTO5 ?
message@ G
)G H
{ 	
return 
Ok 
( 

_blMessage  
.  !
GetConversation! 0
(0 1
message1 8
)8 9
)9 :
;: ;
} 	
} 
} Ë
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\PostController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
PostController 
:  ! 
BaseEntityController" 6
<6 7
Post7 ;
,; <
PostDTO= D
>D E
{ 
IBLPost 
_blPost 
; 
public 
PostController 
( 
IBLPost %
blPost& ,
), -
:. /
base0 4
(4 5
blPost5 ;
); <
{ 	
_blPost 
= 
blPost 
; 
} 	
[ 	
AllowAnonymous	 
] 
public 
override 
IActionResult %
Get& )
() *
)* +
{ 	
return 
base 
. 
Get 
( 
) 
; 
} 	
[   	
AllowAnonymous  	 
]   
public!! 
override!! 
IActionResult!! %
GetByPaging!!& 1
(!!1 2
int!!2 5
page!!6 :
,!!: ;
int!!< ?
pageSize!!@ H
)!!H I
{"" 	
return## 
base## 
.## 
GetByPaging## #
(### $
page##$ (
,##( )
pageSize##* 2
)##2 3
;##3 4
}$$ 	
[&& 	
AllowAnonymous&&	 
]&& 
public'' 
override'' 
IActionResult'' %
GetByID''& -
(''- .
string''. 4
id''5 7
)''7 8
{(( 	
return)) 
base)) 
.)) 
GetByID)) 
())  
id))  "
)))" #
;))# $
}** 	
},, 
}-- ˛	
nD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\UserController.cs
	namespace

 	
PTDuc


 
.

 

WhereHouse

 
.

 
Controllers

 &
{ 
public 

class 
UserController 
: 	 
BaseEntityController
 
< 
User #
,# $
UserDTO% ,
>, -
{ 
IBLUser 
_blUser 
; 
public 
UserController 
( 
IBLUser %
blUser& ,
), -
:. /
base0 4
(4 5
blUser5 ;
); <
{ 	
_blUser 
= 
blUser 
; 
} 	
[ 	
AllowAnonymous	 
] 
public 
override 
IActionResult %
Post& *
(* +
[+ ,
FromBody, 4
]4 5
User6 :
entity; A
)A B
{ 	
return 
base 
. 
Post 
( 
entity #
)# $
;$ %
} 	
} 
} ˇ
rD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Controllers\WishlistController.cs
	namespace 	
PTDuc
 
. 

WhereHouse 
. 
Controllers &
{ 
public 

class 
WishlistController #
:$ % 
BaseEntityController& :
<: ;
Wishlist; C
,C D
WishlistDTOD O
>O P
{ 
IBLWishlist 
_blWishlist 
;  
public 
WishlistController !
(! "
IBLWishlist" -

blWishlist. 8
)8 9
:: ;
base< @
(@ A

blWishlistA K
)K L
{ 	
_blWishlist 
= 

blWishlist $
;$ %
} 	
} 
} ñ
sD:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\MapperProfile\AutoMapperProfile.cs
	namespace		 	
PTDuc		
 
.		 

WhereHouse		 
.		 
MapperProfile		 (
{

 
public 

class 
AutoMapperProfile "
:# $
Profile% ,
{ 
public 
AutoMapperProfile  
(  !
)! "
{# $
	CreateMap 
< 
User 
, 
UserDTO #
># $
($ %
)% &
;& '
	CreateMap 
< 
File 
, 
FileDTO #
># $
($ %
)% &
;& '
	CreateMap 
< 
House 
, 
HouseDTO %
>% &
(& '
)' (
;( )
	CreateMap 
< 
	HouseType 
,  
HouseTypeDTO! -
>- .
(. /
)/ 0
;0 1
	CreateMap 
< 
Post 
, 
PostDTO #
># $
($ %
)% &
;& '
	CreateMap 
< 
Wishlist 
, 
WishlistDTO  +
>+ ,
(, -
)- .
;. /
;0 1
	CreateMap 
< 
Message 
, 

MessageDTO )
>) *
(* +
)+ ,
;, -
;. /
	CreateMap 
< 
Conversation "
," #
ConversationDTO$ 3
>3 4
(4 5
)5 6
;6 7
;8 9
} 	
} 
} ’

[D:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Program.cs
	namespace

 	
PTDuc


 
.

 

WhereHouse

 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} ⁄Z
[D:\Tailieu\projectDoAn\Code\WhereHouse\Backend\PTDuc.WhereHouse\PTDuc.WhereHouse\Startup.cs
	namespace"" 	
PTDuc""
 
."" 

WhereHouse"" 
{## 
public$$ 

class$$ 
Startup$$ 
{%% 
public&& 
Startup&& 
(&& 
IConfiguration&& %
configuration&&& 3
)&&3 4
{'' 	
Configuration(( 
=(( 
configuration(( )
;(() *
})) 	
public++ 
IConfiguration++ 
Configuration++ +
{++, -
get++. 1
;++1 2
}++3 4
public.. 
void.. 
ConfigureServices.. %
(..% &
IServiceCollection..& 8
services..9 A
)..A B
{// 	
services11 
.11 
AddControllers11 #
(11# $
)11$ %
.11% &
AddJsonOptions11& 4
(114 5
options115 <
=>11= ?
{22 
options33 
.33 !
JsonSerializerOptions33 -
.33- . 
PropertyNamingPolicy33. B
=33C D
null33E I
;33I J
}44 
)44 
;44 
services55 
.55 
AddControllers55 #
(55# $
)55$ %
.66 
AddJsonOptions66 
(66  
options66  '
=>66( *
{77 
options88 
.88 !
JsonSerializerOptions88 1
.881 2
ReferenceHandler882 B
=88C D
ReferenceHandler88E U
.88U V
Preserve88V ^
;88^ _
options99 
.99 !
JsonSerializerOptions99 1
.991 2
WriteIndented992 ?
=99@ A
true99B F
;99F G
}:: 
):: 
;:: 
services;; 
.;; 
AddSwaggerGen;; "
(;;" #
c;;# $
=>;;% '
{<< 
c== 
.== 

SwaggerDoc== 
(== 
$str== !
,==! "
new==# &
OpenApiInfo==' 2
{==3 4
Title==5 :
===; <
$str=== O
,==O P
Version==Q X
===Y Z
$str==[ _
}==` a
)==a b
;==b c
}>> 
)>> 
;>> 
services@@ 
.@@ 

AddSignalR@@ 
(@@  
)@@  !
;@@! "
servicesBB 
.BB 
	AddScopedBB 
<BB 
IBLUserBB &
,BB& '
BLUserBB( .
>BB. /
(BB/ 0
)BB0 1
;BB1 2
servicesCC 
.CC 
	AddScopedCC 
<CC 
IDLUserCC &
,CC& '
DLUserCC( .
>CC. /
(CC/ 0
)CC0 1
;CC1 2
servicesEE 
.EE 
	AddScopedEE 
<EE 
IBLLoginEE '
,EE' (
BLLoginEE) 0
>EE0 1
(EE1 2
)EE2 3
;EE3 4
servicesFF 
.FF 
	AddScopedFF 
<FF 
IDLLoginFF '
,FF' (
DLLoginFF) 0
>FF0 1
(FF1 2
)FF2 3
;FF3 4
servicesHH 
.HH 
	AddScopedHH 
<HH 
IBLHouseHH '
,HH' (
BLHouseHH) 0
>HH0 1
(HH1 2
)HH2 3
;HH3 4
servicesII 
.II 
	AddScopedII 
<II 
IDLHouseII '
,II' (
DLHouseII) 0
>II0 1
(II1 2
)II2 3
;II3 4
servicesKK 
.KK 
	AddScopedKK 
<KK 

IBLAddressKK )
,KK) *
	BLAddressKK+ 4
>KK4 5
(KK5 6
)KK6 7
;KK7 8
servicesMM 
.MM 
	AddScopedMM 
<MM 
IBLFileMM &
,MM& '
BLFileMM( .
>MM. /
(MM/ 0
)MM0 1
;MM1 2
servicesNN 
.NN 
	AddScopedNN 
<NN 
IDLFileNN &
,NN& '
DLFileNN( .
>NN. /
(NN/ 0
)NN0 1
;NN1 2
servicesPP 
.PP 
	AddScopedPP 
<PP 
IDLWishlistPP *
,PP* +

DLWishlistPP, 6
>PP6 7
(PP7 8
)PP8 9
;PP9 :
servicesQQ 
.QQ 
	AddScopedQQ 
<QQ 
IBLWishlistQQ *
,QQ* +

BLWishlistQQ, 6
>QQ6 7
(QQ7 8
)QQ8 9
;QQ9 :
servicesSS 
.SS 
	AddScopedSS 
<SS 
IDLPostSS &
,SS& '
DLPostSS( .
>SS. /
(SS/ 0
)SS0 1
;SS1 2
servicesTT 
.TT 
	AddScopedTT 
<TT 
IBLPostTT &
,TT& '
BLPostTT( .
>TT. /
(TT/ 0
)TT0 1
;TT1 2
servicesVV 
.VV 
	AddScopedVV 
<VV 

IDLMessageVV )
,VV) *
	DLMessageVV+ 4
>VV4 5
(VV5 6
)VV6 7
;VV7 8
servicesWW 
.WW 
	AddScopedWW 
<WW 

IBLMessageWW )
,WW) *
	BLMessageWW+ 4
>WW4 5
(WW5 6
)WW6 7
;WW7 8
servicesYY 
.YY 
	AddScopedYY 
<YY 
IDLConversationYY .
,YY. /
DLConversationYY0 >
>YY> ?
(YY? @
)YY@ A
;YYA B
servicesZZ 
.ZZ 
	AddScopedZZ 
<ZZ 
IBLConversationZZ .
,ZZ. /
BLConversationZZ0 >
>ZZ> ?
(ZZ? @
)ZZ@ A
;ZZA B
services\\ 
.\\ 
AddDbContext\\ !
<\\! "
WhereHouseContext\\" 3
>\\3 4
(\\4 5
options]] 
=>]] 
options]] 
.]] 
UseSqlServer]] +
(]]+ ,
$str]], W
)]]W X
)]]X Y
;]]Y Z
var`` 
key`` 
=`` 
Configuration`` #
.``# $

GetSection``$ .
(``. /
$str``/ ?
)``? @
.``@ A

GetSection``A K
(``K L
$str``L Q
)``Q R
.``R S
Value``S X
;``X Y
servicesaa 
.aa 
AddAuthenticationaa &
(aa& '
xaa' (
=>aa) +
{bb 
xcc 
.cc %
DefaultAuthenticateSchemecc +
=cc, -
JwtBearerDefaultscc. ?
.cc? @ 
AuthenticationSchemecc@ T
;ccT U
xdd 
.dd "
DefaultChallengeSchemedd (
=dd) *
JwtBearerDefaultsdd+ <
.dd< = 
AuthenticationSchemedd= Q
;ddQ R
}ee 
)ee 
.ee 
AddJwtBeareree 
(ee 
xee 
=>ee  
{ff 
xgg 
.gg  
RequireHttpsMetadatagg &
=gg' (
falsegg) .
;gg. /
xhh 
.hh 
	SaveTokenhh 
=hh 
truehh "
;hh" #
xii 
.ii %
TokenValidationParametersii +
=ii, -
newii. 1%
TokenValidationParametersii2 K
{jj $
ValidateIssuerSigningKeykk ,
=kk- .
truekk/ 3
,kk3 4
IssuerSigningKeyll $
=ll% &
newll' * 
SymmetricSecurityKeyll+ ?
(ll? @
Encodingll@ H
.llH I
ASCIIllI N
.llN O
GetBytesllO W
(llW X
keyllX [
)ll[ \
)ll\ ]
,ll] ^
ValidateIssuermm "
=mm# $
falsemm% *
,mm* +
ValidateAudiencenn $
=nn% &
falsenn' ,
}oo 
;oo 
}pp 
)pp 
;pp 
servicesqq 
.qq 
AddSingletonqq !
<qq! ""
IAuthenticationManagerqq" 8
>qq8 9
(qq9 :
newqq: =!
AuthenticationManagerqq> S
(qqS T
keyqqT W
)qqW X
)qqX Y
;qqY Z
servicesss 
.ss 
AddAutoMapperss "
(ss" #
(ss# $
typeofss$ *
(ss* +
AutoMapperProfiless+ <
)ss< =
.ss= >
Assemblyss> F
)ssF G
)ssG H
;ssH I
}
ÑÑ 	
public
áá 
void
áá 
	Configure
áá 
(
áá !
IApplicationBuilder
áá 1
app
áá2 5
,
áá5 6!
IWebHostEnvironment
áá7 J
env
ááK N
)
ááN O
{
àà 	
if
ââ 
(
ââ 
env
ââ 
.
ââ 
IsDevelopment
ââ !
(
ââ! "
)
ââ" #
)
ââ# $
{
ää 
app
ãã 
.
ãã '
UseDeveloperExceptionPage
ãã -
(
ãã- .
)
ãã. /
;
ãã/ 0
app
åå 
.
åå 

UseSwagger
åå 
(
åå 
)
åå  
;
åå  !
app
çç 
.
çç 
UseSwaggerUI
çç  
(
çç  !
c
çç! "
=>
çç# %
c
çç& '
.
çç' (
SwaggerEndpoint
çç( 7
(
çç7 8
$str
çç8 R
,
ççR S
$str
ççT i
)
ççi j
)
ççj k
;
ççk l
}
éé 
var
ìì 
serverClient
ìì 
=
ìì 
Configuration
ìì ,
.
ìì, -

GetSection
ìì- 7
(
ìì7 8
$str
ìì8 F
)
ììF G
.
ììG H

GetSection
ììH R
(
ììR S
$str
ììS X
)
ììX Y
.
ììY Z
Value
ììZ _
;
ìì_ `
app
îî 
.
îî 
UseCors
îî 
(
îî 
builder
îî 
=>
îî  "
{
ïï 
builder
ññ 
.
ññ 
WithOrigins
ññ #
(
ññ# $
serverClient
ññ$ 0
)
ññ0 1
.
óó 
AllowAnyHeader
óó #
(
óó# $
)
óó$ %
.
òò 
AllowAnyMethod
òò #
(
òò# $
)
òò$ %
.
ôô 
AllowCredentials
ôô %
(
ôô% &
)
ôô& '
;
ôô' (
}
öö 
)
öö 
;
öö 
app
ùù 
.
ùù 
UseStaticFiles
ùù 
(
ùù 
)
ùù  
;
ùù  !
app
†† 
.
†† 
UseAuthentication
†† !
(
††! "
)
††" #
;
††# $
app
°° 
.
°° 

UseRouting
°° 
(
°° 
)
°° 
;
°° 
app
¢¢ 
.
¢¢ 
UseAuthorization
¢¢  
(
¢¢  !
)
¢¢! "
;
¢¢" #
app
££ 
.
££ 
UseMiddleware
££ 
<
££ %
ErrorHandlingMiddleware
££ 5
>
££5 6
(
££6 7
)
££7 8
;
££8 9
app
§§ 
.
§§ 
UseEndpoints
§§ 
(
§§ 
	endpoints
§§ &
=>
§§' )
{
•• 
	endpoints
¶¶ 
.
¶¶ 
MapControllers
¶¶ (
(
¶¶( )
)
¶¶) *
;
¶¶* +
	endpoints
ßß 
.
ßß 
MapHub
ßß  
<
ßß  !
ChattingHub
ßß! ,
>
ßß, -
(
ßß- .
$str
ßß. 8
)
ßß8 9
;
ßß9 :
}
®® 
)
®® 
;
®® 
}
©© 	
}
™™ 
}´´ 